<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<!-- 
	CREATED BY : RUKMANI J
	USED FOR :Inventory Master -->
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css"
	href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
	th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/font-awesome/5.9.0/css/all.min.css"
	th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
	th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
	th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
<link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">

<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
	th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
	th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
<script src="/webjars/jquery/3.4.1/jquery.min.js"
	th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
	th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
<script src="/webjars/jquery-form/4.2.2/jquery.form.min.js"
	th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>
<script src="/webjars/jquery-validation/1.19.0/jquery.validate.min.js"
	th:src="@{/webjars/jquery-validation/1.19.0/jquery.validate.min.js}"></script>
<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
<script
	src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>

<style>
.no-border-table {
	border: none;
	border-collapse: collapse;
}

.no-border-table td {
	border: none;
}

.btns {
	float: right;
	margin: 5px;
}

.col-sm-5 {
	padding-bottom: 15px;
}

.list-body {
	padding: 0px;
}

.error {
	color: red;
	padding-left: 10px;
}

.formline {
	padding-bottom: 4px;
}

#finusertb {
	width: 460px;
}

.card-header {
	padding: 1.75rem 1.25rem;
}

.card-header1 {
	padding: 1.75rem 1rem;
}

.dataTables_wrapper .dataTables_paginate .paginate_button {
	padding: 0px;
}

.nav-tabs .nav-item.show .nav-link, .nav-tabs .nav-link.active {
	border: 2px solid skyblue !important;
	border-bottom: unset !important;
	background-color: unset !important;
	color: black !important;
	background-color: unset !important;
}

nav {
	border-bottom: 2px solid grey;
}

.filterable .filters input[disabled] {
	background-color: transparent;
	border: none;
	cursor: auto;
	box-shadow: none;
	padding: 0;
	height: auto;
}

.filterable .filters input[disabled]::-webkit-input-placeholder {
	color: #333;
}

.filterable .filters input[disabled]::-moz-placeholder {
	color: #333;
}

.filterable .filters input[disabled]:-ms-input-placeholder {
	color: #333;
}
</style>

<style>
table {
	width: 100%;
	border-collapse: collapse;
}

th, td {
	padding: 10px;
	text-align: left;
}

th, td {
	border: 1px solid #dcdcdc;
}

td {
	border-top: 1px solid #dcdcdc;
}
</style>
<script th:inline="javascript">
		/*<![CDATA[*/

		$(function () {

			$("#disableStartDate,#disableEndDate").datepicker({
				minDate: new Date(),
				changeMonth: true,
				changeYear: true,
				gotoCurrent: true,
				dateFormat: "dd-mm-yy"
			});

		});

		function home() {
			location.href = 'Dashboard'
		}

		function back() {
			window.history.back();
		}

		function list() {
			location.href = 'InventoryMaster';
		}
		function Headcode(a) {
			var headcode = a.getAttribute('data-id');
			alert(headcode)
			location.href = 'InventoryMaster?formmode=edit&headcode=' + headcode;
		}

		function Headcode1(a) {
			var headcode = a.getAttribute('data-id');
			alert(headcode)
			location.href = 'InventoryMaster?formmode=verify&headcode=' + headcode;
		}

		function codeadd() {

			location.href = 'InventoryMaster?formmode=add';
		}


		/*]]>*/
	</script>
<script>
		$(function () {
			$("#dob,#doj,#disableEndDate,#disableStartDate").datepicker({
				dateFormat: "dd-mm-yy",
				changeMonth: true,
				numberOfMonths: 1,
				gotoCurrent: true

			});

			$(".checkToModify").on(
				'click',
				function () {

					$(this).prop('checked', true);

					var formMode = "edit";

					var resId = $(this).val();

					location.href = 'MtAssociateProfile?formmode=' + formMode
						+ '&resId=' + resId;

				});

		});

		function submiteditform(a) {

			var depr_method = document.getElementById('depr_method').value || null;
			var depr_percent = document.getElementById('depr_percent').value;
			if ($("#BAMInventorymaster").valid()) {
				//$("#loader1").modal("toggle");
				var formmode = 'edit';
				var Invtype = 'InvMastadd';
				alert(formmode);
				var url = "./InvMastadd?formmode=" + formmode + "&Invtype=" + Invtype + "&de_m=" + depr_method + "&depr_percent=" + depr_percent;

				$("#BAMInventorymaster").attr('action', url);

				var options = {
					success: showResponse
					// post-submit callback 
				};

				$("#BAMInventorymaster").ajaxSubmit(options);

				function showResponse(responseText, statusText, xhr, $form) {
					//	$("#loader1").hide();
					$("#alertmsg").text(responseText);

					$('#alert').modal("toggle");

				};

			}

		}

		function submitverifyform(a) {

			if ($("#BAMInventorymaster").valid()) {
				//$("#loader1").modal("toggle");
				var depr_method = document.getElementById('depr_method').value || null;
				var formmode = 'verify';
				var Invtype = 'InvMastadd';
				alert(formmode);
				var url = "./InvMastadd?formmode=" + formmode + "&Invtype=" + Invtype + "&de_m=" + depr_method;

				$("#BAMInventorymaster").attr('action', url);

				var options = {
					success: showResponse
					// post-submit callback 
				};

				$("#BAMInventorymaster").ajaxSubmit(options);

				function showResponse(responseText, statusText, xhr, $form) {
					//	$("#loader1").hide();
					$("#alertmsg").text(responseText);

					$('#alert').modal("toggle");

				};

			}

		}

function submitaddform(b) {

		if ($("#BAMInventorymaster").valid()) {
			$("#loader1").modal("toggle");
			var formmode = 'add';
			var Invtype = 'InvTranadd';
			alert(formmode);
			var url = "./InvTranadd?formmode=" + formmode + "&Invtype="
					+ Invtype;

			$("#BAMInventorymaster").attr('action', url);

			var options = {
				success : showResponse
			// post-submit callback 
			};

			$("#BAMInventorymaster").ajaxSubmit(options);

			function showResponse(responseText, statusText, xhr, $form) {
				$("#loader1").hide();
				$("#alertmsg").text(responseText);

				$('#alert').modal("toggle");

			}
			;

		}

	}
</script>
<script>
		function handleSelectChanges() {
			var asset_code = document.getElementById('asset_category').value;
			var asset_category = asset_code.split(' - ')[0];
			alert(asset_category)
			if (asset_category) {
				$.ajax({
					type: 'GET',
					url: "./get_serial_main",
					data: {asset_category: asset_category},
					success: function (response) {
						console.log("Response from server:", response);

						var deprFlag = document.getElementById('depr_flag').value;


						//document.getElementById('depr_percent').value = response.depreciation_percentage || '';
						//document.getElementById('sol_id').value = response.solid || '';
						//document.getElementById('loc_type').value = response.location || '';
						document.getElementById('category_desc').value = response.category_description || '';
						//document.getElementById('asset_category').value = response.head_description || '';
						if (deprFlag === "N" || deprFlag === "") {
							//	 alert("empty")
							deprMethod.value = ""; // Clear the selection
							deprMethod.disabled = true; // Disable the select element
						} else {
							//alert(deprFlag)
							//document.getElementById('depr_method').value = response.depreciation_method || '';
							deprMethod.disabled = false; // Enable the select element
						}

					},
					error: function (error) {
						console.error("Error fetching asset details:", error);

					}
				});
			}
		}

	</script>


<script>


		function submitaddform(a) {

			var asset = document.getElementById('asset_category').value;
			var asset_category = asset.split(' - ')[0];
			// alert(asset_category)
			if (asset_category) {
				$.ajax({
					type: 'GET',
					url: "./get_serial_main",
					data: {asset_category: asset_category},
					success: function (response) {
						console.log("Response from server:", response);


						var headcode = response.head_code || '';
						var category_code = response.category_code || '';
						var sub_category_code = response.sub_category_code || '';

						//alert(headcode);alert(category_code);alert(sub_category_code);


						var depr_method = document.getElementById('depr_method').value;
						var depr_percent = document.getElementById('depr_percent').value;

						if ($("#BAMInventorymaster").valid()) {
							//$("#loader1").modal("toggle");
							var formmode = 'add';
							var Invtype = 'InvMastadd';
							//alert(formmode);alert(Invtype);
							var url = "./InvMastadd?formmode=" + formmode + "&Invtype=" + Invtype + "&de_m=" + depr_method + "&depr_percent=" + depr_percent
								+ "&headcode=" + headcode + "&category_code=" + category_code + "&sub_category_code=" + sub_category_code;

							$("#BAMInventorymaster").attr('action', url);

							var options = {
								success: showResponse
								// post-submit callback 
							};

							$("#BAMInventorymaster").ajaxSubmit(options);

							function showResponse(responseText, statusText, xhr, $form) {
								//$("#loader1").hide();
								$("#alertmsg").text(responseText);

								$('#alert').modal("toggle");

							};

						}

					}
				});
			}
		}
		// Default values
		let defaultDepreciationRate = 2;  // Depreciation rate in percentage
		let defaultAssetValue = 1000;  // Example asset value, replace with actual value if needed

		// Function to calculate years between two dates
		function getYearsBetweenDates(startDate, endDate) {
			const yearDiff = endDate.getFullYear() - startDate.getFullYear();
			const monthDiff = endDate.getMonth() - startDate.getMonth();
			const dayDiff = endDate.getDate() - startDate.getDate();

			// Adjust the year difference based on the month and day differences
			let years = yearDiff;
			if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {
				years -= 1;
			}

			// Return at least 1 year if the period is less than a year
			return years > 0 ? years : 1;
		}

		// Function to update accumulated depreciation dynamically
		function updateDepreciation() {
			const assetValueInput = document.getElementById('org_cost'); // Asset value input
			const depreciationInput = document.getElementById('depr_percent'); // Depreciation rate input
			const purchaseDateInput = document.getElementById('year_of_purchase'); // Purchase date input
			const lastDepreciationDateInput = document.getElementById('date_of_last_depr'); // Last depreciation date input
			const accDeprInput = document.getElementById('acc_depr'); // Accumulated depreciation output

			// Get values from inputs
			const assetValue = parseFloat(assetValueInput.value) || defaultAssetValue;
			const depreciationRate = parseFloat(depreciationInput.value) || defaultDepreciationRate;
			const purchaseDate = new Date(purchaseDateInput.value);
			const lastDepreciationDate = new Date(lastDepreciationDateInput.value);

			// Check for valid inputs
			if (!isNaN(depreciationRate) && !isNaN(assetValue) && !isNaN(purchaseDate.getTime()) && !isNaN(lastDepreciationDate.getTime())) {
				const years = getYearsBetweenDates(purchaseDate, lastDepreciationDate);
				const depreciationAmount = (assetValue * (depreciationRate / 100)) * years;

				// Update the accumulated depreciation
				accDeprInput.value = depreciationAmount.toFixed(2);

				// Debugging output
				console.log(`Asset Value: ${assetValue}, Depreciation Rate: ${depreciationRate}, Years: ${years}, Accumulated Depreciation: ${depreciationAmount}`);
			}
		}

		// Set initial value of accumulated depreciation and attach event listeners
		document.addEventListener('DOMContentLoaded', function () {
			const accDeprInput = document.getElementById('acc_depr');

			// Initialize the accumulated depreciation value
			accDeprInput.value = '0.00'; // Initial value, can be updated with server value if needed

			// Attach event listeners to update calculation whenever inputs change
			document.getElementById('org_cost').addEventListener('input', updateDepreciation);
			document.getElementById('depr_percent').addEventListener('input', updateDepreciation);
			document.getElementById('year_of_purchase').addEventListener('change', updateDepreciation);
			document.getElementById('date_of_last_depr').addEventListener('change', updateDepreciation);
		});


		$(document).ready(function () {
			const gteeAmt = $('#gtee_amt'); // Get the Guarantee Amount Flag select element
			const gteeAmtPercent = $('#gtee_amt_percent'); // Get the Guarantee Amount Percentage input field

			// Function to handle enabling/disabling the Guarantee Amount Percentage field
			function updateGteeAmtPercent() {
				const gteeAmtValue = gteeAmt.val(); // Get the current value of gtee_amt

				if (gteeAmtValue === "N" || gteeAmtValue === "") {
					gteeAmtPercent.val(''); // Clear the field value
					gteeAmtPercent.prop('readonly', true); // Make the field read-only
					gteeAmtPercent.removeAttr('required');
				} else if (gteeAmtValue === "Y") {
					gteeAmtPercent.prop('readonly', false); // Make the field editable
				}
			}

			// Call the function on page load to set the correct state
			updateGteeAmtPercent();

			// Add event listener to the select field to update the state when the value changes
			gteeAmt.change(function () {
				updateGteeAmtPercent();
			});
		});

		//for locaton type handling
		$(document).ready(function() {
			const loctype = $('#loc_type'); 
			const empid = $('#emp_id'); 
			const deptdivname = $('#dept_div_name'); 
			const loca_addr = $('#loca_addr'); 
		
			function updateempid() {
				const loctypeValue = loctype.val(); 
		
				if (loctypeValue === "QUA") {
					empid.prop('readonly', false); // Make the field editable
					loca_addr.prop('readonly', false); // Make the field editable
					deptdivname.prop('readonly', true); // Make other fields read-only if necessary
					deptdivname.removeAttr('required'); 
				    
				} else if (loctypeValue === "OFF") {
					deptdivname.prop('readonly', false); // Make the field editable
					empid.prop('readonly', true); // Make other fields read-only if necessary
					loca_addr.prop('readonly', true); // Make other fields read-only if necessary
					loca_addr.removeAttr('required'); 
					empid.removeAttr('required'); 
				    
				} else if (loctypeValue === "BRAN") {
					deptdivname.prop('readonly', true); // Make the field editable
					empid.prop('readonly', true); // Make other fields read-only if necessary
					loca_addr.prop('readonly', false); // Make other fields read-only if necessary
					deptdivname.removeAttr('required'); 
					empid.removeAttr('required'); 
				    
				} else {
					empid.val(''); // Clear the value if not matching any condition
					empid.prop('readonly', true); // Make the field read-only
					loca_addr.val(''); // Clear the value if not matching any condition
					loca_addr.prop('readonly', true); // Make the field read-only
					deptdivname.val(''); // Clear the value if not matching any condition
					deptdivname.prop('readonly', true); // Make the field read-only
					deptdivname.removeAttr('required');
					loca_addr.removeAttr('required');
					empid.removeAttr('required');
				} 
			}
		
			// Call the function on page load to set the correct state
			updateempid();
		
			// Add event listener to the select field to update the state when the value changes
			loctype.change(function() {
				updateempid();
			});
		});
		
		 
		//below is for indian standard amount generation(with ,)

function handleCurrencyChange() {
    const inputs = document.querySelectorAll('input[type="text"]');
    inputs.forEach(input => {
        formatAmount(input);
    });
}

function formatAmount(inputElement) {
    const currency = document.getElementById('asset_currency').value;
    let amount = inputElement.value.replace(/,/g, '').replace(/\./g, '').replace(/[^0-9.]/g, '');

    if (isNaN(amount) || amount === '') {
        return; // Return if input is not a number or is empty
    }

    if (currency === 'INR') {
        formatIndianAmount(inputElement, amount);
    } else {
        formatInternationalAmount(inputElement, amount);
    }
}

function formatIndianAmount(inputElement, amount) {
    let formattedAmount = '';
    let afterDecimal = '';

    if (amount.includes('.')) {
        [amount, afterDecimal] = amount.split('.');
        afterDecimal = '.' + afterDecimal.slice(0, 2); // Limit to 2 decimal places
    }

    let lastThree = amount.slice(-3);
    let otherNumbers = amount.slice(0, -3);

    if (otherNumbers !== '') {
        formattedAmount = otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g, ",") + ',' + lastThree;
    } else {
        formattedAmount = lastThree;
    }

    inputElement.value = formattedAmount + afterDecimal;
}

function formatInternationalAmount(inputElement, amount) {
    let formattedAmount = '';
    let afterDecimal = '';

    if (amount.includes('.')) {
        [amount, afterDecimal] = amount.split('.');
        afterDecimal = ',' + afterDecimal.slice(0, 2); // Use comma for decimal separator in international format
    }

    let formattedNumber = amount.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    formattedAmount = formattedNumber + afterDecimal;

    inputElement.value = formattedAmount;
}




		


	        // Initialize previous book value
    	
	</script>


<script>
function viewItem(acctNo) {
   
    location.href = 'AccountLedger?formmode=ViewAccLedger&acct_num='+ acctNo;
}

$(document)
.ready(
		function() {
			$('.filterable .btn-filter')
					.click(
							function(event) {
								event.preventDefault();
								var $panel = $(this).parents(
										'.filterable'), $filters = $panel
										.find('.filters input'), $tbody = $panel
										.find('.table tbody');
								if ($filters.prop('disabled') == true) {
									$filters
											.prop('disabled', false);
									$filters.first().focus();
								} else {
									$filters.val('').prop(
											'disabled', true);
									$tbody.find('.no-result')
											.remove();
									$tbody.find('tr').show();
								}
							});

			$('.filterable .filters input')
					.keyup(
							function(e) {
								/* Ignore tab key */
								var code = e.keyCode || e.which;
								if (code == '9')
									return;
								/* Useful DOM data and selectors */
								var $input = $(this), inputContent = $input
										.val().toLowerCase(), $panel = $input
										.parents('.filterable'), column = $panel
										.find('.filters th')
										.index($input.parents('th')), $table = $panel
										.find('.table'), $rows = $table
										.find('tbody tr');
								/* Dirtiest filter function ever ;) */
								var $filteredRows = $rows
										.filter(function() {
											var value = $(this)
													.find('td').eq(
															column)
													.text()
													.toLowerCase();
											return value
													.indexOf(inputContent) === -1;
										});
								/* Clean previous no-result if exist */
								$table.find('tbody .no-result')
										.remove();
								/* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
								$rows.show();
								$filteredRows.hide();
								/* Prepend no-result row if all rows are filtered */
								if ($filteredRows.length === $rows.length) {
									$table
											.find('tbody')
											.prepend(
													$('<tr class="no-result text-center"><td colspan="'
															+ $table
																	.find('.filters th').length
															+ '">No result found</td></tr>'));
								}
							});
		});
	
	

	
</script>
<style>
.filterable .filters input[disabled] {
	background-color: transparent;
	border: none;
	cursor: auto;
	box-shadow: none;
	padding: 0;
	height: auto;
}

.filterable .filters input[disabled]::-webkit-input-placeholder {
	color: #333;
}

.filterable .filters input[disabled]::-moz-placeholder {
	color: #333;
}

.filterable .filters input[disabled]:-ms-input-placeholder {
	color: #333;
}

</style>
</head>
<title>BTM</title>

<body>

	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-2">
				<div th:insert="BTMHeaderMenu :: header"></div>
			</div>
			<div class="col-sm-10">

				<div class="container-fluid content" th:if="${formmode} == 'list'">
					<div class="row ml-5">
						<form action="#" method="post" autocomplete="off"
							style="width: 90%;">
							<div class="card">
								<div class="panel panel-primary filterable">
									<div class="card-header1 border-bottom-0"
										style="background-color: #BBC3CB;">
										<div class="float-left">
											<h5
												style="font-family: verdana; font-size: x-large; font-style: inherit;">
												Inventory Master Account Ledger</h5>
										</div>
										<div class="float-right " style="margin-top:-10px">
										<button class="btn text-white btn-filter btn-primary">Filter</button>
										</div>

									</div>
									<div class="card-body">
										<div class="table-responsive" style="max-height: 700px;overflow-y: auto; border: 1px solid #ddd;">
											<table class="table table-sm">
												<thead  style="position: sticky; top: 0;background-color: #f8f9fa; z-index: 2;">
														<tr  class="filters">
														
														
																	<th style="Width:10%"><input type="text" class="form-control"
																		placeholder="Account No" disabled></th>
																	<th style="Width:25%"><input type="text" class="form-control"
																		placeholder="Asset Name" disabled></th>
																	<th style="Width:10%"><input type="text" class="form-control"
																		placeholder="DOP" disabled></th>
																	<th style="Width:7%"><input type="text" class="form-control"
																		placeholder="Asst Crncy" disabled></th>
																	<th style="Width:15%"><input type="text" class="form-control"
																		placeholder="Asst Type" disabled></th>
																	<th style="Width:10%"><input style="text-align: right;" type="text" class="form-control"
																		placeholder="Original Cost" disabled></th>
																	<th style="Width:10%"><input style="text-align: right;" type="text" class="form-control"
																		placeholder="Current Book Value" disabled></th>
																	
														

													</tr>
												</thead>
												<tbody id="associatemonthly">

													<tr th:each="Bamdocmana : ${BAMInventorymaster}">
														<td th:text="${Bamdocmana?.ASST_ACCT_NO}"
															style="text-align: left;cursor: pointer;color:blue"
															th:data-id="${Bamdocmana?.ASST_ACCT_NO}"
															onclick="viewItem(this.getAttribute('data-id'))"
															 onmouseover="this.style.textDecoration='underline'"
															 onmouseout="this.style.textDecoration='none'"></td>
														<td th:text="${Bamdocmana?.ASST_NAME}"></td>
														<td
															th:text="${#dates.format(Bamdocmana?.DATE_OF_PURCHASE, 'dd-MM-yyyy')}"></td>
														<td th:text="${Bamdocmana?.ASST_CRNCY}"></td>
														<td th:text="${Bamdocmana?.ASST_TYPE}"></td>
														<td class="mkt-value"
															th:text="${#numbers.formatDecimal(Bamdocmana?.ORG_COST, 1, 'COMMA', 2, 'POINT')}"
															style="text-align: right;"></td>

														<td class="cur-book-value"
															th:text="${#numbers.formatDecimal(Bamdocmana?.CUR_BOOK_VALUE, 1, 'COMMA', 2, 'POINT')}"
															style="text-align: right;"></td>
														
													</tr>
												</tbody>
											</table>
										</div>
									</div>

									<div class="card-footer text-center">
										<button type="button" class="btn btn-primary" id="btnHome"
											onclick="home()">Home</button>
										

										<button type="button" class="btn btn-primary" id="btnBack"
											onclick="back()">Back</button>

									</div>
								</div>
							</div>
						</form>
					</div>
				</div>

			</div>

		</div>


	</div>
	


	<br>
	


</body>

<script>
	//for the list amount(indian standards)
	document.addEventListener("DOMContentLoaded", function () {
		// Format all cells with class "cur-book-value"
		const curBookValues = document.querySelectorAll('.cur-book-value');
		curBookValues.forEach(cell => {
			formatTableValue(cell);
		});

		// Format all cells with class "mkt-value"
		const mktValues = document.querySelectorAll('.mkt-value');
		mktValues.forEach(cell => {
			formatTableValue(cell);
		});
	});

	function formatTableValue(element) {
		if (element && element.innerText) {
			let amount = element.innerText.replace(/,/g, ''); // Remove existing commas

			if (isNaN(amount) || amount === '') {
				return; // Return if the value is not a number or is empty
			}

			let formattedAmount = '';
			let afterDecimal = '';

			// Split integer and decimal parts
			if (amount.includes('.')) {
				[amount, afterDecimal] = amount.split('.');
				afterDecimal = '.' + afterDecimal;
			}

			// Format the integer part using the Indian system
			let lastThree = amount.slice(-3);
			let otherNumbers = amount.slice(0, -3);

			if (otherNumbers !== '') {
				// Add commas for every two digits in the part before the last three digits
				formattedAmount = otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g, ",") + ',' + lastThree;
			} else {
				formattedAmount = lastThree;
			}

			// Set the formatted value back to the element
			element.innerText = formattedAmount + afterDecimal;
		}
	}
</script>

<script>
function setCurrentDate() {
    var today = new Date();
    var dd = String(today.getDate()).padStart(2, '0');
    var mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
    var yyyy = today.getFullYear();
    var currentDate = dd + '-' + mm + '-' + yyyy; // Format: dd-MM-yyyy
    
    document.getElementById('todate').value = currentDate;
}

	

	function setFirstDate() {
	    var genFlowStrtDate = document.getElementById('genFlowStrtDateHidden').value; 
	    document.getElementById('fromdate').value = genFlowStrtDate;
	}

function openTabview(evt, tabName) {
    // Hide all tabcontent elements
    var tabcontent = document.getElementsByClassName("tabcontent");
    for (var i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    
    // Remove active class from all tablinks
    var tablinks = document.getElementsByClassName("tablinks");
    for (var i = 0; i < tablinks.length; i++) {
        tablinks[i].classList.remove("active");
    }
    
    // Show the current tab and add active class to the button
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.classList.add("active");
    
    // If Account Ledger tab is clicked, set the current date
    if (tabName === 'tab1') {
        setCurrentDate();
        setFirstDate(); // Also set the fromdate if needed
    }
}

// Set the first tab as active by default when page loads
document.addEventListener("DOMContentLoaded", function() {
    // Show only the main content initially
    document.getElementById('mainContent').style.display = "block";
    // Set the first tab button as active
    document.querySelector('.tablinks').classList.add("active");
    
    // Initialize dates if Account Ledger is the default tab
    if (document.getElementById('tab1').style.display === "block") {
        setCurrentDate();
        setFirstDate();
    }
});	

$(function () {
    $("#fromdate").datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: "dd-mm-yy",
        maxDate: 0,
        onSelect: function (selected) {
            var dt = $(this).datepicker('getDate');
            if (dt) {
                dt.setDate(dt.getDate());
                $("#todate").datepicker("option", "minDate", dt);
            }
        }
    });

    $("#todate").datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: "dd-mm-yy",
        maxDate: 0,
        onSelect: function (selected) {
            var fromdate = $("#fromdate").val();
            var todate = $("#todate").val();

            if (!fromdate) {
                alert("Enter From date");
            } else {
                funcall();
            }
        }
    });
});



</script>


</html>