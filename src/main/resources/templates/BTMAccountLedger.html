<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css"
	href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
	th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/font-awesome/5.9.0/css/all.min.css"
	th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
	th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
	th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
<link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">

<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
	th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
	th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
<script src="/webjars/jquery/3.4.1/jquery.min.js"
	th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
	th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>

<script src="/webjars/jquery-form/4.2.2/jquery.form.min.js"
	th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>

<script src="/webjars/jquery-validation/1.19.0/jquery.validate.min.js"
	th:src="@{/webjars/jquery-validation/1.19.0/jquery.validate.min.js}"></script>

<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
<script
	src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>

<script
	src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

<style>
.btns {
	float: right;
	margin: 5px;
}

.col-sm-5 {
	padding-bottom: 15px;
}

.list-body {
	padding: 0px;
}

.error {
	color: red;
	padding-left: 10px;
}

.formline {
	padding-bottom: 4px;
}

#finusertb {
	width: 460px;
}

.dataTables_wrapper .dataTables_paginate .paginate_button {
	padding: 0px;
}

.nav-tabs .nav-item.show .nav-link, .nav-tabs .nav-link.active {
	border: 2px solid skyblue !important;
	border-bottom: unset !important;
	background-color: unset !important;
	color: black !important;
	background-color: unset !important;
}

nav {
	border-bottom: 2px solid grey;
}
.container-manager {
	width: 83.5%;
	padding-right: 15px;
	padding-left: 15px;
	margin-right: auto;
	margin-left: 17.3%;
	margin-top: 80px;
	margin-top: 80px;
}
</style>
<script th:inline="javascript">
	/*<![CDATA[*/

	function home() {
		location.href = 'Dashboard'
	}

	function back() {
		window.history.back();
	}

	function listcharge(a) {
		var acct_num = a.getAttribute("data-acct_num");
		console.log(acct_num);
		location.href = 'AccountLedger?formmode=ViewAccLedger&acct_num='
				+ acct_num;
	}

	$(function () {
	    $("#fromdate").datepicker({
	        changeMonth: true,
	        changeYear: true,
	        dateFormat: "dd-mm-yy",
	        minDate: new Date(2017, 3, 1), 
	        maxDate: 0,
	        
	        onSelect: function (selected) {
	            var dt = $(this).datepicker('getDate');
	            if (dt) {
	                dt.setDate(dt.getDate());
	                $("#todate").datepicker("option", "minDate", dt);
	            }
	        }
	    });

	    var fixedDateStr = "01-04-2025";
	    var maxAllowedDate = new Date(2025, 3, 1); // 01-Apr-2025 (Month is 0-indexed)

	    $("#todate").datepicker({
	        changeMonth: true,
	        changeYear: true,
	        dateFormat: "dd-mm-yy",
	        minDate: new Date(2017, 3, 1), 
	        maxDate: maxAllowedDate, // Allow only dates up to 01-Apr-2025
	        onSelect: function (selected) {
	            var fromdate = $("#fromdate").val();
	            var todate = $("#todate").val();

	            if (!fromdate) {
	                alert("Enter From date");
	            } else {
	                funcall();
	            }
	        }
	    });

	    // Set default value to 01-04-2025
	    $("#todate").val(fixedDateStr);
	});

</script>
<script type="text/javascript">
 
</script>
<style>
  .ui-datepicker {
    z-index: 9999 !important; /* High z-index to stay on top */
  }
</style>

<script type="text/javascript">


   
</script>


<style>
/* Hide the "Part Tran Id" and "Test" columns */
.part-tran-id-col, .test-col {
	display: none;
}
</style>
<script>
function formatDecimal(value, decimalPlaces) {
	    return parseFloat(value).toFixed(decimalPlaces).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
	}
	
function formatDate(dateString) {
	    let date = new Date(dateString);
	    let day = String(date.getDate()).padStart(2, '0'); // Add leading zero if necessary
	    let month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based, so add 1
	    let year = date.getFullYear();
	    return `${day}-${month}-${year}`;
	}




var globalBalance1 = 0.00;



function funcall() { 
		
	    /* updateMinusDate(); */

	   
	    var acctnum = $('#acct_num').val();
	    var fromdate = $('#fromdate').val();
	    var todate = $('#todate').val();

	    // Validate account number and date fields
	    if (!acctnum) {
	        alert("Account number is required");
	        return;
	    }
	    if (!fromdate || !todate) {
	        alert("Both From and To dates are required");
	        return;
	    }

	    // Hide the initial table and show a loading message
	    $('#list1').hide();
	    $('#loadingMessage').show();  // Show loading message

	 // Inside the success function after the balanceData fetch
	    $.ajax({
	        url: './getTransactionBalance',  // API endpoint for balance
	        type: 'GET',
	        data: {
	            acctnum: acctnum,
	            fromdate: fromdate
	        },
	        success: function (balanceData) {
	            console.log("balancedata2:" + balanceData);  // Log the full response

	            let innerArray = balanceData[0];  // The inner array
	            let date1 = innerArray[0];
	            let Obalance = innerArray[1];
	            let formattedDateString = new Date(date1).toLocaleDateString('en-GB');

	            // Format the balance with commas and 2 decimal places
	            let formattedBalance = Obalance.toLocaleString('en-US', {
	                minimumFractionDigits: 2,
	                maximumFractionDigits: 2
	            });

	            let balance = parseFloat(Obalance);

	            // Second AJAX call to get transaction records
	            $.ajax({
	                url: './getTransactionRecords',
	                type: 'GET',
	                data: {
	                    acctnum: acctnum,
	                    fromdate: fromdate,
	                    todate: todate
	                },
	                success: function (data) {
	                    console.log("transaction data:", data);

	                    // Clear the existing table rows
	                    var tableBody = document.getElementById("transactionBody");
	                    tableBody.innerHTML = '';

	                    if (isNaN(parseFloat(formattedBalance))) {
	                        formattedBalance = '0.00';  // Default value if it's NaN
	                    }

	                    // Add opening balance row
	                    let headerHTML = `
	                        <tr>
	                            <td colspan="1"><strong>B/F:</strong> ${formattedDateString}</td>
	                            <td colspan="2"></td>
	                            <td colspan="3"></td>
	                            <td colspan="1" style="text-align:right">${formattedBalance}</td>
	                        </tr>`;
	                    tableBody.innerHTML = headerHTML;

	                    // âœ… Check if no transaction data is returned
	                    if (!data || data.length === 0) {
	                        let noDataRow = `
	                            <tr>
	                                <td colspan="8" style="text-align: center; color: red;">
	                                    No transaction data available for the selected period.
	                                </td>
	                            </tr>`;
	                        tableBody.innerHTML += noDataRow;

	                        $('#loadingMessage').hide();
	                        $('#transactionTable').show();
	                        $('#downloadButton').hide(); // Optionally hide download
	                        return; // Stop processing further
	                    }

	                    // Process transaction records
	                    let transactions = [];
	                    let trHTML = '';

	                    data.forEach(function (record) {
	                        let formattedDate = record.tran_date ? formatDate(record.tran_date) : '';
	                        let debitAmount = (record.part_tran_type === 'debit') ? parseFloat(formatDecimal(record.tran_amt, 2).replace(/,/g, '')) : 0.00;
	                        let creditAmount = (record.part_tran_type === 'credit') ? parseFloat(formatDecimal(record.tran_amt, 2).replace(/,/g, '')) : 0.00;
	                        let tran = (record.tran_id || '') + "/" + (record.part_tran_id || '');

	                        if (record.part_tran_type === 'debit') {
	                            balance -= debitAmount;
	                        } else if (record.part_tran_type === 'credit') {
	                            balance += creditAmount;
	                        }

	                        let absoluteBalance = Math.abs(balance);
	                        let indicator = '';
	                        if (balance < 0) {
	                            indicator = 'DR';
	                        } else if (balance >= 0) {
	                            indicator = 'CR';
	                        }

	                        trHTML += `
	                            <tr>
	                                <td>${formattedDate}</td>
	                                <td>
	                                    <span style="color: #0000EE; text-decoration: underline; cursor: pointer;"
	                                        onclick="showdetails('${record.tran_id}', '${record.part_tran_id}', '${record.acct_num}')">
	                                        ${tran}
	                                    </span>
	                                </td>
	                                <td>${(record.tran_particular || '')}</td>
	                                <td>${(record.acct_crncy || '')}</td>
	                                <td style="text-align:right">${formatDecimal(debitAmount, 2)}</td>
	                                <td style="text-align:right">${formatDecimal(creditAmount, 2)}</td>
	                                <td style="text-align:right">${formatDecimal(absoluteBalance, 2)}</td>
	                                <td style="text-align:right">${indicator}</td>
	                            </tr>`;

	                        transactions.push({ tran, balance });
	                    });

	                    // Append all transaction rows
	                    tableBody.innerHTML += trHTML;

	                    $('#loadingMessage').hide();
	                    $('#transactionTable').show();
	                    $('#downloadButton').show();
	                },
	                error: function (error) {
	                    alert("Error occurred: " + error.responseText);
	                    $('#loadingMessage').hide();
	                }
	            });
	        },
	        error: function (error) {
	            alert("Error occurred while fetching balance: " + error.responseText);
	            $('#loadingMessage').hide();
	        }
	    });

	}
 


// Function to extract balance from alert message
 function getBalanceFromAlert(alertMessage, tran) {
    // Find the start index of the relevant section
    let startIndex = alertMessage.indexOf(`Column 2: ${tran}`);
   
    if (startIndex !== -1) {
        let balanceText = alertMessage.substring(startIndex);
        
        let balanceStartIndex = balanceText.indexOf("Updated Balance: ");
       
        if (balanceStartIndex !== -1) {
            balanceText = balanceText.substring(balanceStartIndex + "Updated Balance: ".length);
            let balanceEndIndex = balanceText.indexOf("\n");
            if (balanceEndIndex === -1) {
                balanceEndIndex = balanceText.length;
            }
            return parseFloat(balanceText.substring(0, balanceEndIndex).replace(/,/g, ''));
        }
    }
    return 0;
} 

	 let globalBalance = 0;
	let formattedAlertMessage = '';  // Global variable to store the formatted alert message

	document.addEventListener("DOMContentLoaded", function() {
	    let rows = document.querySelectorAll("#listvalues tr");
	    let balance = 0;

	    rows.forEach(row => {
	        // Extract values from columns 1 to 7
	        let tran = row.querySelector("td:nth-child(1)").innerText.trim();
	        let col2 = row.querySelector("td:nth-child(2)").innerText.trim();
	        let col3 = row.querySelector("td:nth-child(3)").innerText.trim();
	        let col4 = row.querySelector("td:nth-child(4)").innerText.trim();
	        let debit = parseFloat(row.querySelector("td:nth-child(5) span").innerText.replace(/,/g, '')) || 0;
	        let credit = parseFloat(row.querySelector("td:nth-child(6) span").innerText.replace(/,/g, '')) || 0;
	        let balanceValue = parseFloat(row.querySelector("td:nth-child(7)").innerText.replace(/,/g, '')) || 0;

	        // Update the running balance
	        balance = balance - debit + credit;

	        // Format the alert message for this row
	        let message = `Transaction: ${tran}\n` +
	                      `Column 2: ${col2}\n` +
	                      `Column 3: ${col3}\n` +
	                      `Column 4: ${col4}\n` +
	                      `Debit: ${debit}\n` +
	                      `Credit: ${credit}\n` +
	                      `Balance Value: ${balanceValue}\n` +
	                      `Updated Balance: ${formatDecimal(balance, 2)}`;

	        // Store the message in the global variable
	        formattedAlertMessage += message + '\n\n';  // Append each message with a newline for separation

	        // Set the balance in the last column with formatted number
	        row.querySelector(".balancelist").innerText = new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(balance);
	    });

	    // Store the final balance in the global variable
	    globalBalance = balance;

	}); 


// Function to get the first date from the table and set it in the From Date field
	function setFirstDate() {
		// Get all date elements from the table (Tran Date column)
		var dateElements = document.querySelectorAll('#list1 tbody tr td:nth-child(1) span');
		
		if (dateElements.length > 0) {
			// Retrieve the first date (assuming the table is sorted by date)
			var firstDate = dateElements[0].textContent;

			// Set the first date in the From Date input field
			document.getElementById('fromdate').value = firstDate;
		}
	}


 

window.onload = function() {
		setFirstDate();
		setCurrentDate();
	};

	


	$('#TranBalance').val(formattedBalance);
	/* $('#minusdate').val(previousDate); */
	
	
function Download(format) {
    var a = document.getElementById("acct_num").value;
    var b = document.getElementById("fromdate").value;
    var c = document.getElementById("todate").value;
    var format = format;
    if (!a || !b || !c) {
        alert("Please fill in all fields.");
        return;
    }

    location.href = './accountledgerdownload?acct_num=' + a + '&fromdate=' + b + '&todate=' + c + '&format=' + format;
}



 
  function sendFilteredDataToBackend(transactions) {
	  console.log("transactionstransactionstransactions2222222222222"+ transactions)
      $.ajax({
          url: 'generateReport',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({ transactions: transactions }), // Send the transactions as JSON
          success: function(response) {
              console.log('Transactions successfully sent to backend');
          },
          error: function(jqXHR, textStatus, errorThrown) {
              console.error('Error sending transactions:', textStatus, errorThrown);
          }
      });
  }


</script>


<style>
.filterable .filters input[disabled] {
	background-color: transparent;
	border: none;
	cursor: auto;
	box-shadow: none;
	padding: 0;
	height: auto;
}

.filterable .filters input[disabled]::-webkit-input-placeholder {
	color: #333;
}

.filterable .filters input[disabled]::-moz-placeholder {
	color: #333;
}

.filterable .filters input[disabled]:-ms-input-placeholder {
	color: #333;
}
</style>
<script>
$(document)
.ready(
		function() {
			$('.filterable .btn-filter')
					.click(
							function(event) {
								event.preventDefault();
								var $panel = $(this).parents(
										'.filterable'), $filters = $panel
										.find('.filters input'), $tbody = $panel
										.find('.table tbody');
								if ($filters.prop('disabled') == true) {
									$filters
											.prop('disabled', false);
									$filters.first().focus();
								} else {
									$filters.val('').prop(
											'disabled', true);
									$tbody.find('.no-result')
											.remove();
									$tbody.find('tr').show();
								}
							});

			$('.filterable .filters input')
					.keyup(
							function(e) {
								/* Ignore tab key */
								var code = e.keyCode || e.which;
								if (code == '9')
									return;
								/* Useful DOM data and selectors */
								var $input = $(this), inputContent = $input
										.val().toLowerCase(), $panel = $input
										.parents('.filterable'), column = $panel
										.find('.filters th')
										.index($input.parents('th')), $table = $panel
										.find('.table'), $rows = $table
										.find('tbody tr');
								/* Dirtiest filter function ever ;) */
								var $filteredRows = $rows
										.filter(function() {
											var value = $(this)
													.find('td').eq(
															column)
													.text()
													.toLowerCase();
											return value
													.indexOf(inputContent) === -1;
										});
								/* Clean previous no-result if exist */
								$table.find('tbody .no-result')
										.remove();
								/* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
								$rows.show();
								$filteredRows.hide();
								/* Prepend no-result row if all rows are filtered */
								if ($filteredRows.length === $rows.length) {
									$table
											.find('tbody')
											.prepend(
													$('<tr class="no-result text-center"><td colspan="'
															+ $table
																	.find('.filters th').length
															+ '">No result found</td></tr>'));
								}
							});
		});


</script>
</head>
<title>BTM</title>
<body>
<div class="col-sm-2">
	<div th:insert="BTMHeaderMenu :: header"></div>
	</div>

	<!---------------------User List Ends--------------------------------------------------------->
	<!---------------------User Edit form Starts-------------------------------------------------->
	<div class="container-manager" style="width:80%">
		<div class="row"  >
		<div class="col-sm-11">
		<div th:if="${formmode}=='list'">
		
			<form action="#" method="post" autocomplete="off" >
				<div class="card w-100 h-100 border">
					<div class="panel panel-primary filterable">
					<div class="card-header d-flex justify-content-between panel panel-primary filterable">
						<h4>Account Ledger-Inquiries</h4>
						<div class="float-right">
									<button type="button"
										class="btn text-white btn-filter btn-primary">Filter</button>
								</div>
					</div>
					<div class="card-body p-2">
						<div class="table-responsive" style="max-height: 750px;overflow-y: auto; border: 1px solid #ddd;max-width: 100%">
							<table class="table table-bordered">
								<thead  style="position: sticky; top: 0;background-color: #f8f9fa; z-index: 2;">
									<tr class="filters">
										<th style="width: 7%"><input type="text"
													class="form-control" placeholder="Classification" disabled></th>
												<th style="width: 10%"><input type="text"
													class="form-control" placeholder="Account No" disabled></th>
												<th style="width: 35%"><input type="text"
													class="form-control" placeholder="Account Name" disabled></th>
												<th style="width: 5%"><input type="text"
													class="form-control" placeholder="Cur" disabled></th>
												<th style="width: 10%"><input type="text"
													class="form-control" placeholder="Credits" disabled></th>
												<th style="width: 10%"><input type="text"
													class="form-control" placeholder="Debits" disabled></th>
												<th style="width: 10%"><input type="text"
													class="form-control" placeholder="Balance" disabled></th>
												<th style="width: 7%"><input type="text"
													class="form-control" placeholder="Status" disabled></th>
												<th style="width: 7%"><input type="text"
													class="form-control" placeholder="Select" disabled></th>
									</tr>
								</thead>
								<tbody id="listvalues2" th:each="values : ${AccountLedger}">
									<tr>
										<td><span th:text="${values.classification}"></span></td>
										<td><span th:text="${values.acct_num}"></span></td>
										<td><span th:text="${values.acct_name}"></span></td>
										<td><span th:text="${values.acct_crncy}"></span></td>
										<td><span
											th:text="${values.cr_amt != null && values.cr_amt != 0 ? #numbers.formatDecimal(values.cr_amt, 0, 'COMMA', 2, 'POINT') : '0.00'}"></span></td>

										<td><span
											th:text="${values.dr_amt  != null && values.dr_amt  != 0 ? #numbers.formatDecimal(values.dr_amt , 0, 'COMMA', 2, 'POINT') : '0.00'}"></span></td>


										<td><span
											th:text="${values.acct_bal != null  && values.acct_bal  != 0? #numbers.formatDecimal(values.acct_bal.toString().replace('-', ''), 0, 'COMMA', 2, 'POINT') : '0.00'}"></span></td>
										<th:block th:switch="${values.acct_status}">
											<td th:case="'Y'" style="color: green; text-align: left;">ACTIVE</td>
											<td th:case="'N'" style="color: red; text-align: left;">DEACTIVE</td>
											<td th:case="*">UNKNOWN STATUS</td>
										</th:block>

										<td style="text-align: center;"><input type="radio"
											id="btnclick" name="btnradio" style="cursor: pointer;"
											th:attr="data-acct_num=${values.acct_num}"
											th:id="${values.acct_num}" onclick="listcharge(this)"></td>
								</tbody>
							</table>
						</div>
					</div>
					<div class="card-footer text-center border-top-0 bg-white">
						<button type="button" class="btn btn-primary" id="btnHome"
							onclick="home();">Home</button>
						<button type="button" class="btn btn-primary" id="btnBack"
							onclick="home();">Back</button>
					</div>
				</div>
				</div>
			</form>
			</div>
			</div>
		</div>
		<!-------- -------------------------view--------------------------------------------- -->


		<div th:if="${formmode}=='ViewAccLedger'">

			<div class="row" style="width: 1500px; height: 200px">

				<div class="col-sm-12"
					style="margin-left: 3px; width: 1500px; height: 330px">

					<div class="card w-100 h-100 border" style="width: 1800px;margin:0px;padding:0px;" >
						<div class="card-header">
							<div>
								<div class="float-left">
									<h5>ACCOUNT LEDGER</h5>
								</div>
								 <div class="float-right" id="downloadButton"
									>
									<div class="btn-group">
										<button type="button" class="btn btn-primary dropdown-toggle"
											data-toggle="dropdown" aria-haspopup="true"
											aria-expanded="false">Download</button>
										<div class="dropdown-menu">
											<span class="dropdown-item" onclick="Download('xlsx')"
												id='xlsx'>Download Excel</span> <span
												class="dropdown-item" onclick="Download('csv')"
												id='csv'>Download CSV</span>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="card-body" >
							<form action="#" id="" th:object="${Accountvalue}">
								<div class="w-100 h-100">

									<div class="row formline">
										<div class="col-sm-1"></div>
										<div class="col-sm-2">Account No</div>
										<div class="col-sm-2">
											<input type="text" name="acct_num" id="acct_num"
												class="form-control-sm" th:value="${Accountvalue?.acct_num}"
												readonly />
										</div>
										<div class="col-sm-1"></div>
										<div class="col-sm-1"></div>
										<div class="col-sm-2">Account Name</div>
										<div class="col-sm-2">
											<input type="text" name="acct_name" id="acct_name"
												class="form-control-sm"
												th:value="${Accountvalue?.acct_name}" readonly>
										</div>
									</div>

									<div class="row formline" >
										<div class="col-sm-1"></div>
										<div class="col-sm-2">Account Currency</div>
										<div class="col-sm-2">
											<input type="text" name="acct_crncy" id="acct_crncy"
												class="form-control-sm"
												th:value="${Accountvalue?.acct_crncy}" readonly />

										</div>
										<div class="col-sm-1"></div>
										<div class="col-sm-1"></div>
										<div class="col-sm-2">Account Balance</div>
										<div class="col-sm-2">
											<input type="text" name="acct_bal" id="acct_bal"
												class="form-control-sm"
												th:value="${Accountvalue?.acct_bal != null && Accountvalue?.acct_bal != 0 ? 
                      #numbers.formatDecimal(Accountvalue?.acct_bal.toString().replace('-', ''), 0, 'COMMA', 2, 'POINT') : 
                      '0.00'}"
												readonly />
										</div>

									</div>
								</div>

								<div class="row formline" >
									<div class="col-sm-1"></div>
									<div class="col-sm-2">General Ledger</div>
									<div class="col-sm-2">
										<input type="text" name="gl_code" id="gl_code"
											class="form-control-sm" th:value="${Accountvalue?.gl_code}"
											readonly />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1"></div>
									<div class="col-sm-2">GL Description</div>
									<div class="col-sm-2">
										<input type="text" name="gl_desc" id="gl_desc"
											class="form-control-sm" th:value="${Accountvalue?.gl_desc}"
											readonly />
									</div>
								</div>
								<div class="row formline" >
									<div class="col-sm-1"></div>
									<div class="col-sm-2">GL Sub Head</div>
									<div class="col-sm-2">
										<input type="text" name="glsh_code" id="glsh_code"
											class="form-control-sm" th:value="${Accountvalue?.glsh_code}"
											readonly />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1"></div>
									<div class="col-sm-2">GL Sub Head Description</div>
									<div class="col-sm-2">
										<input type="text" name="glsh_desc" id="glsh_desc"
											class="form-control-sm" th:value="${Accountvalue?.glsh_desc}"
											readonly />
									</div>
								</div>
								<div class="row formline" >
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Ref Currency</div>
									<div class="col-sm-2">
										<input type="text" name="ref_crncy" id="ref_crncy"
											class="form-control-sm" th:value="${Accountvalue?.ref_crncy}"
											readonly />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Ref Currency Balance</div>
									<div class="col-sm-2">

										<input type="text" name="ref_crncy_bal" id="ref_crncy_bal"
											class="form-control-sm"
											th:value="${Accountvalue?.ref_crncy_bal != null && Accountvalue?.ref_crncy_bal != 0 ? 
                      #numbers.formatDecimal(Accountvalue?.ref_crncy_bal.toString().replace('-', ''), 0, 'COMMA', 2, 'POINT') : 
                      '0.00'}"
											readonly />
									</div>
								</div>
								<div class="row formline" >
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Account Type</div>
									<div class="col-sm-2">
										<input type="text" name="acct_type" id="acct_type"
											class="form-control-sm" th:value="${Accountvalue?.acct_type}"
											readonly />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Account Status</div>
									<div class="col-sm-2">
										<input type="text" name="acct_status" id="acct_status"
											class="form-control-sm"
											th:value="${Accountvalue?.acct_status == 'Y' ? 'ACTIVE' : (Accountvalue?.acct_status == 'N' ? 'DEACTIVE' : 'UNKNOWN STATUS')}"
											readonly />
									</div>
								</div>
								<div class="row formline">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">From Date</div>
									<div class="col-sm-2">
										<input type="text" id="fromdate" class="form-control-sm"
											readonly />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1"></div>
									<div class="col-sm-2">To Date</div>
									<div class="col-sm-2">
										<input type="text" name="todate" id="todate"
											class="form-control-sm" onchange="funcall()" />
									</div>
								</div>
								</form>
						</div>
						
						<!-- ----------------------------------------------------------------------------------------------------- -->
						<div class="card-body "  style="margin:0px;padding:0px;" >
							<div class="table-responsive " style="max-height: 500px;overflow-y: auto; border: 1px solid #ddd;">
								<table class="table table-bordered " id="list1" >
									<thead  style="position: sticky; top: 0;background-color: #f8f9fa; z-index: 2;">
										<tr class="filters">
											<th>Tran Date</th>
											<th>Tran Id</th>
											<th>Tran Particulars</th>
											<th>Currency</th>
											<th style="text-align:right">Debits</th>
											<th style="text-align:right">Credits</th>
											<th style="text-align:right">Balance</th>

										</tr>
									</thead>
									<tbody id="listvalues" th:each="values, iterStat : ${AccList}">
										<tr style="line-height:0px;">
											<td><span
												th:text="${#dates.format(values.tran_date, 'dd-MM-yyyy')}"></span></td>
												<td>
												  <span style="color: #0000EE; text-decoration: underline; cursor: pointer;"
												        th:text="${values.tran_id} + '/' + ${values.part_tran_id}"
												        th:attr="onclick=|showdetails('${values.tran_id}', '${values.part_tran_id}', '${values.acct_num}')|">
												  </span>
												</td>
 
											

											<td><span th:text="${values.tran_particular}"></span></td>
											<td><span th:text="${values.acct_crncy}"></span></td>
											<td style="text-align:right"><span
												th:text="${values.part_tran_type == 'debit' ? #numbers.formatDecimal(values.tran_amt, 1, 'COMMA', 2, 'POINT') : '0.00'}"></span></td>
											<td style="text-align:right"><span
												th:text="${values.part_tran_type == 'credit' ? #numbers.formatDecimal(values.tran_amt, 1, 'COMMA', 2, 'POINT') : '0.00'}"></span></td>
											<td style="text-align:right"><span class="balancelist" th:text="0.00"></span></td>
										</tr>
									</tbody>
								</table>

							</div>
						</div>
						
						<!-- -------------------------------------------------------------------------------------- -->

						<div id="loadingMessage" style="display: none;">Loading,
							please wait...</div>

						<div class="row formline" style="display: none;"
							id="invisibledate">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Previous Date</div>
							<div class="col-sm-2">
								<input type="text" id="minusdate" class="form-control-sm"
									th:text="${#dates.format(Accountvalue1, 'dd-MM-yyyy')}"> readonly />
							</div>
							
							<div class="col-sm-1"></div>
							<div class="col-sm-2"></div>
							<div class="col-sm-2">Opening Balance</div>
							<div class="col-sm-2">
								<input class="form-control-sm" id="TranBalance" readonly />
							</div>
						</div>
						<!-- Table to display transaction records -->
						<table class="table" id="transactionTable"
							style="display: none;margin:0px;padding:0px;">
							<thead>
								<tr style="line-height: 0px">
									<th >Tran Date</th>
									<th >Tran Id</th>
									<th >Tran Particulars</th>
									<th >Currency</th>
									<th style="text-align:right">Debits</th>
									<th style="text-align:right">Credits</th>
									<th style="text-align:right">Balance</th>
									<th style="text-align:right">Indicator</th>
								</tr>
							</thead>
							<tbody id="transactionBody">
								<!-- This row is for Previous Date and Opening Balance -->
								<tr>

								</tr>
							</tbody>
						</table>
						<!---------------------------------------------------------------------------------------------------->
						<div class="card-footer text-center"
							style="background-color: #e9ecef">
							<button class="btn btn-primary" onclick="Home();">Home</button>
							<button class="btn btn-primary" onclick="back();">Back</button>
						</div>


					</div>

				</div>
			</div>
		</div>
		
		
		
		
		
		<div th:if="${formmode}=='view'">

					<div class="card border" style="width: 1400px;">
						<div class="card-header"
							style="background-color: #e9ecef; height: 50px">
							<div
								class="d-flex justify-content-between align-items-center h-100">
								<!-- Left side: Title -->
								<div class="float-left">
									<h6 style="font-size: 1.2rem; color: black;">JOURNAL
										ENTRIES-VIEW</h6>
								</div>
							</div>

						</div>
						<div class="card-body">

							<form class=" border border-secondary" method="post"
								id="journaladd" autocomplete="off">

								<div class="row formline" style="padding: 15px 0px 2px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Tran Id</div>

									<div class="col-sm-2">
										<input type="text" name="tran_id" id="tran_id"
											th:value="${ledgervalues.tran_id}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Part Tran Id</div>
									<div class="col-sm-2">

										<input type="text" name="part_tran_id" id="part_tran_id"
											th:value="${ledgervalues.part_tran_id}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-2"></div>
								</div>

								<div class="row formline" style="padding: 0px 0px 2px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Acct NO</div>

									<div class="col-sm-2">
										<div class="input-group">
											<input type="text" name="acct_num" id="acct_num"
												th:value="${ledgervalues.acct_num}"
												class="form-control form-control-sm bg-white border border-dark"
												readonly />
										</div>
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Acct Name</div>
									<div class="col-sm-2">


										<input type="text" name="acct_name" id="acct_name"
											th:value="${ledgervalues.acct_name}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />
									</div>
									<div class="col-sm-2"></div>
								</div>

								<div class="row formline" style="padding: 0px 0px 2px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Tran Type</div>


									<div class="col-sm-2">
										<input type="text" name="tran_type" id="tran_type"
											th:value="${ledgervalues.tran_type}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />
									</div>

									<div class="col-sm-1"></div>
									<div class="col-sm-2">Part Tran Type</div>
									<div class="col-sm-2">
										<input type="text" name="part_tran_type" id="part_tran_type"
											th:value="${ledgervalues.part_tran_type}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />
									</div>
									<div class="col-sm-2"></div>
								</div>


								<div class="row formline" style="padding: 0px 0px 2px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Account Currency</div>


									<div class="col-sm-2">
										<input type="text" name="acct_crncy" id="acct_crncy"
											th:value="${ledgervalues.acct_crncy}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />
									</div>

									<div class="col-sm-1"></div>
									<div class="col-sm-2">Tran Amt</div>
									<div class="col-sm-2">

										<input type="text" name="tran_amt1" id="tran_amt"
											th:value="${ledgervalues.tran_amt}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-2"></div>
								</div>

								<div class="row formline" style="padding: 0px 0px 2px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Tran Particulars</div>


									<div class="col-sm-2">
										<input type="text" placeholder="" name="tran_particular"
											id="tran_particular" th:value="${ledgervalues.tran_particular}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Tran Remarks</div>
									<div class="col-sm-2">

										<input type="text" name="tran_remarks" id="tran_remarks"
											th:value="${ledgervalues.tran_remarks}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-2"></div>
								</div>

								<div class="row formline" style="padding: 0px 0px 2px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Flow Code</div>


									<div class="col-sm-2">
										<input type="text" name="flow_code" id="gst_amount"
											th:value="${ledgervalues.gst_amount}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>

									<div class="col-sm-1"></div>
									<div class="col-sm-2">Flow Date</div>
									<div class="col-sm-2">

										<input type="text" placeholder="" name="flow_date" id="gst_type"
											th:value="${ledgervalues.gst_type}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-2"></div>
								</div>

								<div class="row formline" style="padding: 0px 0px 2px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Tran Date</div>


									<div class="col-sm-2">

										<input type="text" name="tran_date" id="tran_date"
											th:value="${#dates.format(ledgervalues.tran_date, 'dd-MM-yyyy')}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>

									<div class="col-sm-1"></div>
									<div class="col-sm-2">Value Date</div>
									<div class="col-sm-2">


										<input type="text" name="value_date" id="value_date"
											th:value="${#dates.format(ledgervalues.value_date, 'dd-MM-yyyy')}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />
									</div>
									<div class="col-sm-2"></div>
								</div>

								<div class="row formline" style="padding: 0px 0px 2px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Tran Code</div>


									<div class="col-sm-2">
										<input type="text" name="tran_code" id="tran_code"
											th:value="${ledgervalues.tran_code}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Tran Report Code</div>
									<div class="col-sm-2">

										<input type="text" name="tran_rpt_code" id="tran_rpt_code"
											th:value="${ledgervalues.tran_rpt_code}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-2"></div>
								</div>

								<div class="row formline" style="padding: 0px 0px 2px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Tran Ref NO</div>


									<div class="col-sm-2">
										<input type="text" name="tran_ref_no" id="tran_ref_no"
											th:value="${ledgervalues.tran_ref_no}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>

									<div class="col-sm-1"></div>
									<div class="col-sm-2">Additional Details</div>
									<div class="col-sm-2">

										<input type="text" name="add_details" id="add_details"
											th:value="${ledgervalues.add_details}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-2"></div>
								</div>

								<div class="row formline" style="padding: 0px 0px 2px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Partition Type</div>


									<div class="col-sm-2">
										<input type="text" name="partition_type" id="partition_type"
											th:value="${ledgervalues.partition_type}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>

									<div class="col-sm-1"></div>
									<div class="col-sm-2">Partition Details</div>
									<div class="col-sm-2">

										<input type="text" name="partition_det" id="partition_det"
											th:value="${ledgervalues.partition_det}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-2"></div>
								</div>

								<div class="row formline" style="padding: 0px 0px 2px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Instrument NO</div>


									<div class="col-sm-2">
										<input type="text" name="instr_num" id="instr_num"
											th:value="${ledgervalues.instr_num}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Instrument Date</div>
									<div class="col-sm-2">

										<input type="text" name="instr_date" id="instr_date"
											th:value="${ledgervalues.instr_date}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-2"></div>
								</div>

								<div class="row formline" style="padding: 0px 0px 2px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Account Currency</div>


									<div class="col-sm-2">
										<input type="text" name="ref_crncy" id="ref_crncy"
											th:value="${ledgervalues.ref_crncy}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>

									<div class="col-sm-1"></div>
									<div class="col-sm-2">Home Currency Amount</div>
									<div class="col-sm-2">

										<input type="text" name="ref_crncy_amt" id="ref_crncy_amt"
											th:value="${ledgervalues.ref_crncy_amt}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-2"></div>
								</div>

								<div class="row formline" style="padding: 0px 0px 2px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Rate Code</div>


									<div class="col-sm-2">
										<input type="text" name="rate_code" id="rate_code"
											th:value="${ledgervalues.rate_code}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>

									<div class="col-sm-1"></div>
									<div class="col-sm-2">Rate</div>
									<div class="col-sm-2">


										<input type="text" name="rate" id="rate"
											th:value="${ledgervalues.rate}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />
									</div>
									<div class="col-sm-2"></div>
								</div>

								<div class="row formline" style="padding: 0px 0px 10px 50px;">
									<div class="col-sm-1"></div>
									<div class="col-sm-2">Tran Status</div>


									<div class="col-sm-2">
										<input type="text" name="tran_status" id="tran_status"
											th:value="${ledgervalues.tran_status}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>

									<div class="col-sm-1"></div>
									<div class="col-sm-2">Deleted</div>
									<div class="col-sm-2">

										<input type="text" placeholder="" name="del_flg" id="del_flg"
											th:value="${ledgervalues.del_flg}"
											class="form-control form-control-sm bg-white border border-dark"
											readonly />

									</div>
									<div class="col-sm-2"></div>
								</div>

								<div
									class="d-flex justify-content-end align-items-center mr-3 mb-2">
									<button id="previous-btn" class="btn btn-primary me-2"
										onclick="getPartTranRecords(this);">Previous</button>
									<span class="mx-1" th:text="${currentPartTran}"
										id="currentPartTran"></span> <span class="mx-1">/</span> <span
										class="mx-1" id="maxPartTran" th:text="${maxPartTran}"></span>
									<button id="next-btn" class="btn btn-primary ms-2"
										onclick="getPartTranRecords(this);">Next</button>
								</div>
								<br>
								<div class="table-responsive">
									<table class="table  table-bordered table-sm d-none"
										style="margin-bottom: 0px; font-size: initial; width: 100%;"
										id="transactionaccountvalues">
										<thead class="thead-light">
											<tr>
												<th style="text-align: left; width: 20%;">GENERAL LEDGER</th>
												<th style="text-align: left; width: 20%;">GL SUB HEAD</th>
												<th style="text-align: left; width: 20%;">CRNCY</th>
												<th style="text-align: center; width: 20%;">ACCOUNT
													BALANCE</th>
												<th style="text-align: left; width: 20%;">BALANCE IND</th>
											</tr>
										</thead>
										<tbody id="transactionaccountvaluesbody">


										</tbody>
									</table>
								</div>

								<div class="table-responsive">
									<table class="table  table-bordered table-sm d-none"
										style="margin-bottom: 0px; font-size: initial; table-layout: fixed; width: 100%;"
										id="transactionTable">
										<thead class="thead-light">

											<tr>
												<th style="text-align: center">TRAN DATE</th>
												<th style="text-align: center">TRAN ID</th>
												<th style="text-align: center">PA TRAN TY</th>
												<th style="text-align: center">CURRENCY</th>
												<th style="text-align: center">AMOUNT</th>
												<th style="text-align: center">ACCT NUM</th>
												<th style="text-align: center; width: 20%;">ACCT NAME</th>
												<th style="text-align: center; width: 20%;">TRAN
													PARTICULAR</th>
												<th style="text-align: center">STATUS</th>

											</tr>
										</thead>
										<tbody id="transactionTableBody">


										</tbody>
									</table>
								</div>




							</form>

							<div class="table-responsive">
								<table class="table table-bordered table-hover table-sm d-none"
									style="margin-bottom: 0px; font-size: initial; table-layout: fixed; width: 100%;"
									id="usertablevalues">
									<thead class="thead-light">
										<tr>
											<th style="text-align: left">TRAN DATE</th>
											<th style="text-align: left">TRAN ID</th>
											<th style="text-align: left">PA TRAN TY</th>
											<th style="text-align: left">CURRENCY</th>
											<th style="text-align: right">AMOUNT</th>
											<th style="text-align: left">ACCT NUM</th>
											<th style="text-align: left; width: 20%;">ACCT NAME</th>
											<th style="text-align: left">STATUS</th>
											<th style="text-align: center">SELECT</th>
										</tr>
									</thead>
									<tbody id="placelist">
										<tr th:each="details : ${jour}">
											<td
												th:text="${details.tran_date != null ? #dates.format(details.tran_date,'dd-MM-yyyy') : ''}">
											</td>
											<td
												th:text="${details.tran_id} + '/' + ${details.part_tran_id}"></td>
											<td th:text="${details.part_tran_type}"></td>
											<td th:text="${details.acct_crncy}"></td>
											<td style="text-align: right;"
												th:text="${details?.tran_amt == 0 ? '0.00' : #numbers.formatDecimal(details?.tran_amt, 0, 'COMMA', 2, 'POINT')}">
											</td>
											<td th:text="${details.acct_num}"></td>
											<td th:text="${details.acct_name}"></td>
											<td th:text="${details.tran_status}"></td>
											<td style="text-align: center;"><input type="radio"
												id="radioSelect" name="actionRadio"
												th:attr="data-tranid=${details.tran_id}, data-partnid=${details.part_tran_id}, data-acctnum=${details.acct_num}"
												onclick="selectActions(this);"></td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<div class="card-footer text-center"
							style="background-color: #e9ecef">


							<button class="btn btn-primary p-2" onclick="home();">Home</button>
							<button class="btn btn-primary p-2" onclick="views(this);">View</button>
							<button class="btn btn-primary p-2" onclick="back();">Back</button>


						</div>

					</div>
				</div>
	</div>

	</div>
	
<script type="text/javascript">


function back() {
	window.history.back();
}


function showdetails(tranId, partTranId,acct_num){
	console.log("tranId"+tranId);
		console.log("partTranId"+partTranId);
		console.log("Acct_num"+acct_num);
		
	var url = 'AccountLedger?formmode=view&tranId=' + tranId
						+ '&partTranId=' + partTranId + '&acct_num=' + acct_num; 
	location.href = url;
}

function formatNumberWithCommas(number) {

		if (!number && number !== 0) return '';
		console.log("number : " + number);
		let numberString = number.toString();
		console.log("numberString : " + numberString);

		let [integerPart, decimalPart] = numberString.split('.');

		let lastThreeDigits = integerPart.slice(-3);
		let otherDigits = integerPart.slice(0, -3);

		if (otherDigits !== '') {
			lastThreeDigits = ',' + lastThreeDigits;
		}

		let formattedIntegerPart = otherDigits.replace(/\B(?=(\d{2})+(?!\d))/g, ',') + lastThreeDigits;

		if (!decimalPart) {
			decimalPart = '00';
		}
		let formattedNumber = formattedIntegerPart + '.' + decimalPart;
		console.log("formattedIntegerPart : " + formattedIntegerPart);
		console.log("decimalPart : " + decimalPart);

		return formattedNumber;
	}
	function views() {
		var lkg = document.getElementById("usertablevalues");
		lkg.classList.remove('d-none'); // Remove the 'd-none' class to show the table 
	}
	function selectActions(element) {
			var tranId = $(element).attr('data-tranid');
			var partnId = $(element).attr('data-partnid');
			var acctNum = $(element).attr('data-acctnum');
			console.log(tranId+" "+partnId+" "+acctNum);
			 $.ajax({
				type: 'GET',
				url: './transactionaccountdetailsvalues',
				data: {
					tranId: tranId,
					partnId: partnId,
					acctNum: acctNum
				},
				success: function (data) {
					
					$("#tran_id").val(data.tran_id);
					$("#part_tran_id").val(data.part_tran_id);
					$("#acct_num").val(data.acct_num);
					$("#acct_name").val(data.acct_name);
					$("#tran_type").val(data.tran_type);
					$("#part_tran_type").val(data.part_tran_type);
					$("#acct_crncy").val(data.acct_crncy);
					$("#tran_amt").val(data.tran_amt);
					$("#tran_particular").val(data.tran_particular);
					$("#tran_remarks").val(data.tran_remarks);
					$("#gst_amount").val(data.gst_amount);
					$("#gst_type").val(data.gst_type);
					$("#tran_code").val(data.tran_code);
					$("#tran_rpt_code").val(data.tran_rpt_code);
					$("#tran_ref_no").val(data.tran_ref_no);
					$("#add_details").val(data.add_details);
					$("#partition_type").val(data.partition_type);
					$("#partition_det").val(data.partition_det);
					$("#instr_num").val(data.instr_num);
					$("#ref_crncy").val(data.ref_crncy);
					$("#ref_crncy_amt").val(data.ref_crncy_amt);
					$("#rate_code").val(data.rate_code);
					$("#rate").val(data.rate);
					$("#entry_user").val(data.entry_user);
					$("#post_user").val(data.post_user);
					$("#tran_status").val(data.tran_status);
					$("#del_flg").val(data.del_flg);
				},
				error: function () {
					$('#errorMessage').text('Error fetching data');
					$('#errorModal').modal('show');
					alert("get values error")
				}
			}); 
		}	
	function formatDateToDD(dateString) {
				var date = new Date(dateString);

				var day = date.getDate();
				// Use date.getMonth() + 1 to get the correct month (1-12)
				var month = date.getMonth() + 1; // Add 1 to adjust for zero-indexed months
				var year = date.getFullYear();

				if (day < 10) {
					day = '0' + day;
				}
				if (month < 10) {
					month = '0' + month; // Ensure month is two digits
				}

				return day + '-' + month + '-' + year;
			}
function getPartTranRecords(button) {
		event.preventDefault();

		const currentPartTran = parseInt(document.getElementById('currentPartTran').innerText);
		console.log("currentPartTran"+currentPartTran);
		
		const maxPartTran = parseInt(document.getElementById('maxPartTran').innerText);
		console.log("maxPartTran"+maxPartTran);
		var tranId = $("#tran_id").val();
		console.log("tranId"+tranId);
		let partTranId = currentPartTran;
		console.log("partTranId"+partTranId);
		
		if (button.id === 'previous-btn') {

			
			if (currentPartTran > 1) {
				/*previous record*/
				partTranId = currentPartTran - 1;
				document.getElementById('currentPartTran').innerText = partTranId;

				$("#tran_id").val("");
				$("#part_tran_id").val("");
				$("#acct_num").val("");
				$("#acct_name").val("");
				$("#tran_type").val("");
				$("#part_tran_type").val("");
				$("#acct_crncy").val("");
				$("#tran_amt").val("");
				$("#tran_particular").val("");
				$("#tran_remarks").val("");
				$("#gst_amount").val("");
				$("#gst_type").val("");
				$("#tran_code").val("");
				$("#tran_rpt_code").val("");
				$("#tran_ref_no").val("");
				$("#add_details").val("");
				$("#partition_type").val("");
				$("#partition_det").val("");
				$("#instr_num").val("");
				$("#ref_crncy").val("");
				$("#ref_crncy_amt").val("");
				$("#rate_code").val("");
				$("#rate").val("");
				$("#entry_user").val("");
				$("#post_user").val("");
				$("#tran_status").val("");
				$("#del_flg").val("");
				$("#value_date").val("");
				$("#tran_date").val("");
				$("#entry_time").val("");
				$("#post_time").val("");
				$("#srl_no").val("");



				$.ajax({
					type: 'GET',
					url: './transactionValues',
					data: {
						tran_id: tranId,
						part_tran_id: partTranId

					},
					success: function (data) {
						console.log(data);
						console.log("dat"+data.tran_amt);
						$("#tran_id").val(data.tran_id != null ? data.tran_id : "");
						$("#part_tran_id").val(data.part_tran_id != null ? data.part_tran_id : "");
						$("#acct_num").val(data.acct_num != null ? data.acct_num : "");
						$("#acct_name").val(data.acct_name != null ? data.acct_name : "");
						$("#tran_type").val(data.tran_type != null ? data.tran_type : "");
						$("#part_tran_type").val(data.part_tran_type != null ? data.part_tran_type : "");
						$("#acct_crncy").val(data.acct_crncy != null ? data.acct_crncy : "");
					
						$("#tran_amt").val(data.tran_amt != null ? formatNumberWithCommas(data.tran_amt) : "");
						
						$("#tran_particular").val(data.tran_particular != null ? data.tran_particular : "");
						$("#tran_remarks").val(data.tran_remarks != null ? data.tran_remarks : "");
						$("#gst_amount").val(data.flow_code != null ? data.flow_code : "");
						$("#gst_type").val(data.flow_date != null ? formatDateToDD(data.flow_date) : "");
						$("#tran_code").val(data.tran_code != null ? data.tran_code : "");
						$("#tran_rpt_code").val(data.tran_rpt_code != null ? data.tran_rpt_code : "");
						$("#tran_ref_no").val(data.tran_ref_no != null ? data.tran_ref_no : "");
						$("#add_details").val(data.add_details != null ? data.add_details : "");
						$("#partition_type").val(data.partition_type != null ? data.partition_type : "");
						$("#partition_det").val(data.partition_det != null ? data.partition_det : "");
						$("#instr_num").val(data.instr_num != null ? data.instr_num : "");
						$("#ref_crncy").val(data.ref_crncy != null ? data.ref_crncy : "");
						$("#ref_crncy_amt").val(data.ref_crncy_amt != null ? data.ref_crncy_amt : "");
						$("#rate_code").val(data.rate_code != null ? data.rate_code : "");
						$("#rate").val(data.rate != null ? data.rate : "");
						$("#entry_user").val(data.entry_user != null ? data.entry_user : "");
						$("#post_user").val(data.post_user != null ? data.post_user : "");
						$("#tran_status").val(data.tran_status != null ? data.tran_status : "");
						$("#del_flg").val(data.del_flg != null ? data.del_flg : "");
						$("#value_date").val(data.value_date != null ? formatDateToDD(data.value_date) : "");
						$("#tran_date").val(data.tran_date != null ? formatDateToDD(data.tran_date) : "");
						$("#entry_time").val(data.entry_time != null ? formatDateToDD(data.entry_time) : "");
						$("#post_time").val(data.post_time != null ? formatDateToDD(data.post_time) : "");
						$("#srl_no").val(data.srl_no != null ? data.srl_no : "");
					},
					error: function () {
						$('#errorMessage').text('Error fetching data');
						$('#errorModal').modal('show');
					}
				});
			} else {
				alert('This is the first record!');
				return;
			}
		} else if (button.id === 'next-btn') {

			if (currentPartTran < maxPartTran) {
				/*next record*/
				
				partTranId = currentPartTran + 1;
				document.getElementById('currentPartTran').innerText = partTranId;


				$("#tran_id").val("");
				$("#part_tran_id").val("");
				$("#acct_num").val("");
				$("#acct_name").val("");
				$("#tran_type").val("");
				$("#part_tran_type").val("");
				$("#acct_crncy").val("");
				$("#tran_amt").val("");
				$("#tran_particular").val("");
				$("#tran_remarks").val("");
				$("#gst_amount").val("");
				$("#gst_type").val("");
				$("#tran_code").val("");
				$("#tran_rpt_code").val("");
				$("#tran_ref_no").val("");
				$("#add_details").val("");
				$("#partition_type").val("");
				$("#partition_det").val("");
				$("#instr_num").val("");
				$("#ref_crncy").val("");
				$("#ref_crncy_amt").val("");
				$("#rate_code").val("");
				$("#rate").val("");
				$("#entry_user").val("");
				$("#post_user").val("");
				$("#tran_status").val("");
				$("#del_flg").val("");
				$("#value_date").val("");
				$("#tran_date").val("");
				$("#entry_time").val("");
				$("#post_time").val("");
				$("#srl_no").val("");



				$.ajax({
					type: 'GET',
					url: './transactionValues',
					data: {
						tran_id: tranId,
						part_tran_id: partTranId

					},
					success: function (data) {
						console.log(data);

						$("#tran_id").val(data.tran_id != null ? data.tran_id : "");
						$("#part_tran_id").val(data.part_tran_id != null ? data.part_tran_id : "");
						$("#acct_num").val(data.acct_num != null ? data.acct_num : "");
						$("#acct_name").val(data.acct_name != null ? data.acct_name : "");
						$("#tran_type").val(data.tran_type != null ? data.tran_type : "");
						$("#part_tran_type").val(data.part_tran_type != null ? data.part_tran_type : "");
						$("#acct_crncy").val(data.acct_crncy != null ? data.acct_crncy : "");
						$("#tran_amt").val(data.tran_amt != null ? formatNumberWithCommas(data.tran_amt) : "");
						$("#tran_particular").val(data.tran_particular != null ? data.tran_particular : "");
						$("#tran_remarks").val(data.tran_remarks != null ? data.tran_remarks : "");
						$("#gst_amount").val(data.flow_code != null ? data.flow_code : "");
						$("#gst_type").val(data.flow_date != null ? formatDateToDD(data.flow_date) : "");
						$("#tran_code").val(data.tran_code != null ? data.tran_code : "");
						$("#tran_rpt_code").val(data.tran_rpt_code != null ? data.tran_rpt_code : "");
						$("#tran_ref_no").val(data.tran_ref_no != null ? data.tran_ref_no : "");
						$("#add_details").val(data.add_details != null ? data.add_details : "");
						$("#partition_type").val(data.partition_type != null ? data.partition_type : "");
						$("#partition_det").val(data.partition_det != null ? data.partition_det : "");
						$("#instr_num").val(data.instr_num != null ? data.instr_num : "");
						$("#ref_crncy").val(data.ref_crncy != null ? data.ref_crncy : "");
						$("#ref_crncy_amt").val(data.ref_crncy_amt != null ? data.ref_crncy_amt : "");
						$("#rate_code").val(data.rate_code != null ? data.rate_code : "");
						$("#rate").val(data.rate != null ? data.rate : "");
						$("#entry_user").val(data.entry_user != null ? data.entry_user : "");
						$("#post_user").val(data.post_user != null ? data.post_user : "");
						$("#tran_status").val(data.tran_status != null ? data.tran_status : "");
						$("#del_flg").val(data.del_flg != null ? data.del_flg : "");
						$("#value_date").val(data.value_date != null ? formatDateToDD(data.value_date) : "");
						$("#tran_date").val(data.tran_date != null ? formatDateToDD(data.tran_date) : "");
						$("#entry_time").val(data.entry_time != null ? formatDateToDD(data.entry_time) : "");
						$("#post_time").val(data.post_time != null ? formatDateToDD(data.post_time) : "");
						$("#srl_no").val(data.srl_no != null ? data.srl_no : "");
					},
					error: function () {
						$('#errorMessage').text('Error fetching data');
						$('#errorModal').modal('show');
					}
				});
			} else {
				alert('This is the last record!');
				return;
			}
		}


		console.log('Navigating to partTranId:', partTranId);

	}
</script>
</body>
</html>