<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css"
	href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
	th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/font-awesome/5.9.0/css/all.min.css"
	th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
	th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
	th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
<link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">

<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
	th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
	th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
<script src="/webjars/jquery/3.4.1/jquery.min.js"
	th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
	th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>
<script src="/webjars/jquery-form/4.2.2/jquery.form.min.js"
	th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>
<script src="/webjars/jquery-validation/1.19.0/jquery.validate.min.js"
	th:src="@{/webjars/jquery-validation/1.19.0/jquery.validate.min.js}"></script>
<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
<script
	src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>

<style>
body {
	font-size: 0.8rem;
}

.btn {
	line-height: 0rem;
}

.table-bordered td, .table-bordered th {
	font-size: smaller;
}

.container-manager {
	width: 83.5%;
	padding-right: 15px;
	padding-left: 15px;
	margin-right: auto;
	margin-left: 17.3%;
	margin-top: 80px;
	margin-top: 80px;
}

.table .thead-light th {
	color: #495057;
	background-color: #e9ecef;
	border-color: #dee2e6;
	width: 23px;
}

.scroll {
	max-height: 60vh;
	overflow-y: scroll;
	overflow-x: hidden;
}

.tablinks {
	background-color: #f1f1f1;
	/* Default background color */
	border: none;
	color: black;
	padding: 10px 20px;
	text-align: center;
	text-decoration: none;
	display: inline-block;
	font-size: 16px;
	transition: background-color 0.3s;
}

.tablinks.active {
	background-color: #2084a9;
	color: white;
}

.tab {
	overflow: hidden;
}

.tab button {
	background-color: inherit;
	float: left;
	border: none;
	outline: none;
	cursor: pointer;
	padding: 14px 56px;
	transition: 0.3s;
	font-size: 17px;
}

.tab button:hover {
	background-color: #ddd;
}

.tabcontent {
	display: none;
	padding: 0px;
	border-top: 1px solid #ccc;
}

.active {
	background-color: #2084a9;
}

#myPieChart {
	width: 100px;
	height: 100px;
}
</style>
<style>
.modal {
	display: none;
	/* Hidden by default */
	position: absolute;
	/* Stay in place */
	z-index: 1;
	/* Location of the box */
	left: 0;
	top: 0;
	width: 100%;
	/* Full width */
	height: 100%;
	/* Full height */
	overflow: auto;
	/* Enable scroll if needed */
	background-color: rgb(0, 0, 0);
	/* Fallback color */
	background-color: rgba(0, 0, 0, 0.4);
	/* Black w/ opacity */
}

/* Modal Content */
.modal-content {
	background-color: #fefefe;
	margin: auto;
	padding: 20px;
	border: 1px solid #888;
	width: 100%;
	box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0
		rgba(0, 0, 0, 0.19);
	-webkit-animation-name: animatetop;
	-webkit-animation-duration: 0.4s;
	animation-name: animatetop;
	animation-duration: 0.4s
}

.modal-pass {
	background-color: #fefefe;
	margin: 15% auto;
	padding: 20px;
	border: 1px solid #888;
	width: 40%;
	height: 25%;
	margin-left: 400PX;
	margin-right: auto;
	border-radius: 10px;
	box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.2);
	font-family: Arial, sans-serif;
}

.close {
	color: red;
	font-size: 28px;
	font-weight: bold;
}

.close:hover, .close:focus {
	color: black;
	text-decoration: none;
	cursor: pointer;
}
</style>
<style>
.password-info {
	visibility: hidden;
	width: 320px;
	background-color: #333;
	color: #fff;
	text-align: left;
	border-radius: 10px;
	padding: 10px;
	position: absolute;
	z-index: 1;
	top: calc(100% + 10px);
	left: 50%;
	transform: translateX(-50%);
	opacity: 0;
	transition: opacity 0.3s;
}

input:hover+.password-info {
	visibility: visible;
	opacity: 0.8;
}

.subtablinks {
	background-color: #f1f1f1;
	/* Default background color */
	border: none;
	color: black;
	padding: 10px 20px;
	text-align: center;
	text-decoration: none;
	display: inline-block;
	font-size: 16px;
	transition: background-color 0.3s;
}

.subtablinks.active {
	background-color: #2084a9;
	color: white;
}

.hover-underline:hover {
	text-decoration: underline;
	text-decoration-color: #007bff;
	cursor: pointer;
	/* Sets underline color to blue */
}

#loader-overlay {
	display: none;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
	z-index: 999; /* Ensure it sits above other elements */
}

#loader {
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
}

.loader-animation {
	border: 6px solid #f3f3f3; /* Light grey */
	border-top: 6px solid #3498db; /* Blue */
	border-radius: 50%;
	width: 40px;
	height: 40px;
	animation: spin 1s linear infinite;
}
@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

.spinner {
	animation: spin 2s linear infinite;
}
</style>
<style>
#tab2 .list-group-item a {
	text-decoration: none;
	color: black;
}

#tab2 .list-group-item a:hover {
	text-decoration: underline;
	color: lightblue;
}

/* #tab3 .list-group-item a {
	text-decoration: none;
	color: black;
}

#tab3 .list-group-item a:hover {
	text-decoration: underline;
	cursor: pointer;
	color: #0000EE;
	font-weight: 30px;
}

#tab3 table tr {
	cursor: pointer;
	color: #0000EE;
	font-weight: 30px;
}

#tab3 .list-group-item:nth-child(8):hover {
	cursor: pointer;
	color: #0000EE;
	font-weight: 30px;
}

#tab3 .list-group-item:nth-child(9):hover {
	cursor: pointer;
	color: #0000EE;
	font-weight: 30px;
}

#tab3 .list-group-item:nth-child(10):hover {
	cursor: pointer;
	color: #0000EE;
	font-weight: 30px;
}

#tab3 .list-group-item {
	border: none;
}
 */
#sublist-container {
	border: 1px solid #ccc;
	border-radius: 5px;
	background-color: white;
	box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

table a {
	color: inherit;
	text-decoration: none;
}

table a:hover {
	color: #0000EE;
	text-decoration: underline;
}

#CommonTable td {
	color: inherit;
	text-decoration: none;
}

#CommonTable td:hover {
	color: #0000EE;
	text-decoration: underline;
}

:root {
	--peacockblue: #1c6ea4; /* Example peacock blue color */
}

.acct-list {
	display: none; 
	padding: 5px;
	
}

.acct-list ul {
	list-style-type: none;
	padding: 0;
	margin-left: 25px;
}

.acct-list ul li {
	margin: 5px 0;
	cursor: pointer;
	color: blue;
	text-decoration: underline;
}

.acct-list2 {
	display: none;
	padding: 5px;
	
}

.acct-list2 ul {
	list-style-type: none;
	padding: 0;
	margin-left: 25px;
}

.acct-list2 ul li {
	margin: 5px 0;
	cursor: pointer;
	color: blue;
	text-decoration: underline;
}

.acct-list3 {
	display: none; 
	padding: 5px;
	
}

.acct-list3 ul {
	list-style-type: none;
	padding: 0;
	margin-left: 25px;
}

.acct-list3 ul li {
	margin: 5px 0;
	cursor: pointer;
	color: blue;
	text-decoration: underline;
}

.acct-list4 {
	display: none; /* Initially hide the account list */
	padding: 5px;
	
}

.acct-list4 ul {
	list-style-type: none;
	padding: 0;
	margin-left: 25px;
}

.acct-list4 ul li {
	margin: 5px 0;
	cursor: pointer;
	color: blue;
	text-decoration: underline;
}

.acct-list5 {
	display: none; /* Initially hide the account list */
	padding: 5px;
	
}

.acct-list5 ul {
	list-style-type: none;
	padding: 0;
	margin-left: 25px;
}

.acct-list5 ul li {
	margin: 5px 0;
	cursor: pointer;
	color: blue;
	text-decoration: underline;
}

/* Modal backdrop (container) */
#myModal {
	display: none; /* Hidden by default */
	position: fixed;
	z-index: 1000;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
	/* Remove backdrop by setting background to transparent */
	background-color: transparent !important;
	overflow: hidden;
}

/* Modal content (should be above the backdrop) */
#submodel {
	background-color: #fefefe;
	margin: 10% auto; /* Centered vertically and horizontally */
	padding: 20px;
	border: 1px solid #888;
	width: 80%; /* Set modal width */
	max-width: 600px; /* Limit the maximum width */
	border-radius: 8px;
	box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
	/* Slight shadow for the modal */
	z-index: 1050; /* Higher z-index than the backdrop */
	position: relative; /* Ensures z-index applies to this element */
}

/* Close button styling */
#closebtn {
	color: #aaa;
	margin-left: 500px;
	float: right;
	font-size: 28px;
	font-weight: bold;
	cursor: pointer;
	width: 30px;
	height: 20px;
}

#closebtn:hover, #closebtn:focus {
	color: black;
	text-decoration: none;
}

/* Modal rows */
.modal-row {
	display: flex;
	justify-content: space-evenly;
	margin-bottom: 15px;
}

.modal-label {
	font-weight: bold;
	font-size: 1rem;
}

.modal-value {
	font-size: 16px;
	color: #333;
}

.h2 {
	margin-bottom: 50px;
}

/* Fade-in animation for modal */
@keyframes fadeIn {from { opacity:0;
	
}

to {
	opacity: 1;
}

}
#myModal.show {
	display: block;
	animation: fadeIn 0.3s ease-in-out;
}

.container {
	overflow-y: hidden;
}

.filterable .filters input[disabled] {
	background-color: transparent;
	border: none;
	cursor: auto;
	box-shadow: none;
	padding: 0;
	height: auto;
}

.filterable .filters input[disabled]::-webkit-input-placeholder {
	color: #333;
}

.filterable .filters input[disabled]::-moz-placeholder {
	color: #333;
}

.filterable .filters input[disabled]:-ms-input-placeholder {
	color: #333;
}

.filterable .filters input[disabled]::-webkit-input-placeholder {
	color: #333;
}
</style>
<script th:inline="javascript">
	function openTab(evt, tabName) {
		// Hide all main tab content
		let i, tabcontent, tablinks;
		tabcontent = document.getElementsByClassName("tabcontent");
		for (i = 0; i < tabcontent.length; i++) {
			tabcontent[i].style.display = "none";
		}

		// Remove active class from main tabs
		tablinks = document.getElementsByClassName("tablinks");
		for (i = 0; i < tablinks.length; i++) {
			tablinks[i].className = tablinks[i].className
					.replace(" active", "");
		}

		// Show selected main tab and set as active
		document.getElementById(tabName).style.display = "block";
		evt.currentTarget.className += " active";
	}
	
	function selectActions(element) {
		var tranId = $(element).attr('data-tranid');
		var partnId = $(element).attr('data-partnid');
		var acctNum = $(element).attr('data-acctnum');
		console.log(tranId+" "+partnId+" "+acctNum);
		 $.ajax({
			type: 'GET',
			url: './transactionaccountdetailsvalues',
			data: {
				tranId: tranId,
				partnId: partnId,
				acctNum: acctNum
			},
			success: function (data) {
				
				$("#tran_id").val(data.tran_id);
				$("#part_tran_id").val(data.part_tran_id);
				$("#acct_num").val(data.acct_num);
				$("#acct_name").val(data.acct_name);
				$("#tran_type").val(data.tran_type);
				$("#part_tran_type").val(data.part_tran_type);
				$("#acct_crncy").val(data.acct_crncy);
				$("#tran_amt").val(data.tran_amt);
				$("#tran_particular").val(data.tran_particular);
				$("#tran_remarks").val(data.tran_remarks);
				$("#gst_amount").val(data.gst_amount);
				$("#gst_type").val(data.gst_type);
				$("#tran_code").val(data.tran_code);
				$("#tran_rpt_code").val(data.tran_rpt_code);
				$("#tran_ref_no").val(data.tran_ref_no);
				$("#add_details").val(data.add_details);
				$("#partition_type").val(data.partition_type);
				$("#partition_det").val(data.partition_det);
				$("#instr_num").val(data.instr_num);
				$("#ref_crncy").val(data.ref_crncy);
				$("#ref_crncy_amt").val(data.ref_crncy_amt);
				$("#rate_code").val(data.rate_code);
				$("#rate").val(data.rate);
				$("#entry_user").val(data.entry_user);
				$("#post_user").val(data.post_user);
				$("#tran_status").val(data.tran_status);
				$("#del_flg").val(data.del_flg);
			},
			error: function () {
				$('#errorMessage').text('Error fetching data');
				$('#errorModal').modal('show');
				alert("get values error")
			}
		}); 
	}	
	function formatNumberWithCommas(number) {

		if (!number && number !== 0) return '';
		console.log("number : " + number);
		let numberString = number.toString();
		console.log("numberString : " + numberString);

		let [integerPart, decimalPart] = numberString.split('.');

		let lastThreeDigits = integerPart.slice(-3);
		let otherDigits = integerPart.slice(0, -3);

		if (otherDigits !== '') {
			lastThreeDigits = ',' + lastThreeDigits;
		}

		let formattedIntegerPart = otherDigits.replace(/\B(?=(\d{2})+(?!\d))/g, ',') + lastThreeDigits;

		if (!decimalPart) {
			decimalPart = '00';
		}
		let formattedNumber = formattedIntegerPart + '.' + decimalPart;
		console.log("formattedIntegerPart : " + formattedIntegerPart);
		console.log("decimalPart : " + decimalPart);

		return formattedNumber;
	}
	function getPartTranRecords(button) {
		event.preventDefault();

		const currentPartTran = parseInt(document.getElementById('currentPartTran').innerText);
		console.log("currentPartTran"+currentPartTran);
		
		const maxPartTran = parseInt(document.getElementById('maxPartTran').innerText);
		console.log("maxPartTran"+maxPartTran);
		var tranId = $("#tran_id").val();
		console.log("tranId"+tranId);
		let partTranId = currentPartTran;
		console.log("partTranId"+partTranId);
		
		if (button.id === 'previous-btn') {

			if (currentPartTran > 1) {
				/*previous record*/
				partTranId = currentPartTran - 1;
				document.getElementById('currentPartTran').innerText = partTranId;

				$("#tran_id").val("");
				$("#part_tran_id").val("");
				$("#acct_num").val("");
				$("#acct_name").val("");
				$("#tran_type").val("");
				$("#part_tran_type").val("");
				$("#acct_crncy").val("");
				$("#tran_amt").val("");
				$("#tran_particular").val("");
				$("#tran_remarks").val("");
				$("#gst_amount").val("");
				$("#gst_type").val("");
				$("#tran_code").val("");
				$("#tran_rpt_code").val("");
				$("#tran_ref_no").val("");
				$("#add_details").val("");
				$("#partition_type").val("");
				$("#partition_det").val("");
				$("#instr_num").val("");
				$("#ref_crncy").val("");
				$("#ref_crncy_amt").val("");
				$("#rate_code").val("");
				$("#rate").val("");
				$("#entry_user").val("");
				$("#post_user").val("");
				$("#tran_status").val("");
				$("#del_flg").val("");
				$("#value_date").val("");
				$("#tran_date").val("");
				$("#entry_time").val("");
				$("#post_time").val("");
				$("#srl_no").val("");



				$.ajax({
					type: 'GET',
					url: './transactionValues',
					data: {
						tran_id: tranId,
						part_tran_id: partTranId

					},
					success: function (data) {
						console.log(data);
						console.log("dat"+data.tran_amt);
						$("#tran_id").val(data.tran_id != null ? data.tran_id : "");
						$("#part_tran_id").val(data.part_tran_id != null ? data.part_tran_id : "");
						$("#acct_num").val(data.acct_num != null ? data.acct_num : "");
						$("#acct_name").val(data.acct_name != null ? data.acct_name : "");
						$("#tran_type").val(data.tran_type != null ? data.tran_type : "");
						$("#part_tran_type").val(data.part_tran_type != null ? data.part_tran_type : "");
						$("#acct_crncy").val(data.acct_crncy != null ? data.acct_crncy : "");
					
						$("#tran_amt").val(data.tran_amt != null ? formatNumberWithCommas(data.tran_amt) : "");
						
						$("#tran_particular").val(data.tran_particular != null ? data.tran_particular : "");
						$("#tran_remarks").val(data.tran_remarks != null ? data.tran_remarks : "");
						$("#gst_amount").val(data.flow_code != null ? data.flow_code : "");
						$("#gst_type").val(data.flow_date != null ? formatDateToDD(data.flow_date) : "");
						$("#tran_code").val(data.tran_code != null ? data.tran_code : "");
						$("#tran_rpt_code").val(data.tran_rpt_code != null ? data.tran_rpt_code : "");
						$("#tran_ref_no").val(data.tran_ref_no != null ? data.tran_ref_no : "");
						$("#add_details").val(data.add_details != null ? data.add_details : "");
						$("#partition_type").val(data.partition_type != null ? data.partition_type : "");
						$("#partition_det").val(data.partition_det != null ? data.partition_det : "");
						$("#instr_num").val(data.instr_num != null ? data.instr_num : "");
						$("#ref_crncy").val(data.ref_crncy != null ? data.ref_crncy : "");
						$("#ref_crncy_amt").val(data.ref_crncy_amt != null ? data.ref_crncy_amt : "");
						$("#rate_code").val(data.rate_code != null ? data.rate_code : "");
						$("#rate").val(data.rate != null ? data.rate : "");
						$("#entry_user").val(data.entry_user != null ? data.entry_user : "");
						$("#post_user").val(data.post_user != null ? data.post_user : "");
						$("#tran_status").val(data.tran_status != null ? data.tran_status : "");
						$("#del_flg").val(data.del_flg != null ? data.del_flg : "");
						$("#value_date").val(data.value_date != null ? formatDateToDD(data.value_date) : "");
						$("#tran_date").val(data.tran_date != null ? formatDateToDD(data.tran_date) : "");
						$("#entry_time").val(data.entry_time != null ? formatDateToDD(data.entry_time) : "");
						$("#post_time").val(data.post_time != null ? formatDateToDD(data.post_time) : "");
						$("#srl_no").val(data.srl_no != null ? data.srl_no : "");
					},
					error: function () {
						$('#errorMessage').text('Error fetching data');
						$('#errorModal').modal('show');
					}
				});
			} else {
				alert('This is the first record!');
				return;
			}
		} else if (button.id === 'next-btn') {

			if (currentPartTran < maxPartTran) {
				/*next record*/
				partTranId = currentPartTran + 1;
				document.getElementById('currentPartTran').innerText = partTranId;


				$("#tran_id").val("");
				$("#part_tran_id").val("");
				$("#acct_num").val("");
				$("#acct_name").val("");
				$("#tran_type").val("");
				$("#part_tran_type").val("");
				$("#acct_crncy").val("");
				$("#tran_amt").val("");
				$("#tran_particular").val("");
				$("#tran_remarks").val("");
				$("#gst_amount").val("");
				$("#gst_type").val("");
				$("#tran_code").val("");
				$("#tran_rpt_code").val("");
				$("#tran_ref_no").val("");
				$("#add_details").val("");
				$("#partition_type").val("");
				$("#partition_det").val("");
				$("#instr_num").val("");
				$("#ref_crncy").val("");
				$("#ref_crncy_amt").val("");
				$("#rate_code").val("");
				$("#rate").val("");
				$("#entry_user").val("");
				$("#post_user").val("");
				$("#tran_status").val("");
				$("#del_flg").val("");
				$("#value_date").val("");
				$("#tran_date").val("");
				$("#entry_time").val("");
				$("#post_time").val("");
				$("#srl_no").val("");



				$.ajax({
					type: 'GET',
					url: './transactionValues',
					data: {
						tran_id: tranId,
						part_tran_id: partTranId

					},
					success: function (data) {
						console.log(data);

						$("#tran_id").val(data.tran_id != null ? data.tran_id : "");
						$("#part_tran_id").val(data.part_tran_id != null ? data.part_tran_id : "");
						$("#acct_num").val(data.acct_num != null ? data.acct_num : "");
						$("#acct_name").val(data.acct_name != null ? data.acct_name : "");
						$("#tran_type").val(data.tran_type != null ? data.tran_type : "");
						$("#part_tran_type").val(data.part_tran_type != null ? data.part_tran_type : "");
						$("#acct_crncy").val(data.acct_crncy != null ? data.acct_crncy : "");
						$("#tran_amt").val(data.tran_amt != null ? formatNumberWithCommas(data.tran_amt) : "");
						$("#tran_particular").val(data.tran_particular != null ? data.tran_particular : "");
						$("#tran_remarks").val(data.tran_remarks != null ? data.tran_remarks : "");
						$("#gst_amount").val(data.flow_code != null ? data.flow_code : "");
						$("#gst_type").val(data.flow_date != null ? formatDateToDD(data.flow_date) : "");
						$("#tran_code").val(data.tran_code != null ? data.tran_code : "");
						$("#tran_rpt_code").val(data.tran_rpt_code != null ? data.tran_rpt_code : "");
						$("#tran_ref_no").val(data.tran_ref_no != null ? data.tran_ref_no : "");
						$("#add_details").val(data.add_details != null ? data.add_details : "");
						$("#partition_type").val(data.partition_type != null ? data.partition_type : "");
						$("#partition_det").val(data.partition_det != null ? data.partition_det : "");
						$("#instr_num").val(data.instr_num != null ? data.instr_num : "");
						$("#ref_crncy").val(data.ref_crncy != null ? data.ref_crncy : "");
						$("#ref_crncy_amt").val(data.ref_crncy_amt != null ? data.ref_crncy_amt : "");
						$("#rate_code").val(data.rate_code != null ? data.rate_code : "");
						$("#rate").val(data.rate != null ? data.rate : "");
						$("#entry_user").val(data.entry_user != null ? data.entry_user : "");
						$("#post_user").val(data.post_user != null ? data.post_user : "");
						$("#tran_status").val(data.tran_status != null ? data.tran_status : "");
						$("#del_flg").val(data.del_flg != null ? data.del_flg : "");
						$("#value_date").val(data.value_date != null ? formatDateToDD(data.value_date) : "");
						$("#tran_date").val(data.tran_date != null ? formatDateToDD(data.tran_date) : "");
						$("#entry_time").val(data.entry_time != null ? formatDateToDD(data.entry_time) : "");
						$("#post_time").val(data.post_time != null ? formatDateToDD(data.post_time) : "");
						$("#srl_no").val(data.srl_no != null ? data.srl_no : "");
					},
					error: function () {
						$('#errorMessage').text('Error fetching data');
						$('#errorModal').modal('show');
					}
				});
			} else {
				alert('This is the last record!');
				return;
			}
		}


		console.log('Navigating to partTranId:', partTranId);

	}
	function Home() {

		location.href = 'Dashboard';
	}

	function Back() {
		window.history.back();
	}

	
</script>
<script>
    function enableTabs(tabId, param) {
        // Show the TabButtons when any table element is clicked
        document.getElementById('TabButtons').style.display = 'flex';
        
        // You can add any other logic for processing the `param` if needed
        console.log("Tab enabled: " + tabId + " with parameter " + param);
        
        // Call the showTab function to show the tab you want based on the selected link
        showTab(tabId);
    }

    function showTab(tabId) {
        // Logic to switch between tabs
        const tabs = document.querySelectorAll('.tablinks');
        tabs.forEach(tab => {
            if (tab.getAttribute('onclick').includes(tabId)) {
                tab.classList.add('active');
            } else {
                tab.classList.remove('active');
            }
        });
        
        // Optionally, you can add further logic to display specific content for each tab here
        console.log(tabId + " tab is now active");
    }
    

    function showTabButtons() {
        document.getElementById("TabButtons").style.display = "flex";
    }
    
    
    
    
    
    
/*     $(document).ready(function () {

    $('.btn-filter').click(function () {
        // Get the active tab's ID
        alert("yui")
        const activeTab = $('.tablinks.active').attr('data-tab');
        console.log(`Active Tab: ${activeTab}`); // Show the active tab's ID for debugging
alert(activeTab)
        // Perform filtering logic specific to the active tab
        const $panel = $('#' + activeTab).find('.filterable'); // Find the filterable panel in the active tab
        const $filters = $panel.find('.filters input');
        const $tbody = $panel.find('.table tbody');

        if ($filters.prop('disabled') === true) {
            $filters.prop('disabled', false);
            $filters.first().focus();
        } else {
            $filters.val('').prop('disabled', true);
            $tbody.find('.no-result').remove();
            $tbody.find('tr').show();
        }
    });

    // Filter input logic
    $('.filterable .filters input').keyup(function (e) {
        // Get the active tab's ID
        const activeTab = $('.tabcontent.active').attr('id');
        const $panel = $('#' + activeTab).find('.filterable'); // Find the filterable panel in the active tab
        const $input = $(this);
        const inputContent = $input.val().toLowerCase();
        const column = $panel.find('.filters th').index($input.closest('th'));
        const $table = $panel.find('.table');
        const $rows = $table.find('tbody tr');

        // Filter rows based on input
        const $filteredRows = $rows.filter(function () {
            const value = $(this).find('td').eq(column).text().toLowerCase();
            return value.indexOf(inputContent) === -1;
        });

        // Clean up and update table rows
        $table.find('tbody .no-result').remove();
        $rows.show();
        $filteredRows.hide();

        // Show 'No Record Found' if all rows are filtered
        if ($filteredRows.length === $rows.length) {
            $table
                .find('tbody')
                .prepend(
                    $('<tr class="no-result text-center"><td colspan="' +
                        $table.find('.filters th').length +
                        '">No Record found</td></tr>')
                );
        }
    });

    // Add click event to dynamically switch tabs
    $('.tablinks').click(function () {
        const tabId = $(this).attr('data-tab'); // Get the tab ID
        showTab(tabId); // Call the showTab function
    });
}); */
    
    
    
    
$(document)
.ready(
	function () {
		$('.filterable .btn-filter')
			.click(
				function () {
					var $panel = $(this).parents(
						'.filterable'), $filters = $panel
							.find('.filters input'), $tbody = $panel
								.find('.table tbody');
					if ($filters.prop('disabled') == true) {
						$filters
							.prop('disabled', false);
						$filters.first().focus();
					} else {
						$filters.val('').prop(
							'disabled', true);
						$tbody.find('.no-result')
							.remove();
						$tbody.find('tr').show();
					}
				});

		$('.filterable .filters input')
			.keyup(
				function (e) {
					/* Ignore tab key */
					var code = e.keyCode || e.which;
					if (code == '9')
						return;
					/* Useful DOM data and selectors */
					var $input = $(this), inputContent = $input
						.val().toLowerCase(), $panel = $input
							.parents('.filterable'), column = $panel
								.find('.filters th')
								.index($input.parents('th')), $table = $panel
									.find('.table'), $rows = $table
										.find('tbody tr');
					/* Dirtiest filter function ever ;) */
					var $filteredRows = $rows
						.filter(function () {
							var value = $(this)
								.find('td').eq(
									column)
								.text()
								.toLowerCase();
							return value
								.indexOf(inputContent) === -1;
						});
					/* Clean previous no-result if exist */
					$table.find('tbody .no-result')
						.remove();
					/* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
					$rows.show();
					$filteredRows.hide();
					/* Prepend no-result row if all rows are filtered */
					if ($filteredRows.length === $rows.length) {
						$table
							.find('tbody')
							.prepend(
								$('<tr class="no-result text-center"><td colspan="'
									+ $table
										.find('.filters th').length
									+ '">No Record found</td></tr>'));
					}
				});
	});
</script>


</head>
<title>BTM</title>

<body>

	<div class="container-fluid"
		style="margin-top: 100px; width: 1000px; margin-left: 350px">
		<div class="row">
			<div class="col-sm-2">
				<div th:insert="BTMHeaderMenu :: header"></div>
			</div>
			<div th:if="${formmode}=='add'">
				<div class="card" style="width: 1500px;">


					<div class="card-header"
						style="background-color: #e9ecef; height: 50px; display: flex; align-items: center;">
						<div class="float-left">
							<h6 style="font-size: 1.2rem; color: black; margin: 0;">Admin
								Inquiry</h6>
						</div>
						<div class="tab" id="TabButtons"
							style="display: none; gap: 10px; margin-left: 200px;">
							<button class="tablinks" onclick="showTab('tab1')"
								style="font-size: 16px; padding: 4px 20px; height: 100%; flex: 1; width: 200px; border: 2px solid black;">Account
								Ledger</button>
							<button class="tablinks ml-4" onclick="showTab('tab2')"
								style="font-size: 16px; padding: 4px 20px; height: 100%; flex: 1; width: 200px; border: 2px solid black;">Transaction</button>
							<button class="tablinks ml-4" onclick="showTab('tab3')"
								style="font-size: 16px; padding: 4px 20px; height: 100%; flex: 1; width: 200px; border: 2px solid black;">Journal
								Entries</button>

						</div>
						<div id="acctList" class="acct-list"
							style="display: none; height: 40px; margin: 0px">
							<ul
								style="display: flex; list-style: none; align-item: center; justify-content: space-around;">
								<li
									onclick="moreaccutnum('tab1', '2100002160', getAllNumbers())">2100002160</li>
								<li style="margin-left: 10px"
									onclick="moreaccutnum('tab1', '2100002164', getAllNumbers())">2100002164</li>
								<li style="margin-left: 10px"
									onclick="moreaccutnum('tab1', '2100002165', getAllNumbers())">2100002165</li>
								<li style="margin-left: 10px"
									onclick="moreaccutnum('tab1', '2100002166', getAllNumbers())">2100002166</li>
								<li style="margin-left: 10px"
									onclick="moreaccutnum('tab1', '2100002167', getAllNumbers())">2100002167</li>
							</ul>
						</div>
						<div id="acctList2" class="acct-list2"
							style="display: none; height: 40px; margin: 0px">
							<ul
								style="display: flex; list-style: none; align-item: center; justify-content: space-around;">
								<li onclick="enableTabs('tab1', 2100002148)">2100002148</li>
								<li style="margin-left: 10px"
									onclick="enableTabs('tab1', 6600006617)">6600006617</li>
								<li style="margin-left: 10px"
									onclick="enableTabs('tab1', 1500001510)">1500001510</li>

							</ul>
						</div>
						<div id="acctList3" class="acct-list3"
							style="display: none; height: 40px; margin: 0px">
							<ul
								style="display: flex; list-style: none; align-item: center; justify-content: space-around;">
								<li
									onclick="moreaccutnum2('tab1', '2100002180', getAllNumbers2())">2100002180</li>
								<li style="margin-left: 10px"
									onclick="moreaccutnum2('tab1', '6200006215', getAllNumbers2())">6200006215</li>
								<li style="margin-left: 10px"
									onclick="moreaccutnum2('tab1', '6200006216', getAllNumbers2())">6200006216</li>
							</ul>
						</div>

						<div id="acctList4" class="acct-list4"
							style="display: none; height: 40px; margin: 0px">
							<ul
								style="display: flex; list-style: none; align-item: center; justify-content: space-around;">
								<li
									onclick="moreaccutnum3('tab1', '2100002185',getAllNumbers3())">2100002185</li>
								<li style="margin-left: 10px"
									onclick="moreaccutnum3('tab1', '6200006217',getAllNumbers3())">6200006217</li>


							</ul>
						</div>

						<div id="acctList5" class="acct-list5"
							style="display: none; height: 40px; margin: 0px">
							<ul
								style="display: flex; list-style: none; align-item: center; justify-content: space-around;">
								<li
									onclick="moreaccutnum4('tab1', '4400004415',getAllNumbers4())">4400004415</li>
								<li style="margin-left: 10px"
									onclick="moreaccutnum4('tab1', '2700002710',getAllNumbers4())">2700002710</li>
								<li style="margin-left: 10px"
									onclick="moreaccutnum4('tab1', '1100001199',getAllNumbers4())">1100001199</li>
								<li style="margin-left: 10px"
									onclick="moreaccutnum4('tab1', '1100001196',getAllNumbers4())">1100001196</li>


							</ul>
						</div>

					</div>


					<table style="width: 100%; text-align: left; margin-left: 100px;"
						id="CommonTable">
						<tr>
							<td style="padding: 10px;"><a
								style="text-decoration: none; cursor: pointer"
								onclick="showAccountList5();showTabButtons">GST Receipts</a></td>
							<td style="padding: 10px;"><a
								style="text-decoration: none; cursor: pointer"
								onclick="enableTabs('tab1', 1500001510);showTabButtons">GST
									Payments</a></td>
							<td style="padding: 10px;"><a
								style="text-decoration: none; cursor: pointer"
								onclick="enableTabs('tab1', 0);showTabButtons">GST Reversals</a></td>
						</tr>
						<tr>
							<td style="padding: 10px;"><a
								style="text-decoration: none; cursor: pointer"
								onclick="enableTabs('tab1', 1100001185);showTabButtons">TDS
									Receivables</a></td>
							<td style="padding: 10px;"
								onclick="showAccountList();showTabButtons">TDS Payments</td>
							<td style="padding: 10px;"><a
								style="text-decoration: none; cursor: pointer"
								onclick="enableTabs('tab1', 1100001196);showTabButtons">EdgeVerve</a></td>
						</tr>
						<tr>
							<td style="padding: 10px;"><a
								style="text-decoration: none; cursor: pointer"
								onclick="enableTabs('tab1', 1100001199);showTabButtons">Genius</a></td>
							<td style="padding: 10px;"
								onclick="showAccountList2();showTabButtons">WhiteStone</td>
							<td style="padding: 10px;"
								onclick="showAccountList3();showTabButtons">SPF</td>
						</tr>
						<tr>
							<td style="padding: 10px;"
								onclick="showAccountList4();showTabButtons">ESI</td>
							<td style="padding: 10px;"><a
								style="text-decoration: none; cursor: pointer"
								onclick="enableTabs('tab1', 2100002190);showTabButtons">ProfTax</a></td>
							<td style="padding: 10px;"><a
								style="text-decoration: none; cursor: pointer"
								onclick="enableTabs('tab1', 1500001510);showTabButtons">Payments</a></td>
						</tr>
					</table>


					<!-- <div id="acctList" class="acct-list">
						<ul>
							<li onclick="enableTabs('tab1', 2100002160)">2100002160</li>
							<li onclick="enableTabs('tab1', 2100002164)">2100002164</li>
							<li onclick="enableTabs('tab1', 2100002165)">2100002165</li>
							<li onclick="enableTabs('tab1', 2100002166)">2100002166</li>
							<li onclick="enableTabs('tab1', 2100002167)">2100002167</li>
						</ul>
					</div> -->
					<!-- 
					<div id="acctList" class="acct-list"
						style="display: none; height: 40px; margin: 0px">
						<ul
							style="display: flex; list-style: none; align-item: center; justify-content: space-around;">
							<li onclick="moreaccutnum('tab1', '2100002160', getAllNumbers())">2100002160</li>
							<li onclick="moreaccutnum('tab1', '2100002164', getAllNumbers())">2100002164</li>
							<li onclick="moreaccutnum('tab1', '2100002165', getAllNumbers())">2100002165</li>
							<li onclick="moreaccutnum('tab1', '2100002166', getAllNumbers())">2100002166</li>
							<li onclick="moreaccutnum('tab1', '2100002167', getAllNumbers())">2100002167</li>
						</ul>
					</div> -->

					<!-- <div id="acctList2" class="acct-list2"
						style="display: none; height: 40px; margin: 0px">
						<ul
							style="display: flex; list-style: none; align-item: center; justify-content: space-around;">
							<li onclick="enableTabs('tab1', 2100002148)">2100002148</li>
							<li onclick="enableTabs('tab1', 6600006617)">6600006617</li>
							<li onclick="enableTabs('tab1', 1500001510)">1500001510</li>

						</ul>
					</div> -->

					<!-- <div id="acctList3" class="acct-list3" style="display: none;">
						<ul>
							<li onclick="enableTabs('tab1', 2100002180)">2100002180</li>
							<li onclick="enableTabs('tab1', 6200006215)">6200006215</li>
							<li onclick="enableTabs('tab1', 6200006216)">6200006216</li>

						</ul>
					</div> -->


					<!-- <div id="acctList3" class="acct-list3"
						style="display: none; height: 40px; margin: 0px">
						<ul
							style="display: flex; list-style: none; align-item: center; justify-content: space-around;">
							<li
								onclick="moreaccutnum2('tab1', '2100002180', getAllNumbers2())">2100002180</li>
							<li
								onclick="moreaccutnum2('tab1', '6200006215', getAllNumbers2())">6200006215</li>
							<li
								onclick="moreaccutnum2('tab1', '6200006216', getAllNumbers2())">6200006216</li>
						</ul>
					</div> -->

					<!-- <div id="acctList4" class="acct-list4"
						style="display: none; height: 40px; margin: 0px">
						<ul
							style="display: flex; list-style: none; align-item: center; justify-content: space-around;">
							<li
								onclick="moreaccutnum3('tab1', '2100002185',getAllNumbers3())">2100002185</li>
							<li
								onclick="moreaccutnum3('tab1', '6200006217',getAllNumbers3())">6200006217</li>


						</ul>
					</div> -->


					<!-- <div id="acctList5" class="acct-list5"
						style="display: none; height: 40px; margin: 0px">
						<ul
							style="display: flex; list-style: none; align-item: center; justify-content: space-around;">
							<li
								onclick="moreaccutnum4('tab1', '4400004415',getAllNumbers4())">4400004415</li>
							<li
								onclick="moreaccutnum4('tab1', '2700002710',getAllNumbers4())">2700002710</li>
							<li
								onclick="moreaccutnum4('tab1', '1100001199',getAllNumbers4())">1100001199</li>
							<li
								onclick="moreaccutnum4('tab1', '1100001196',getAllNumbers4())">1100001196</li>


						</ul>
					</div> -->

					<!-- <div class="tab mt-2" id="TabButtons"
						style="display: none; margin-top: 10px; width: 100%;">
						<button class="tablinks" onclick="showTab('tab1')"
							style="font-size: 16px; padding: 4px 150px; height: 32px;">
							Account Ledger</button>
						<button class="tablinks" onclick="showTab('tab2')"
							style="font-size: 16px; padding: 4px 200px; height: 32px;">
							Transaction</button>
						<button class="tablinks" onclick="showTab('tab3')"
							style="font-size: 16px; padding: 4px 200px; height: 32px;">
							Journal Entries</button>
					</div> -->






					<div id="tab1"
						class="tabcontent filterable card panel panel-primary filterable"
						data-tab="tab1"
						style="display: none; width: 1470px; margin-left: 10px;">
						<div class="card-header">
							<button type="button" class="btn btns btn-filter headerbutton"
								style="float: right;">Filter</button>
						</div>
						<form action="#" id="accountForm" >
							<div class="w-100 h-100">
								<div class="row formline" style="margin-top: 1px">

									<div class="col-sm-1" style="margin-top: 5px">Account No</div>
									<div class="col-sm-1">
										<input type="text" name="acct_num1" id="acct_num1"
											class="form-control-sm" readonly />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1" style="margin-top: 5px">Account
										Name</div>
									<div class="col-sm-1">
										<input type="text" name="acct_name1" id="acct_name1"
											class="form-control-sm" readonly />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1" style="margin-top: 5px">From Date</div>
									<div class="col-sm-1">
										<input type="text" id="fromdate" class="form-control-sm"
											placeholder="DD-MM-YYYY" />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1" style="margin-top: 5px">To Date</div>
									<div class="col-sm-1">
										<input type="text" name="todate" id="todate"
											placeholder="DD-MM-YYYY" class="form-control-sm"
											onchange="funcall()" />
									</div>
								</div>


							</div>
						</form>
						<div class="card-body" style="padding: 0px">
							<div class="table-responsive"
								style="max-height: 100vh; overflow-y: auto; border: 1px solid #ddd; height: 600px">
								<table class="table table-bordered " id="usertable"
									style="font-size: 14px">
									<thead
										style="position: sticky; top: 0; background-color: #f8f9fa; z-index: 1;">
										<tr class="filters">
											<th><input type="text"
												class="form-control font-weight-bold"
												placeholder="Tran Date" disabled></th>
											<th><input type="text"
												class="form-control font-weight-bold" placeholder="Tran Id"
												disabled></th>
											<th style="width: 400px"><input type="text"
												class="form-control font-weight-bold"
												placeholder="Tran Particulars" disabled></th>
											<th style="text-align: center"><input type="text"
												class="form-control font-weight-bold" placeholder="Currency"
												disabled></th>
											<th style="text-align: right"><input type="text"
												style="text-align: right"
												class="form-control font-weight-bold" placeholder="Debits"
												disabled></th>
											<th style="text-align: right"><input type="text"
												style="text-align: right"
												class="form-control font-weight-bold" placeholder="Credits"
												disabled></th>
											<th style="text-align: right"><input type="text"
												style="text-align: right"
												class="form-control font-weight-bold" placeholder="Balance"
												disabled></th>



										</tr>
									</thead>
									<tbody style="line-height: 0px;" id="usertable3">
										<div id="loadingMessage"
											style="display: none; font-size: 20px; text-align: center; color: #1c6ea4; font-weight: bold;">Loading,
											please wait...</div>
									</tbody>
								</table>
							</div>
						</div>
						<div style="margin-left: 700px">
							<button onclick="showCommonTable()"
								class="btn btn-secondary mt-3">Back</button>
						</div>
					</div>




					<!-- ----------------------------------------------------TAB2------------------------------------------------------------------------- -->
					<div id="tab2"
						class="tabcontent filterable card panel panel-primary filterable"
						data-tab="tab2"
						style="display: none; width: 1470px; margin-left: 10px;">
						<div class="card-header">
							<button type="button" class="btn btns btn-filter headerbutton"
								style="float: right;">Filter</button>
						</div>
						<form action="#" id="accountForm"
							>
							<div class="w-100 h-100">
								<div class="row formline" style="margin-top: 1px">

									<div class="col-sm-1" style="margin-top: 5px">Account No</div>
									<div class="col-sm-1">
										<input type="text" name="acct_num2" id="acct_num2"
											class="form-control-sm" readonly />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1" style="margin-top: 5px">Account
										Name</div>
									<div class="col-sm-1">
										<input type="text" name="acct_name2" id="acct_name2"
											class="form-control-sm" readonly />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1" style="margin-top: 5px">From Date</div>
									<div class="col-sm-1">
										<input type="text" id="fromdate2" class="form-control-sm"
											placeholder="DD-MM-YYYY" />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1" style="margin-top: 5px">To Date</div>
									<div class="col-sm-1">
										<input type="text" name="todate2" id="todate2"
											placeholder="DD-MM-YYYY" class="form-control-sm"
											onchange="funcall2()" />
									</div>
								</div>


							</div>
						</form>

						<div>
							<div class="card">

								<div class="card-body" style="padding: 0px">
									<div class="table-responsive"
										style="max-height: 100vh; overflow-y: auto; border: 1px solid #ddd; height: 600px">
										<table class="table  table-bordered table-hover table-sm"
											style="margin-bottom: 0px; font-size: initial; width: 100%;"
											id="list2">
											<thead
												style="position: sticky; top: 0; background-color: #f8f9fa; z-index: 1;">
												<tr class="filters">
													<th><input type="text"
														class="form-control font-weight-bold" placeholder="TrDate"
														disabled></th>
													<th><input type="text"
														class="form-control font-weight-bold"
														placeholder="Tran Id" disabled></th>
													<th><input type="text"
														class="form-control font-weight-bold"
														placeholder="PaTran Type" disabled></th>
													<th><input type="text"
														class="form-control font-weight-bold" placeholder="Cur"
														disabled></th>
													<th><input type="text" style="text-align: right"
														class="form-control font-weight-bold" placeholder="Amount"
														disabled></th>
													<th><input type="text" style="text-align: right"
														class="form-control font-weight-bold"
														placeholder="Acct Num" disabled></th>
													<th><input type="text" style="text-align: left"
														class="form-control font-weight-bold"
														placeholder="Acct Name" disabled></th>
													<th><input type="text" style="text-align: left"
														class="form-control font-weight-bold"
														placeholder="Tran Particular" disabled></th>
													<th><input type="text" style="text-align: left"
														class="form-control font-weight-bold" placeholder="Status"
														disabled></th>
													<!-- <th style="width: 8%;">TrDate</th>
													<th style="width: 8%;">Tran Id</th>
													<th style="width: 8%;">PaTran Type</th>
													<th style="width: 5%;">Cur</th>
													<th style="text-align: right; width: 8%;">Amount</th>
													<th style="text-align: right; width: 8%;">Acct Num</th>
													<th style="text-align: left; width: 8%;">Acct	 Name</th>
													<th style="text-align: left; width: 35%;">Tran
														Particular</th>
													<th style="text-align: left; width: 8%;">Status</th> -->

												</tr>
											</thead>
											<tbody>
												<div id="loadingMessage2"
													style="display: none; font-size: 20px; text-align: center; color: #1c6ea4; font-weight: bold;">Loading,
													please wait...</div>
											</tbody>
										</table>
									</div>
								</div>

							</div>
							<div style="margin-left: 700px">
								<button onclick="showCommonTable()"
									class="btn btn-secondary mt-3">Back</button>
								<button onclick="getModelValue()" class="btn btn-secondary mt-3">Summary</button>
							</div>

						</div>


					</div>


					<!-- ------------------------------------------------------------TAB3----------------------------------------------------- -->

					<div id="tab3"
						class="tabcontent card panel panel-primary filterable"
						style="display: none; width: 1470px; margin-left: 10px;">
						<div class="card-header">
							<button type="button" class="btn btns btn-filter headerbutton"
								style="float: right;">Filter</button>
						</div>
						<form action="#" id="accountForm"
							>
							<div class="w-100 h-100">
								<div class="row formline" style="margin-top: 1px">

									<div class="col-sm-1" style="margin-top: 5px">Account No</div>
									<div class="col-sm-1">
										<input type="text" name="acct_num3" id="acct_num3"
											class="form-control-sm" readonly />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1" style="margin-top: 5px">Account
										Name</div>
									<div class="col-sm-1">
										<input type="text" name="acct_name3" id="acct_name3"
											class="form-control-sm" readonly />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1" style="margin-top: 5px">From Date</div>
									<div class="col-sm-1">
										<input type="text" id="fromdate3" class="form-control-sm"
											placeholder="DD-MM-YYYY" />
									</div>
									<div class="col-sm-1"></div>
									<div class="col-sm-1" style="margin-top: 5px">To Date</div>
									<div class="col-sm-1">
										<input type="text" name="todate3" id="todate3"
											placeholder="DD-MM-YYYY" class="form-control-sm"
											onchange="funcall3()" />
									</div>
								</div>


							</div>
						</form>
						<div class="panel panel-primary filterable">
							<div class="card w-100 border panel panel-primary filterable">

								<div class="card-body" style="padding: 0px">
									<div class="table-responsive"
										style="max-height: 100vh; overflow-y: auto; border: 1px solid #ddd; height: 600px">
										<table class="table table-bordered table-hover table-sm"
											style="margin-bottom: 0px; font-size: initial; table-layout: fixed; width: 100%;"
											id="list3">
											<thead
												style="position: sticky; top: 0; background-color: #f8f9fa; z-index: 1;">
												<tr class="filters">
												<tr class="filters">
													<th><input type="text"
														class="form-control font-weight-bold" placeholder="TrDate"
														disabled></th>
													<th><input type="text"
														class="form-control font-weight-bold"
														placeholder="Tran Id" disabled></th>
													<th><input type="text"
														class="form-control font-weight-bold"
														placeholder="PaTran Type" disabled></th>
													<th><input type="text"
														class="form-control font-weight-bold" placeholder="Cur"
														disabled></th>
													<th><input type="text" style="text-align: right"
														class="form-control font-weight-bold" placeholder="Amount"
														disabled></th>
													<th><input type="text" style="text-align: right"
														class="form-control font-weight-bold"
														placeholder="Acct Num" disabled></th>
													<th><input type="text" style="text-align: left"
														class="form-control font-weight-bold"
														placeholder="Acct Name" disabled></th>
													<th><input type="text" style="text-align: left"
														class="form-control font-weight-bold"
														placeholder="Tran Particular" disabled></th>
													<th><input type="text" style="text-align: left"
														class="form-control font-weight-bold" placeholder="Status"
														disabled></th>
													<!-- <th style="width: 8%;">TrDate</th>
													<th style="width: 8%;">Tran Id</th>
													<th style="width: 8%;">PaTran Type</th>
													<th style="width: 5%;">Cur</th>
													<th style="text-align: right; width: 8%;">Amount</th>
													<th style="text-align: right; width: 8%;">Acct Num</th>
													<th style="text-align: left; width: 20%;">Acct Name</th>
													<th style="text-align: left; width: 30%;">Tran
														Particular</th>
													<th style="text-align: left; width: 8%">Status</th> -->
												</tr>
											</thead>
											<tbody id="list3-body">
												<!-- Rows will be dynamically appended here -->
											</tbody>
										</table>
										<div id="loadingMessage3"
											style="display: none; font-size: 20px; text-align: center; color: #1c6ea4; font-weight: bold;">Loading,
											please wait...</div>

									</div>
								</div>

							</div>
							<div style="margin-left: 700px">
								<button onclick="showCommonTable()"
									class="btn btn-secondary mt-3">Back</button>
							</div>
						</div>
					</div>
					<div id="loader-overlay">
						<div id="loader">
							<div class="loader-animation"></div>
						</div>
					</div>

				</div>
			</div>

		</div>

		<!-- -----------------------------------------------View-------------------------------------------------------------------------- -->
		<div th:if="${formmode}=='view'">

			<div class="card border" style="width: 1400px;">
				<div class="card-header"
					style="background-color: #e9ecef; height: 50px">
					<div
						class="d-flex justify-content-between align-items-center h-100">
						<!-- Left side: Title -->
						<div class="float-left">
							<h6 style="font-size: 1.2rem; color: black;">JOURNAL
								ENTRIES-VIEW</h6>
						</div>
					</div>

				</div>
				<div class="card-body">

					<form class=" border border-secondary" method="post"
						id="journaladd" autocomplete="off">

						<div class="row formline" style="padding: 15px 0px 2px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Tran Id</div>

							<div class="col-sm-2">
								<input type="text" name="tran_id" id="tran_id"
									th:value="${ledgervalues.tran_id}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Part Tran Id</div>
							<div class="col-sm-2">

								<input type="text" name="part_tran_id" id="part_tran_id"
									th:value="${ledgervalues.part_tran_id}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-2"></div>
						</div>

						<div class="row formline" style="padding: 0px 0px 2px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Acct NO</div>

							<div class="col-sm-2">
								<div class="input-group">
									<input type="text" name="acct_num" id="acct_num"
										th:value="${ledgervalues.acct_num}"
										class="form-control form-control-sm bg-white border border-dark"
										readonly />
								</div>
							</div>
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Acct Name</div>
							<div class="col-sm-2">


								<input type="text" name="acct_name" id="acct_name"
									th:value="${ledgervalues.acct_name}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />
							</div>
							<div class="col-sm-2"></div>
						</div>

						<div class="row formline" style="padding: 0px 0px 2px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Tran Type</div>


							<div class="col-sm-2">
								<input type="text" name="tran_type" id="tran_type"
									th:value="${ledgervalues.tran_type}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />
							</div>

							<div class="col-sm-1"></div>
							<div class="col-sm-2">Part Tran Type</div>
							<div class="col-sm-2">
								<input type="text" name="part_tran_type" id="part_tran_type"
									th:value="${ledgervalues.part_tran_type}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />
							</div>
							<div class="col-sm-2"></div>
						</div>


						<div class="row formline" style="padding: 0px 0px 2px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Account Currency</div>


							<div class="col-sm-2">
								<input type="text" name="acct_crncy" id="acct_crncy"
									th:value="${ledgervalues.acct_crncy}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />
							</div>

							<div class="col-sm-1"></div>
							<div class="col-sm-2">Tran Amt</div>
							<div class="col-sm-2">

								<input type="text" name="tran_amt1" id="tran_amt"
									th:value="${ledgervalues.tran_amt}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-2"></div>
						</div>

						<div class="row formline" style="padding: 0px 0px 2px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Tran Particulars</div>


							<div class="col-sm-2">
								<input type="text" placeholder="" name="tran_particular"
									id="tran_particular" th:value="${ledgervalues.tran_particular}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Tran Remarks</div>
							<div class="col-sm-2">

								<input type="text" name="tran_remarks" id="tran_remarks"
									th:value="${ledgervalues.tran_remarks}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-2"></div>
						</div>

						<div class="row formline" style="padding: 0px 0px 2px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Flow Code</div>


							<div class="col-sm-2">
								<input type="text" name="flow_code" id="gst_amount"
									th:value="${ledgervalues.gst_amount}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>

							<div class="col-sm-1"></div>
							<div class="col-sm-2">Flow Date</div>
							<div class="col-sm-2">

								<input type="text" placeholder="" name="flow_date" id="gst_type"
									th:value="${ledgervalues.gst_type}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-2"></div>
						</div>

						<div class="row formline" style="padding: 0px 0px 2px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Tran Date</div>


							<div class="col-sm-2">

								<input type="text" name="tran_date" id="tran_date"
									th:value="${#dates.format(ledgervalues.tran_date, 'dd-MM-yyyy')}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>

							<div class="col-sm-1"></div>
							<div class="col-sm-2">Value Date</div>
							<div class="col-sm-2">


								<input type="text" name="value_date" id="value_date"
									th:value="${#dates.format(ledgervalues.value_date, 'dd-MM-yyyy')}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />
							</div>
							<div class="col-sm-2"></div>
						</div>

						<div class="row formline" style="padding: 0px 0px 2px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Tran Code</div>


							<div class="col-sm-2">
								<input type="text" name="tran_code" id="tran_code"
									th:value="${ledgervalues.tran_code}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Tran Report Code</div>
							<div class="col-sm-2">

								<input type="text" name="tran_rpt_code" id="tran_rpt_code"
									th:value="${ledgervalues.tran_rpt_code}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-2"></div>
						</div>

						<div class="row formline" style="padding: 0px 0px 2px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Tran Ref NO</div>


							<div class="col-sm-2">
								<input type="text" name="tran_ref_no" id="tran_ref_no"
									th:value="${ledgervalues.tran_ref_no}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>

							<div class="col-sm-1"></div>
							<div class="col-sm-2">Additional Details</div>
							<div class="col-sm-2">

								<input type="text" name="add_details" id="add_details"
									th:value="${ledgervalues.add_details}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-2"></div>
						</div>

						<div class="row formline" style="padding: 0px 0px 2px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Partition Type</div>


							<div class="col-sm-2">
								<input type="text" name="partition_type" id="partition_type"
									th:value="${ledgervalues.partition_type}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>

							<div class="col-sm-1"></div>
							<div class="col-sm-2">Partition Details</div>
							<div class="col-sm-2">

								<input type="text" name="partition_det" id="partition_det"
									th:value="${ledgervalues.partition_det}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-2"></div>
						</div>

						<div class="row formline" style="padding: 0px 0px 2px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Instrument NO</div>


							<div class="col-sm-2">
								<input type="text" name="instr_num" id="instr_num"
									th:value="${ledgervalues.instr_num}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Instrument Date</div>
							<div class="col-sm-2">

								<input type="text" name="instr_date" id="instr_date"
									th:value="${ledgervalues.instr_date}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-2"></div>
						</div>

						<div class="row formline" style="padding: 0px 0px 2px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Account Currency</div>


							<div class="col-sm-2">
								<input type="text" name="ref_crncy" id="ref_crncy"
									th:value="${ledgervalues.ref_crncy}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>

							<div class="col-sm-1"></div>
							<div class="col-sm-2">Home Currency Amount</div>
							<div class="col-sm-2">

								<input type="text" name="ref_crncy_amt" id="ref_crncy_amt"
									th:value="${ledgervalues.ref_crncy_amt}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-2"></div>
						</div>

						<div class="row formline" style="padding: 0px 0px 2px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Rate Code</div>


							<div class="col-sm-2">
								<input type="text" name="rate_code" id="rate_code"
									th:value="${ledgervalues.rate_code}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>

							<div class="col-sm-1"></div>
							<div class="col-sm-2">Rate</div>
							<div class="col-sm-2">


								<input type="text" name="rate" id="rate"
									th:value="${ledgervalues.rate}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />
							</div>
							<div class="col-sm-2"></div>
						</div>

						<div class="row formline" style="padding: 0px 0px 10px 50px;">
							<div class="col-sm-1"></div>
							<div class="col-sm-2">Tran Status</div>


							<div class="col-sm-2">
								<input type="text" name="tran_status" id="tran_status"
									th:value="${ledgervalues.tran_status}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>

							<div class="col-sm-1"></div>
							<div class="col-sm-2">Deleted</div>
							<div class="col-sm-2">

								<input type="text" placeholder="" name="del_flg" id="del_flg"
									th:value="${ledgervalues.del_flg}"
									class="form-control form-control-sm bg-white border border-dark"
									readonly />

							</div>
							<div class="col-sm-2"></div>
						</div>

						<div
							class="d-flex justify-content-end align-items-center mr-3 mb-2">
							<button id="previous-btn" class="btn btn-primary me-2"
								onclick="getPartTranRecords(this);">Previous</button>
							<span class="mx-1" th:text="${currentPartTran}"
								id="currentPartTran"></span> <span class="mx-1">/</span> <span
								class="mx-1" id="maxPartTran" th:text="${maxPartTran}"></span>
							<button id="next-btn" class="btn btn-primary ms-2"
								onclick="getPartTranRecords(this);">Next</button>
						</div>
						<br>
						<div class="table-responsive">
							<table class="table  table-bordered table-sm d-none"
								style="margin-bottom: 0px; font-size: initial; width: 100%;"
								id="transactionaccountvalues">
								<thead class="thead-light">
									<tr>
										<th style="text-align: left; width: 20%;">GENERAL LEDGER</th>
										<th style="text-align: left; width: 20%;">GL SUB HEAD</th>
										<th style="text-align: left; width: 20%;">CRNCY</th>
										<th style="text-align: center; width: 20%;">ACCOUNT
											BALANCE</th>
										<th style="text-align: left; width: 20%;">BALANCE IND</th>
									</tr>
								</thead>
								<tbody id="transactionaccountvaluesbody">


								</tbody>
							</table>
						</div>

						<div class="table-responsive">
							<table class="table  table-bordered table-sm d-none"
								style="margin-bottom: 0px; font-size: initial; table-layout: fixed; width: 100%;"
								id="transactionTable">
								<thead class="thead-light">

									<tr>
										<th style="text-align: center">TRAN DATE</th>
										<th style="text-align: center">TRAN ID</th>
										<th style="text-align: center">PA TRAN TY</th>
										<th style="text-align: center">CURRENCY</th>
										<th style="text-align: center">AMOUNT</th>
										<th style="text-align: center">ACCT NUM</th>
										<th style="text-align: center; width: 20%;">ACCT NAME</th>
										<th style="text-align: center; width: 20%;">TRAN
											PARTICULAR</th>
										<th style="text-align: center">STATUS</th>

									</tr>
								</thead>
								<tbody id="transactionTableBody">


								</tbody>
							</table>
						</div>




					</form>

					<div class="table-responsive">
						<table class="table table-bordered table-hover table-sm d-none"
							style="margin-bottom: 0px; font-size: initial; table-layout: fixed; width: 100%;"
							id="usertablevalues">
							<thead class="thead-light">
								<tr>
									<th style="text-align: left">TRAN DATE</th>
									<th style="text-align: left">TRAN ID</th>
									<th style="text-align: left">PA TRAN TY</th>
									<th style="text-align: left">CURRENCY</th>
									<th style="text-align: right">AMOUNT</th>
									<th style="text-align: left">ACCT NUM</th>
									<th style="text-align: left; width: 20%;">ACCT NAME</th>
									<th style="text-align: left">STATUS</th>
									<th style="text-align: center">SELECT</th>
								</tr>
							</thead>
							<tbody id="placelist">
								<tr th:each="details : ${jour}">
									<td
										th:text="${details.tran_date != null ? #dates.format(details.tran_date,'dd-MM-yyyy') : ''}">
									</td>
									<td
										th:text="${details.tran_id} + '/' + ${details.part_tran_id}"></td>
									<td th:text="${details.part_tran_type}"></td>
									<td th:text="${details.acct_crncy}"></td>
									<td style="text-align: right;"
										th:text="${details?.tran_amt == 0 ? '0.00' : #numbers.formatDecimal(details?.tran_amt, 0, 'COMMA', 2, 'POINT')}">
									</td>
									<td th:text="${details.acct_num}"></td>
									<td th:text="${details.acct_name}"></td>
									<td th:text="${details.tran_status}"></td>
									<td style="text-align: center;"><input type="radio"
										id="radioSelect" name="actionRadio"
										th:attr="data-tranid=${details.tran_id}, data-partnid=${details.part_tran_id}, data-acctnum=${details.acct_num}"
										onclick="selectActions(this);"></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="card-footer text-center"
					style="background-color: #e9ecef">


					<button class="btn btn-primary p-2" onclick="Home();">Home</button>
					<button class="btn btn-primary p-2" onclick="views(this);">View</button>
					<button class="btn btn-primary p-2" onclick="Back();">Back</button>


				</div>

			</div>
		</div>

	</div>

	<div id="myModal" class="modal" data-backdrop="false">
		<div class="modal-content" id="submodel">
			<span class="close" id="closebtn">&times;</span>
			<h2 style="text-align: center" class="h2">Transaction Details</h2>
			<div class="modal-row">
				<span class="modal-label"><strong>Account Number:</strong></span> <span
					id="modal-acctnum" class="modal-value"></span>
			</div>
			<div class="modal-body" id="modelBody">
				<div class="modal-row">
					<span class="modal-label"><strong>Credit Balance:</strong></span> <span
						id="modal-credit" class="modal-value"></span>
				</div>
				<div class="modal-row">
					<span class="modal-label"><strong>Debit Balance:</strong></span> <span
						id="modal-debit" class="modal-value"></span>
				</div>
				<div class="modal-row">
					<span class="modal-label"><strong>Total Balance:</strong></span> <span
						id="modal-total" class="modal-value"></span>
				</div>
			</div>
		</div>
	</div>

	<!-- <div id="myModal2" class="modal">
    <div class="modal-content" id="submodel">
        <span class="close" id="closebtn2">&times;</span>
        <h2 style="text-align: center" class="h2">SPF Details For <span></span></h2>
        <div class="modal-body2" id="modelBody" style="max-height: 100vh; overflow-y: auto; border: 1px solid #ddd; height: 600px">
            <table border="1" >
                <thead id="model2" style="position: sticky; top: 0; background-color: #f8f9fa; z-index: 1;">
                    <tr>
                        <th style="width:80px;">Employee Number</th>
                        <th>Employee Name</th>                       
                        <th style="width:100px;">Sal Month</th>
                        <th style="width:100px;text-align:right">Basic Pay</th>
                        <th style="width:100px;text-align:right">Gross Salary</th>
                        <th style="text-align:right;width:100px">SPF</th>
                    </tr>
                </thead>
                <tbody id="modal-table-body" >
                   
                </tbody>
            </table>
        </div>
    </div>
</div> -->


	<!-- <div id="myModal2" class="modal">
		<div class="modal-content" id="submodel">
			<span class="close" id="closebtn2">&times;</span>
			<h2 style="text-align: center" class="h2">
				SPF Details For <span></span>
			</h2>
			<div class="modal-body2" id="modelBody"
				style="max-height: 100vh; overflow-y: auto; border: 1px solid #ddd; height: 600px">
				<table border="1">
					<thead id="model2"
						style="position: sticky; top: 0; background-color: #f8f9fa; z-index: 1;">
						<tr>
							<th style="width: 80px;">Employee Number</th>
							<th>Employee Name</th>
							<th style="width: 100px;">Sal Month</th>
							<th style="width: 100px; text-align: right">Basic Pay</th>
							<th style="width: 100px; text-align: right">Gross Salary</th>
							<th style="text-align: right; width: 100px">SPF</th>
							<th style="width: 80px; text-align: center;">Actions</th>
						</tr>
					</thead>
					<tbody id="modal-table-body">
					</tbody>
				</table>
			</div>
		</div>
	</div> -->


	<div id="myModal2" class="modal">
		<div class="modal-content" id="submodel">
			<span class="close" id="closebtn2">&times;</span>
			<h2 style="text-align: center; margin-bottom: 0px;" class="h2">
				SPF Details For <span></span>
			</h2>
			<!-- Single "View" Button Below the H2 -->
			<div style="text-align: center; margin: 10px 0;">
				<button id="view-action"
					style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
					View</button>
			</div>
			<div class="modal-body2" id="modelBody"
				style="max-height: 100vh; overflow-y: auto; border: 1px solid #ddd; height: 600px">
				<table border="1">
					<thead id="model2"
						style="position: sticky; top: 0; background-color: #f8f9fa; z-index: 1;">
						<tr>
							<th style="width: 80px;">Employee Number</th>
							<th>Employee Name</th>
							<th style="width: 100px;">Sal Month</th>
							<th style="width: 100px; text-align: right">Basic Pay</th>
							<th style="width: 100px; text-align: right">Gross Salary</th>
							<th style="text-align: right; width: 100px">SPF</th>
						</tr>
					</thead>
					<tbody id="modal-table-body">
					</tbody>
				</table>
			</div>
		</div>
	</div>


	<div id="myModal3" class="modal">
		<div class="modal-content" id="submodel">
			<span class="close" id="closebtn3">&times;</span>
			<h2 style="text-align: center; margin-bottom: 0px;" class="h2">
				ESI Details For <span></span>
			</h2>
			<div style="text-align: center; margin: 10px 0;">
				<button id="view-action2"
					style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
					View</button>
			</div>
			<div class="modal-body2" id="modelBody"
				style="max-height: 100vh; overflow-y: auto; border: 1px solid #ddd; height: 600px">
				<table border="1">
					<thead id="model2"
						style="position: sticky; top: 0; background-color: #f8f9fa; z-index: 1;">
						<tr>
							<th>Employee Number</th>
							<th>Employee Name</th>
							<th>Salary Month</th>
							<th style="width: 100px; text-align: right">Basic Pay</th>
							<th style="width: 100px; text-align: right">Gross Salary</th>
							<th style="text-align: right; width: 100px">ESI</th>
						</tr>
					</thead>
					<tbody id="modal-table-body1">

					</tbody>
				</table>
			</div>
		</div>
	</div>


</body>

<script>
/* BHARATH */
var acct_num;
function enableTabs(initialTabId, acctnum) {
    console.log("acct_num: " + acctnum);
    acct_num = acctnum;
    var currentdateElement = document.getElementById("todate3");
    console.log("currentdate1"+currentdateElement);
    
    

    // Show the loader overlay
    $('#loader-overlay').show();

    // Create an array to hold all AJAX promises
    const ajaxPromises = [];

    // First AJAX call to fetch account details
    const acctDetailsPromise = $.ajax({
        url: './gettranvalue',
        type: 'GET',
        data: { acctnum: acctnum },
        success: function (data) {
            console.log(data);
            if (data.acct_num && data.acct_name) {
                $('#acct_num1, #acct_num2, #acct_num3').val(data.acct_num);
                $('#acct_name1, #acct_name2, #acct_name3').val(data.acct_name);
            } else {
                $('#acct_num, #acct_name').val('');
            }
        },
        error: function (error) {
            console.error('Error fetching account details:', error);
        }
    });
    ajaxPromises.push(acctDetailsPromise);

    // Second AJAX call to fetch transaction balance and nested ledger data
    const transactionBalancePromise = $.ajax({
        url: './getTranbal2',
        type: 'GET',
        data: { acctnum: acctnum },
        success: function (balanceData) {
            console.log("Balance Data:", balanceData);
            let tableBody = $('#usertable tbody');
            tableBody.empty();
            let balanceData1 = (typeof balanceData !== 'string') ? String(balanceData) : balanceData;
            console.log('Updated balanceData1:', balanceData1);

            if (balanceData1.includes(',')) {
                let [dateString, balance] = balanceData1.split(',');
                let date = new Date(dateString);
                let formattedDate = `${('0' + date.getDate()).slice(-2)}-${('0' + (date.getMonth() + 1)).slice(-2)}-${date.getFullYear()}`;
                let formattedBalance = parseFloat(balance);

                console.log(`Formatted Date: ${formattedDate}`);
                console.log(`Formatted Balance: ${formattedBalance.toFixed(2)}`);

                let headerHTML = ` 
                    <tr>
                        <td colspan="1"><strong>B/F:</strong> ${formattedDate}</td>
                        <td colspan="2"></td>
                        <td colspan="3"></td>
                        <td colspan="1" style="text-align:right">${formattedBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    </tr>`;
                tableBody.append(headerHTML);

                $.ajax({
                    url: './getledgerdata',
                    type: 'GET',
                    data: { acctnum: acctnum },
                    success: function (data) {
                        console.log("Ledger Data:", data);
                        let firstTranDate = data[0].tran_date ? formatDate(data[0].tran_date) : '';
                        $('#fromdate').val(firstTranDate);

                        let currentBalance = formattedBalance;

                        data.forEach(function (entry) {
                            let formattedDate = entry.tran_date ? formatDate(entry.tran_date) : '';

                            let debitAmount = (entry.part_tran_type === 'debit') ? parseFloat(entry.tran_amt) : 0.00;
                            let creditAmount = (entry.part_tran_type === 'credit') ? parseFloat(entry.tran_amt) : 0.00;

                            currentBalance += (entry.part_tran_type === 'debit') ? -debitAmount : creditAmount;

                            let formattedDebit = debitAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                            let formattedCredit = creditAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                            let formattedUpdatedBalance = currentBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                            let indicator = currentBalance < 0 ? 'DR' : 'CR';

                            tableBody.append(`
                                <tr>
                                    <td>${formattedDate}</td>
                                    <td style="color: #0000EE; text-decoration: underline; cursor: pointer;" 
                                        onclick="showdetails('${entry.tran_id}', '${entry.part_tran_id}', '${entry.acct_num}')">
                                        ${entry.tran_id} / ${entry.part_tran_id}
                                    </td>
                                    <td>${entry.tran_particular}</td>
                                    <td>${entry.acct_crncy}</td>
                                    <td style="text-align:right">${formattedDebit}</td>
                                    <td style="text-align:right">${formattedCredit}</td>
                                    <td style="text-align:right">${formattedUpdatedBalance}</td>
                                    <td style="text-align:right">${indicator}</td>
                                </tr>
                            `);
                        });
                    },
                    error: function (error) {
                        console.error("Error fetching ledger data:", error);
                    }
                });
            }
        },
        error: function (error) {
            console.error("Error fetching transaction balance:", error);
        }
    });
    ajaxPromises.push(transactionBalancePromise);

    // Third AJAX call to fetch list2 data
    const list2DataPromise = $.ajax({
        url: './setlist2',
        type: 'GET',
        data: { acctnum: acctnum },
        success: function (list2Data) {
            console.log("List2 data:", list2Data);
            $('#list2 tbody, #list3 tbody').empty();

            if (list2Data && list2Data.length > 0) {
                let firstTranDate = list2Data[0].tran_date ? formatDate(list2Data[0].tran_date) : '';
                $('#fromdate2').val(firstTranDate);

                list2Data.forEach(function (item) {
                    let row = `
                        <tr>
                            <td>${item.tran_date ? new Date(item.tran_date).toLocaleDateString('en-GB') : ''}</td>
                            <td style="color: #0000EE;text-decoration: underline;cursor:pointer" onclick="showdetails('${item.tran_id}', '${item.part_tran_id}','${item.acct_num}')"> ${item.tran_id} / ${item.part_tran_id}</td>
                            <td>${item.part_tran_type || ''}</td>
                            <td>${item.acct_crncy || ''}</td>
                            <td style="text-align: right;">${item.tran_amt ? formatDecimal(item.tran_amt, 2) : '0.00'}</td>
                            <td style="text-align: right;">${item.acct_num || ''}</td>
                            <td style="text-align: left;">${item.acct_name || ''}</td>
                            <td style="text-align: left;">${item.tran_particular || ''}</td>
                            <td style="text-align: left;">${item.tran_status || ''}</td>
                        </tr>
                    `;
                    $('#list2 tbody').append(row);
                });
            } else {
                console.log("No account details found.");
            }
        },
        error: function (error) {
            console.error('Error fetching list2 data:', error);
        }
    });
    ajaxPromises.push(list2DataPromise);

    
    const fourthDataPromise = $.ajax({
        url: './setlist3',
        type: 'GET',
        data: { acctnum: acctnum},
        success: function (additionalData) {
            console.log("Additional data:", additionalData);
            $('#list3 tbody').empty();
            if (additionalData && additionalData.length > 0) {
                let firstTranDate = additionalData[0].tran_date ? formatDate(additionalData[0].tran_date) : '';
                $('#fromdate3').val(firstTranDate);

                additionalData.forEach(function (item) {
                    let row = `
                        <tr>
                            <td>${item.tran_date ? new Date(item.tran_date).toLocaleDateString('en-GB') : ''}</td>
                            <td style="color: #0000EE;text-decoration: underline;cursor:pointer" onclick="showdetails('${item.tran_id}', '${item.part_tran_id}','${item.acct_num}')"> ${item.tran_id} / ${item.part_tran_id}</td>
                            <td>${item.part_tran_type || ''}</td>
                            <td>${item.acct_crncy || ''}</td>
                            <td style="text-align: right;">${item.tran_amt ? formatDecimal(item.tran_amt, 2) : '0.00'}</td>
                            <td style="text-align: right;">${item.acct_num || ''}</td>
                            <td style="text-align: left;">${item.acct_name || ''}</td>
                            <td style="text-align: left;">${item.tran_particular || ''}</td>
                            <td style="text-align: left;">${item.tran_status || ''}</td>
                        </tr>
                    `;
                    $('#list3 tbody').append(row);
                });
            } else {
                console.log("No account details found.");
            }
        },
        error: function (error) {
            console.error('Error fetching additional data:', error);
        }
    });
    ajaxPromises.push(fourthDataPromise);

    Promise.all(ajaxPromises).then(() => {
        console.log("All AJAX calls completed.");
        $('#loader-overlay').hide(); 
    }).catch((error) => {
        console.error("Error in one of the AJAX calls:", error);
        $('#loader-overlay').hide(); 
    });

    document.getElementById('CommonTable').style.display = 'none';
    document.getElementById('TabButtons').style.display = 'block';
    showTab('tab1');

    if (initialTabId !== 'tab1') {
        setTimeout(() => showTab(initialTabId), 0);
    }
}



function showdetails(tranId, partTranId,acct_num) {
	console.log("tranId"+tranId);
	console.log("partTranId"+partTranId);
	console.log("Acct_num"+acct_num);
	
	var url = 'admininq?formmode=view&tranId=' + tranId
				+ '&partTranId=' + partTranId + '&acct_num=' + acct_num; 
	location.href = url;
    
}

function formatDate(inputDate) {
    if (!inputDate) return '';
    const date = new Date(inputDate);
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const year = date.getFullYear();
    return `${day}-${month}-${year}`;
}

function showTab(tabId) {
    const tabContents = document.querySelectorAll('.tabcontent');
    tabContents.forEach((tab) => (tab.style.display = 'none'));

    const tabElement = document.getElementById(tabId);
    tabElement.style.display = 'block';

    const tabLinks = document.querySelectorAll('.tablinks');
    tabLinks.forEach((tab) => {
        tab.style.backgroundColor = ''; // Reset to default
        tab.style.color = ''; // Reset text color if necessary
    });

    const activeButton = document.querySelector(`.tablinks[onclick="showTab('${tabId}')"]`);
    if (activeButton) {
        activeButton.style.backgroundColor = '#13739F'; // Set background to peacock blue
        activeButton.style.color = 'white'; // Optional: Set text color for better contrast
    }
}


function showCommonTable() {
   
    const tabContents = document.querySelectorAll('.tabcontent');
    tabContents.forEach((tab) => (tab.style.display = 'none'));

    
    document.getElementById('CommonTable').style.display = 'block';
    document.getElementById('TabButtons').style.display = 'none';
 setTimeout(() => {
        location.reload();
    }, 100); // Delay the reload slightly to ensure DOM updates are applied
}

function formatDate(dateString) {
    let date = new Date(dateString);
    let day = String(date.getDate()).padStart(2, '0'); // Add leading zero if necessary
    let month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based, so add 1
    let year = date.getFullYear();
    return `${day}-${month}-${year}`;
}

//Function to format a number with commas and fixed decimal places
function formatDecimal(num, decimals) {
    if (isNaN(num)) return '0.00';
    return num.toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
}

function showAccountList() {
    const acctList = document.getElementById('acctList');
    if (acctList.style.display === 'none' || acctList.style.display === '') {
        acctList.style.display = 'block'; // Show the list
    } else {
        acctList.style.display = 'none'; // Hide the list
    }
}
function showAccountList2() {
    const acctList = document.getElementById('acctList2');
    if (acctList.style.display === 'none' || acctList.style.display === '') {
        acctList.style.display = 'block'; // Show the list
    } else {
        acctList.style.display = 'none'; // Hide the list
    }
}
function showAccountList3() {
    const acctList = document.getElementById('acctList3');
    if (acctList.style.display === 'none' || acctList.style.display === '') {
        acctList.style.display = 'block'; // Show the list
    } else {
        acctList.style.display = 'none'; // Hide the list
    }
}
function showAccountList4() {
    const acctList = document.getElementById('acctList4');
    if (acctList.style.display === 'none' || acctList.style.display === '') {
        acctList.style.display = 'block'; // Show the list
    } else {
        acctList.style.display = 'none'; // Hide the list
    }
}
function showAccountList5() {
    const acctList = document.getElementById('acctList5');
    if (acctList.style.display === 'none' || acctList.style.display === '') {
        acctList.style.display = 'block'; // Show the list
    } else {
        acctList.style.display = 'none'; // Hide the list
    }
}
$(function () {
    $("#fromdate2").datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: "dd-mm-yy",
        maxDate: 0,
        onSelect: function (selected) {
            var dt = $(this).datepicker('getDate');
            if (dt) {
                dt.setDate(dt.getDate());
                $("#todate2").datepicker("option", "minDate", dt);
            }
        }
    });

    $("#todate2").datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: "dd-mm-yy",
        maxDate: 0,
        onSelect: function (selected) {
            var fromdate = $("#fromdate2").val();
            var todate = $("#todate2").val();
            console.log("fromdate2"+fromdate);
            console.log("todate2"+todate);

            if (!fromdate2) {
                alert("Enter From date");
            } else {
                funcall2();
            }
        }
    });
});
$(function () {
    $("#fromdate3").datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: "dd-mm-yy",
        maxDate: 0,
        onSelect: function (selected) {
            var dt = $(this).datepicker('getDate');
            if (dt) {
                dt.setDate(dt.getDate());
                $("#todate3").datepicker("option", "minDate", dt);
            }
        }
    });

    $("#todate3").datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: "dd-mm-yy",
        maxDate: 0,
        onSelect: function (selected) {
            var fromdate = $("#fromdate3").val();
            var todate = $("#todate3").val();
            console.log("fromdate3"+fromdate);
            console.log("todate3"+todate);

            if (!fromdate3) {
                alert("Enter From date");
            } else {
                funcall3();
            }
        }
    });
});
$(function () {
    $("#fromdate").datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: "dd-mm-yy",
        maxDate: 0,
        onSelect: function (selected) {
            var dt = $(this).datepicker('getDate');
            if (dt) {
                dt.setDate(dt.getDate());
                $("#todate").datepicker("option", "minDate", dt);
            }
        }
    });

    $("#todate").datepicker({
        changeMonth: true,
        changeYear: true,
        dateFormat: "dd-mm-yy",
        maxDate: 0,
        onSelect: function (selected) {
            var fromdate = $("#fromdate").val();
            var todate = $("#todate").val();
            console.log("fromdate"+fromdate);
            console.log("todate"+todate);

            if (!fromdate) {
                alert("Enter From date");
            } else {
                funcall();
            }
        }
    });
});
function setCurrentDate1() {
	var today = new Date();
	var dd = String(today.getDate()).padStart(2, '0');
	var mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
	var yyyy = today.getFullYear();
	var currentDate = dd + '-' + mm + '-' + yyyy; // Format: dd-MM-yyyy

	document.getElementById('todate').value = currentDate;
}
function setCurrentDate2() {
	var today = new Date();
	var dd = String(today.getDate()).padStart(2, '0');
	var mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
	var yyyy = today.getFullYear();
	var currentDate = dd + '-' + mm + '-' + yyyy; // Format: dd-MM-yyyy

	document.getElementById('todate2').value = currentDate;
}
function setCurrentDate3() {
	var today = new Date();
	var dd = String(today.getDate()).padStart(2, '0');
	var mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
	var yyyy = today.getFullYear();
	var currentDate = dd + '-' + mm + '-' + yyyy; // Format: dd-MM-yyyy

	document.getElementById('todate3').value = currentDate;
}
window.onload = function() {
	setCurrentDate1();
	setCurrentDate2();
	setCurrentDate3();
};

function funcall() { 
    var acctnum = $('#acct_num1').val();
    var fromdate = $('#fromdate').val();
    var todate = $('#todate').val();
    
    console.log("acct_num2"+acctnum);

    console.log("fromdate"+fromdate);

    if(acctnum=="2100002180" || acctnum== "6200006215" || acctnum== "6200006216"){
    	 $.ajax({
    	        url: './getTranbal', 
    	        type: 'GET',
    	        data: {
    	            acctnum: acctnum,
    	            fromdate: fromdate
    	        },
    	        success: function (balanceData) {
    	            let tableBody = $('#usertable tbody');
    	            tableBody.empty(); // Clear previous rows
    	            $('#loadingMessage').show(); 
    	            let balanceData1 = (typeof balanceData !== 'string') ? String(balanceData) : balanceData;
    	            console.log('Updated balanceData1:', balanceData1);

    	            if (balanceData1.includes(',')) {
    	                let [dateString, balance] = balanceData1.split(',');
    	                let date = new Date(dateString);
    	                let formattedDate = `${('0' + date.getDate()).slice(-2)}-${('0' + (date.getMonth() + 1)).slice(-2)}-${date.getFullYear()}`;
    	                let formattedBalance = parseFloat(balance);

    	                console.log(`Formatted Date: ${formattedDate}`);
    	                console.log(`Formatted Balance: ${formattedBalance.toFixed(2)}`);

    	                // Add B/F row
    	                let headerHTML = ` 
    	                    <tr>
    	                        <td colspan="1"><strong>B/F:</strong> ${formattedDate}</td>
    	                        <td colspan="2"></td>
    	                        <td colspan="3"></td>
    	                        <td colspan="1" style="text-align:right">${formattedBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
    	                    </tr>`;
    	                tableBody.append(headerHTML);

    	                // Second AJAX call to get transaction records
    	                $.ajax({
    	                    url: './getTransactionRecords',
    	                    type: 'GET',
    	                    data: {
    	                        acctnum: acctnum,
    	                        fromdate: fromdate,
    	                        todate: todate
    	                    },
    	                    success: function (data) {
    	                        console.log("Received data:", data);

    	                        // Start with the initial balance from the first AJAX response
    	                        let currentBalance = formattedBalance;

    	                        // Iterate through the data and populate the table
    	                        data.forEach(function (entry) {
    	                            let formattedDate = entry.tran_date ? formatDate(entry.tran_date) : '';

    	                            // Parse debit and credit amounts
    	                            let debitAmount = (entry.part_tran_type === 'debit') ? parseFloat(entry.tran_amt) : 0.00;
    	                            let creditAmount = (entry.part_tran_type === 'credit') ? parseFloat(entry.tran_amt) : 0.00;

    	                            // Update the current balance
    	                            currentBalance += (entry.part_tran_type === 'debit') ? -debitAmount : creditAmount;

    	                            // Format amounts with commas
    	                            let formattedDebit = debitAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    	                            let formattedCredit = creditAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    	                            let formattedUpdatedBalance = currentBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

    	                            let indicator = '';
    		                        if (currentBalance < 0) {
    		                            indicator = 'DR';  // Debit if balance is negative
    		                        } else if (currentBalance >= 0) {
    		                            indicator = 'CR';  // Credit if balance is positive
    		                        }
    	                            let row = `
    	                                <tr>
    	                                    <td>${formattedDate}</td>
    	                                    <td style="color: #0000EE;text-decoration: underline;cursor:pointer;" onclick="showdetails('${entry.tran_id}', '${entry.part_tran_id}','${entry.acct_num}')">${entry.tran_id} / ${entry.part_tran_id}</td>
    	                                    <td>${entry.tran_particular}</td>
    	                                    <td>${entry.acct_crncy}</td>
    	                                    <td style="color: #0000EE;text-decoration: underline;cursor:pointer;text-align:right"
    	                                    	onclick="showdetails4('${entry.tran_date}')">${formattedDebit}</td>
    	                                    <td style="color: #0000EE;text-decoration: underline;cursor:pointer;text-align:right" 
    	                                    onclick="showdetails2('${entry.tran_date}')">${formattedCredit}</td>
    	                                    <td style="text-align:right">${formattedUpdatedBalance}</td>
    	                                    <td style="text-align:right">${indicator}</td>
    	                                </tr>
    	                            `;
    	                            tableBody.append(row);
    	                            $('#loadingMessage').hide();
    	                        });
    	                    },
    	                    error: function (error) {
    	                        console.error("Error fetching transaction records:", error);
    	                    }
    	                });
    	            } else {
    	                console.error('Invalid balanceData1 format');
    	            }
    	        },
    	        error: function (error) {
    	            console.error("Error fetching balance data:", error);
    	        }
    	    });
    }
    else if(acctnum== "2100002185" || acctnum =="6200006217"){
    $.ajax({
        url: './getTranbal', 
        type: 'GET',
        data: {
            acctnum: acctnum,
            fromdate: fromdate
        },
        success: function (balanceData) {
            let tableBody = $('#usertable tbody');
            tableBody.empty(); // Clear previous rows
            $('#loadingMessage').show(); 
            let balanceData1 = (typeof balanceData !== 'string') ? String(balanceData) : balanceData;
            console.log('Updated balanceData1:', balanceData1);

            if (balanceData1.includes(',')) {
                let [dateString, balance] = balanceData1.split(',');
                let date = new Date(dateString);
                let formattedDate = `${('0' + date.getDate()).slice(-2)}-${('0' + (date.getMonth() + 1)).slice(-2)}-${date.getFullYear()}`;
                let formattedBalance = parseFloat(balance);

                console.log(`Formatted Date: ${formattedDate}`);
                console.log(`Formatted Balance: ${formattedBalance.toFixed(2)}`);

                // Add B/F row
                let headerHTML = ` 
                    <tr>
                        <td colspan="1"><strong>B/F:</strong> ${formattedDate}</td>
                        <td colspan="2"></td>
                        <td colspan="3"></td>
                        <td colspan="1" style="text-align:right">${formattedBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    </tr>`;
                tableBody.append(headerHTML);

                // Second AJAX call to get transaction records
                $.ajax({
                    url: './getTransactionRecords',
                    type: 'GET',
                    data: {
                        acctnum: acctnum,
                        fromdate: fromdate,
                        todate: todate
                    },
                    success: function (data) {
                        console.log("Received data:", data);

                        // Start with the initial balance from the first AJAX response
                        let currentBalance = formattedBalance;

                        // Iterate through the data and populate the table
                        data.forEach(function (entry) {
                            let formattedDate = entry.tran_date ? formatDate(entry.tran_date) : '';

                            // Parse debit and credit amounts
                            let debitAmount = (entry.part_tran_type === 'debit') ? parseFloat(entry.tran_amt) : 0.00;
                            let creditAmount = (entry.part_tran_type === 'credit') ? parseFloat(entry.tran_amt) : 0.00;

                            // Update the current balance
                            currentBalance += (entry.part_tran_type === 'debit') ? -debitAmount : creditAmount;

                            // Format amounts with commas
                            let formattedDebit = debitAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                            let formattedCredit = creditAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                            let formattedUpdatedBalance = currentBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                            let indicator = '';
	                        if (currentBalance < 0) {
	                            indicator = 'DR';  // Debit if balance is negative
	                        } else if (currentBalance >= 0) {
	                            indicator = 'CR';  // Credit if balance is positive
	                        }
                            let row = `
                                <tr>
                                    <td>${formattedDate}</td>
                                    <td style="color: #0000EE;text-decoration: underline;cursor:pointer;" onclick="showdetails('${entry.tran_id}', '${entry.part_tran_id}','${entry.acct_num}')">${entry.tran_id} / ${entry.part_tran_id}</td>
                                    <td>${entry.tran_particular}</td>
                                    <td>${entry.acct_crncy}</td>
                                    <td style="color: #0000EE;text-decoration: underline;cursor:pointer;text-align:right"
                                    	onclick="showdetails5('${entry.tran_date}')">${formattedDebit}</td>
                                    <td style="color: #0000EE;text-decoration: underline;cursor:pointer;text-align:right"
                                    	onclick="showdetails3('${entry.tran_date}')">${formattedCredit}</td>
                                    <td style="text-align:right">${formattedUpdatedBalance}</td>
                                    <td style="text-align:right">${indicator}</td>
                                </tr>
                            `;
                            tableBody.append(row);
                            $('#loadingMessage').hide();
                        });
                    },
                    error: function (error) {
                        console.error("Error fetching transaction records:", error);
                    }
                });
            } else {
                console.error('Invalid balanceData1 format');
            }
        },
        error: function (error) {
            console.error("Error fetching balance data:", error);
        }
    });

    }else{
    	 $.ajax({
    	        url: './getTranbal', 
    	        type: 'GET',
    	        data: {
    	            acctnum: acctnum,
    	            fromdate: fromdate
    	        },
    	        success: function (balanceData) {
    	            let tableBody = $('#usertable tbody');
    	            tableBody.empty(); // Clear previous rows
    	            $('#loadingMessage').show(); 
    	            let balanceData1 = (typeof balanceData !== 'string') ? String(balanceData) : balanceData;
    	            console.log('Updated balanceData1:', balanceData1);

    	            if (balanceData1.includes(',')) {
    	                let [dateString, balance] = balanceData1.split(',');
    	                let date = new Date(dateString);
    	                let formattedDate = `${('0' + date.getDate()).slice(-2)}-${('0' + (date.getMonth() + 1)).slice(-2)}-${date.getFullYear()}`;
    	                let formattedBalance = parseFloat(balance);

    	                console.log(`Formatted Date: ${formattedDate}`);
    	                console.log(`Formatted Balance: ${formattedBalance.toFixed(2)}`);

    	                // Add B/F row
    	                let headerHTML = ` 
    	                    <tr>
    	                        <td colspan="1"><strong>B/F:</strong> ${formattedDate}</td>
    	                        <td colspan="2"></td>
    	                        <td colspan="3"></td>
    	                        <td colspan="1" style="text-align:right">${formattedBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
    	                    </tr>`;
    	                tableBody.append(headerHTML);

    	                // Second AJAX call to get transaction records
    	                $.ajax({
    	                    url: './getTransactionRecords',
    	                    type: 'GET',
    	                    data: {
    	                        acctnum: acctnum,
    	                        fromdate: fromdate,
    	                        todate: todate
    	                    },
    	                    success: function (data) {
    	                        console.log("Received data:", data);

    	                        // Start with the initial balance from the first AJAX response
    	                        let currentBalance = formattedBalance;

    	                        // Iterate through the data and populate the table
    	                        data.forEach(function (entry) {
    	                            let formattedDate = entry.tran_date ? formatDate(entry.tran_date) : '';

    	                            // Parse debit and credit amounts
    	                            let debitAmount = (entry.part_tran_type === 'debit') ? parseFloat(entry.tran_amt) : 0.00;
    	                            let creditAmount = (entry.part_tran_type === 'credit') ? parseFloat(entry.tran_amt) : 0.00;

    	                            // Update the current balance
    	                            currentBalance += (entry.part_tran_type === 'debit') ? -debitAmount : creditAmount;

    	                            // Format amounts with commas
    	                            let formattedDebit = debitAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    	                            let formattedCredit = creditAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    	                            let formattedUpdatedBalance = currentBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

    	                            let indicator = '';
    		                        if (currentBalance < 0) {
    		                            indicator = 'DR';  // Debit if balance is negative
    		                        } else if (currentBalance >= 0) {
    		                            indicator = 'CR';  // Credit if balance is positive
    		                        }
    	                            let row = `
    	                                <tr>
    	                                    <td>${formattedDate}</td>
    	                                    <td style="color: #0000EE;text-decoration: underline;cursor:pointer;" onclick="showdetails('${entry.tran_id}', '${entry.part_tran_id}','${entry.acct_num}')">${entry.tran_id} / ${entry.part_tran_id}</td>
    	                                    <td>${entry.tran_particular}</td>
    	                                    <td>${entry.acct_crncy}</td>
    	                                    <td style="text-align:right">${formattedDebit}</td>
    	                                    <td style="text-align:right">${formattedCredit}</td>
    	                                    <td style="text-align:right">${formattedUpdatedBalance}</td>
    	                                    <td style="text-align:right">${indicator}</td>
    	                                </tr>
    	                            `;
    	                            tableBody.append(row);
    	                            $('#loadingMessage').hide();
    	                        });
    	                    },
    	                    error: function (error) {
    	                        console.error("Error fetching transaction records:", error);
    	                    }
    	                });
    	            } else {
    	                console.error('Invalid balanceData1 format');
    	            }
    	        },
    	        error: function (error) {
    	            console.error("Error fetching balance data:", error);
    	        }
    	    });

    }
}

/* function funcall2() { 
    
    var fromdate = $('#fromdate2').val();
    var todate = $('#todate2').val();
    var acct_num = $('#acct_num2').val();
    
    console.log("acct_num2"+acct_num);
    console.log("fromdate"+fromdate);
    console.log("todate"+todate);

    
    let tableBody = $('#list2 tbody');
    tableBody.empty(); 
    $('#loadingMessage2').show(); 
    $.ajax({
        url: './getTransactionRecords2',
        type: 'GET',
        data: {
        	acct_num: acct_num,
            fromdate: fromdate,
            todate: todate
        },
        success: function (data) {
        	 if (data && data.length > 0) {
        		 data.forEach(function (item) {
                    let row = `
                        <tr>
                            <td>${item.tran_date ? new Date(item.tran_date).toLocaleDateString('en-GB') : ''}</td>
                            <td style="color: #0000EE;text-decoration: underline;cursor:pointer;" onclick="showdetails('${item.tran_id}', '${item.part_tran_id}','${item.acct_num}')"> ${item.tran_id} / ${item.part_tran_id}</td>
                            <td>${item.part_tran_type || ''}</td>
                            <td>${item.acct_crncy || ''}</td>
                            <td style="text-align: right;">${item.tran_amt ? formatDecimal(item.tran_amt, 2) : '0.00'}</td>
                            <td style="text-align: right;">${item.acct_num || ''}</td>
                            <td style="text-align: left;">${item.acct_name || ''}</td>
                            <td style="text-align: left;">${item.tran_particular || ''}</td>
                            <td style="text-align: right;">${item.tran_status || ''}</td>
                            
                        </tr>
                    `;
                    $('#list2 tbody').append(row);
                    $('#loadingMessage2').hide();
                });
            } 
       
        },
        error: function (error) {
            console.error("Error fetching transaction records:", error);
        }
    });

   
}
 */
 
 function funcall2() { 
	    var fromdate = $('#fromdate2').val();
	    var todate = $('#todate2').val();
	    var acct_num = $('#acct_num2').val();
	    
	    console.log("acct_num2: " + acct_num);
	    console.log("fromdate: " + fromdate);
	    console.log("todate: " + todate);

	    // Define the account number groups
	    var group1 = ["2100002160", "2100002164", "2100002165", "2100002166", "2100002167"];
	    var group2 = ["2100002180", "6200006215", "6200006216"];
	    var group3 = ["2100002185", "6200006217"];
	    var group4 = ["4400004415", "2700002710","1100001199","1100001196"];

	    // Determine which values to pass
	    let acct_nums_to_send;
	    if (group1.includes(acct_num)) {
	        acct_nums_to_send = group1;
	    } else if (group2.includes(acct_num)) {
	        acct_nums_to_send = group2;
	    } else if (group3.includes(acct_num)) {
	        acct_nums_to_send = group3;
	    }else if (group4.includes(acct_num)) {
	        acct_nums_to_send = group4;
	    } else {
	        acct_nums_to_send = [acct_num]; // Pass only the current account number
	    }

	    console.log("Account numbers to send: " + acct_nums_to_send);

	    let tableBody = $('#list2 tbody');
	    tableBody.empty(); 
	    $('#loadingMessage2').show(); 

	    $.ajax({
	        url: './getTransactionRecords2',
	        type: 'GET',
	        data: {
	            acct_num: acct_nums_to_send.join(','), // Send as a comma-separated string
	            fromdate: fromdate,
	            todate: todate
	        },
	        success: function (data) {
	            if (data && data.length > 0) {
	                data.forEach(function (item) {
	                    let row = `
	                        <tr>
	                            <td>${item.tran_date ? new Date(item.tran_date).toLocaleDateString('en-GB') : ''}</td>
	                            <td style="color: #0000EE;text-decoration: underline;cursor:pointer;" onclick="showdetails('${item.tran_id}', '${item.part_tran_id}','${item.acct_num}')">${item.tran_id} / ${item.part_tran_id}</td>
	                            <td>${item.part_tran_type || ''}</td>
	                            <td>${item.acct_crncy || ''}</td>
	                            <td style="text-align: right;">${item.tran_amt ? formatDecimal(item.tran_amt, 2) : '0.00'}</td>
	                            <td style="text-align: right;">${item.acct_num || ''}</td>
	                            <td style="text-align: left;">${item.acct_name || ''}</td>
	                            <td style="text-align: left;">${item.tran_particular || ''}</td>
	                            <td style="text-align: right;">${item.tran_status || ''}</td>
	                        </tr>
	                    `;
	                    $('#list2 tbody').append(row);
	                });
	                $('#loadingMessage2').hide();
	            }
	        },
	        error: function (error) {
	            console.error("Error fetching transaction records:", error);
	        }
	    });
	}

function funcall3() { 
    
    var fromdate = $('#fromdate3').val();
    var todate = $('#todate3').val();
    var acct_num = $('#acct_num3').val();
    
    console.log("acct_num2"+acct_num);
    console.log("fromdate"+fromdate);
    console.log("todate"+todate);

    let tableBody = $('#list3 tbody');
    tableBody.empty();// Clear previous rows
    $('#loadingMessage3').show(); 
    $.ajax({
        url: './getTransactionRecords3',
        type: 'GET',
        data: {
        	acct_num: acct_num,
            fromdate: fromdate,
            todate: todate
        },
        success: function (data) {
        	console.log("datassssssssss2678+"+data);
        	 if (data && data.length > 0) {
        		 data.forEach(function (item) {
                    let row = `
                        <tr>
                            <td>${item.tran_date ? new Date(item.tran_date).toLocaleDateString('en-GB') : ''}</td>
                            <td style="color: #0000EE;text-decoration: underline;cursor:pointer;" onclick="showdetails('${item.tran_id}', '${item.part_tran_id}','${item.acct_num}')"> ${item.tran_id} / ${item.part_tran_id}</td>
                            <td>${item.part_tran_type || ''}</td>
                            <td>${item.acct_crncy || ''}</td>
                            <td style="text-align: right;">${item.tran_amt ? formatDecimal(item.tran_amt, 2) : '0.00'}</td>
                            <td style="text-align: right;">${item.acct_num || ''}</td>
                            <td style="text-align: left;">${item.acct_name || ''}</td>
                            <td style="text-align: left;">${item.tran_particular || ''}</td>
                            <td style="text-align: right;">${item.tran_status || ''}</td>
                            
                        </tr>
                    `;
                    
                    $('#list3 tbody').append(row);
                    $('#loadingMessage3').hide();
                    
                });
            } 
       
        },
        error: function (error) {
            console.error("Error fetching transaction records:", error);
        }
    });

   
}


//Utility function to format dates
function formatDate(dateString) {
    let date = new Date(dateString);
    return `${('0' + date.getDate()).slice(-2)}-${('0' + (date.getMonth() + 1)).slice(-2)}-${date.getFullYear()}`;
}

function views() {
	var lkg = document.getElementById("usertablevalues");
	lkg.classList.remove('d-none'); // Remove the 'd-none' class to show the table 
}


function getModelValue() {
    const acctNum2 = document.getElementById("acct_num2").value;
    var fromdate = $('#fromdate2').val();
    var todate = $('#todate2').val();
  	$.ajax({
        url: './modeldata', 
        data: {
        	acctNum2: acctNum2,
            fromdate: fromdate,
            todate: todate
        },
        type: 'GET',
        success: function(data) {
            console.log("Data submitted successfully: ", data);
            
            // Assuming the structure you provided:
            var dataArray = data[0]; // Get the first item of the array (which is another array)
           	 console.log("dataArray"+dataArray);
            // Extract values for Debit, Credit, and Total
            var acctnum=dataArray[0]
            var debit = dataArray[1];  // Debit value (28403777.58)
            var credit = dataArray[2]; // Credit value (35036672.58)
            var total = dataArray[3];
           
            
            $('#modal-acctnum').text(acctnum);
            $('#modal-debit').text(debit.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
            $('#modal-credit').text(credit.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
            $('#modal-total').text(total.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));

            	
            // Open the modal
            $('#myModal').css("display", "block"); // Show the modal
        },
        error: function(error) {
            console.error("Error submitting form", error);
        }
    });
}

// Close button functionality
document.getElementById("closebtn").addEventListener("click", function() {
    document.getElementById("myModal").style.display = "none"; // Hide the modal
});

// Optional: Close modal when clicking outside the content
window.addEventListener("click", function(event) {
    const modal = document.getElementById("myModal");
    if (event.target === modal) {
        modal.style.display = "none";
    }
});

/* ---------- */
let one_val = ''; // Variable to store the clicked number
let all_val = ''; // Variable to store all account numbers

function showAccountList() {
    const acctList = document.getElementById('acctList');
    if (acctList.style.display === 'none' || acctList.style.display === '') {
        acctList.style.display = 'block'; // Show the list
    } else {
        acctList.style.display = 'none'; // Hide the list
    }
}

function getAllNumbers() {
    const numbers = [];
    const listItems = document.querySelectorAll('#acctList li'); // Get all <li> elements
    listItems.forEach((item) => {
        numbers.push(item.textContent.trim()); // Collect the numbers
    });
    return numbers; // Return the array of numbers
}

function moreaccutnum(initialTabId, clickedNumber, allNumbers) {
    // Store the clicked number (one_val) and all account numbers (all_val)
    one_val = clickedNumber; // Store the clicked number
    all_val = allNumbers.join(','); // Join all the numbers with commas and store in all_val

    $('#loader-overlay').show();

    // Create an array to hold all AJAX promises
    const ajaxPromises = [];

    // First AJAX call to fetch account details
    const acctDetailsPromise = $.ajax({
        url: './gettranvalue',
        type: 'GET',
        data: { acctnum: one_val },
        success: function (data) {
            console.log(data);
            if (data.acct_num && data.acct_name) {
                $('#acct_num1, #acct_num2, #acct_num3').val(data.acct_num);
                $('#acct_name1, #acct_name2, #acct_name3').val(data.acct_name);
            } else {
                $('#acct_num, #acct_name').val('');
            }
        },
        error: function (error) {
            console.error('Error fetching account details:', error);
        }
    });
    ajaxPromises.push(acctDetailsPromise);

    // Second AJAX call to fetch transaction balance and nested ledger data
    const transactionBalancePromise = $.ajax({
        url: './getTranbal2',
        type: 'GET',
        data: { acctnum: one_val },
        success: function (balanceData) {
            console.log("Balance Data:", balanceData);
            let tableBody = $('#usertable tbody');
            tableBody.empty();
            let balanceData1 = (typeof balanceData !== 'string') ? String(balanceData) : balanceData;
            console.log('Updated balanceData1:', balanceData1);

            if (balanceData1.includes(',')) {
                let [dateString, balance] = balanceData1.split(',');
                let date = new Date(dateString);
                let formattedDate = `${('0' + date.getDate()).slice(-2)}-${('0' + (date.getMonth() + 1)).slice(-2)}-${date.getFullYear()}`;
                let formattedBalance = parseFloat(balance);

                console.log(`Formatted Date: ${formattedDate}`);
                console.log(`Formatted Balance: ${formattedBalance.toFixed(2)}`);

                let headerHTML = ` 
                    <tr>
                        <td colspan="1"><strong>B/F:</strong> ${formattedDate}</td>
                        <td colspan="2"></td>
                        <td colspan="3"></td>
                        <td colspan="1" style="text-align:right">${formattedBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    </tr>`;
                tableBody.append(headerHTML);

                $.ajax({
                    url: './getledgerdata',
                    type: 'GET',
                    data: { acctnum: one_val },
                    success: function (data) {
                        console.log("Ledger Data:", data);
                        let firstTranDate = data[0].tran_date ? formatDate(data[0].tran_date) : '';
                        $('#fromdate').val(firstTranDate);

                        let currentBalance = formattedBalance;

                        data.forEach(function (entry) {
                            let formattedDate = entry.tran_date ? formatDate(entry.tran_date) : '';

                            let debitAmount = (entry.part_tran_type === 'debit') ? parseFloat(entry.tran_amt) : 0.00;
                            let creditAmount = (entry.part_tran_type === 'credit') ? parseFloat(entry.tran_amt) : 0.00;

                            currentBalance += (entry.part_tran_type === 'debit') ? -debitAmount : creditAmount;

                            let formattedDebit = debitAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                            let formattedCredit = creditAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                            let formattedUpdatedBalance = currentBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

                            let indicator = currentBalance < 0 ? 'DR' : 'CR';

                            tableBody.append(`
                                <tr>
                                    <td>${formattedDate}</td>
                                    <td style="color: #0000EE; text-decoration: underline; cursor: pointer;" 
                                        onclick="showdetails('${entry.tran_id}', '${entry.part_tran_id}', '${entry.acct_num}')">
                                        ${entry.tran_id} / ${entry.part_tran_id}
                                    </td>
                                    <td>${entry.tran_particular}</td>
                                    <td>${entry.acct_crncy}</td>
                                    <td style="text-align:right">${formattedDebit}</td>
                                    <td style="text-align:right">${formattedCredit}</td>
                                    <td style="text-align:right">${formattedUpdatedBalance}</td>
                                    <td style="text-align:right">${indicator}</td>
                                </tr>
                            `);
                        });
                    },
                    error: function (error) {
                        console.error("Error fetching ledger data:", error);
                    }
                });
            }
        },
        error: function (error) {
            console.error("Error fetching transaction balance:", error);
        }
    });
    ajaxPromises.push(transactionBalancePromise);
    
    const list2DataPromise = $.ajax({
        url: './getfiveValues',
        type: 'GET',
        success: function (list2Data) {
            console.log("List2 data:", list2Data);
            $('#list2 tbody').empty();

            if (list2Data && list2Data.length > 0) {
                let firstTranDate = list2Data[0].tran_date ? formatDate(list2Data[0].tran_date) : '';
                $('#fromdate2').val(firstTranDate);

                list2Data.forEach(function (item) {
                    let row = `
                        <tr>
                            <td>${item.tran_date ? new Date(item.tran_date).toLocaleDateString('en-GB') : ''}</td>
                            <td style="color: #0000EE;text-decoration: underline;cursor:pointer" onclick="showdetails('${item.tran_id}', '${item.part_tran_id}','${item.acct_num}')"> ${item.tran_id} / ${item.part_tran_id}</td>
                            <td>${item.part_tran_type || ''}</td>
                            <td>${item.acct_crncy || ''}</td>
                            <td style="text-align: right;">${item.tran_amt ? formatDecimal(item.tran_amt, 2) : '0.00'}</td>
                            <td style="text-align: right;">${item.acct_num || ''}</td>
                            <td style="text-align: left;">${item.acct_name || ''}</td>
                            <td style="text-align: left;">${item.tran_particular || ''}</td>
                            <td style="text-align: left;">${item.tran_status || ''}</td>
                        </tr>
                    `;
                    $('#list2 tbody').append(row);
                });
            } else {
                console.log("No account details found.");
            }
        },
        error: function (error) {
            console.error('Error fetching list2 data:', error);
        }
    });
    ajaxPromises.push(list2DataPromise);
    
    $.ajax({
        url: './setlist3',
        type: 'GET',
        data: { acctnum: one_val },
        success: function (additionalData) {
            console.log("Additional data:", additionalData);
            const tableBody = $('#list3 tbody');
            tableBody.empty(); // Clear previous rows

            if (additionalData && additionalData.length > 0) {
                // Set the first transaction date
                const firstTranDate = additionalData[0].tran_date ? formatDate(additionalData[0].tran_date) : '';
                $('#fromdate3').val(firstTranDate);

                // Append rows to the table body
                additionalData.forEach(function (item) {
                    const row = `
                        <tr>
                            <td>${item.tran_date ? new Date(item.tran_date).toLocaleDateString('en-GB') : ''}</td>
                            <td style="color: #0000EE; text-decoration: underline; cursor: pointer;" 
                                onclick="showdetails('${item.tran_id}', '${item.part_tran_id}', '${item.acct_num}')">
                                ${item.tran_id} / ${item.part_tran_id}
                            </td>
                            <td>${item.part_tran_type || ''}</td>
                            <td>${item.acct_crncy || ''}</td>
                            <td style="text-align: right;">${item.tran_amt ? formatDecimal(item.tran_amt, 2) : '0.00'}</td>
                            <td style="text-align: right;">${item.acct_num || ''}</td>
                            <td style="text-align: left;">${item.acct_name || ''}</td>
                            <td style="text-align: left;">${item.tran_particular || ''}</td>
                            <td style="text-align: left;">${item.tran_status || ''}</td>
                        </tr>
                    `;
                    tableBody.append(row);
                });

                console.log("Rows appended successfully to #list3 table.");
            } else {
                console.log("No account details found for setlist3.");
            }

            // Ensure the table is displayed
            $('#list3').show();
        },
        error: function (error) {
            console.error('Error fetching additional data:', error);
        }
    });

    $('#list3').css('display', 'table');

  Promise.all(ajaxPromises).then(() => {
        console.log("All AJAX calls completed.");
        $('#loader-overlay').hide(); 
    }).catch((error) => {
        console.error("Error in one of the AJAX calls:", error);
        $('#loader-overlay').hide(); 
    });

    document.getElementById('CommonTable').style.display = 'none';
    document.getElementById('TabButtons').style.display = 'block';
    showTab('tab1');

    if (initialTabId !== 'tab1') {
        setTimeout(() => showTab(initialTabId), 0);
    }
}



function getAllNumbers2() {
    const numbers = [];
    const listItems = document.querySelectorAll('#acctList3 li'); // Get all <li> elements in #acctList3
    listItems.forEach((item) => {
        numbers.push(item.textContent.trim()); // Collect the numbers
    });
    return numbers; // Return the array of numbers
}

function moreaccutnum2(initialTabId, clickedNumber, allNumbers) {
	  one_val = clickedNumber; 
	    all_val = allNumbers.join(','); 
		
	    
	    $('#loader-overlay').show();

	    // Create an array to hold all AJAX promises
	    const ajaxPromises = [];

	    // First AJAX call to fetch account details
	    const acctDetailsPromise = $.ajax({
	        url: './gettranvalue',
	        type: 'GET',
	        data: { acctnum: one_val },
	        success: function (data) {
	            console.log(data);
	            if (data.acct_num && data.acct_name) {
	                $('#acct_num1, #acct_num2, #acct_num3').val(data.acct_num);
	                $('#acct_name1, #acct_name2, #acct_name3').val(data.acct_name);
	            } else {
	                $('#acct_num, #acct_name').val('');
	            }
	        },
	        error: function (error) {
	            console.error('Error fetching account details:', error);
	        }
	    });
	    ajaxPromises.push(acctDetailsPromise);

	    // Second AJAX call to fetch transaction balance and nested ledger data
	    const transactionBalancePromise = $.ajax({
	        url: './getTranbal2',
	        type: 'GET',
	        data: { acctnum: one_val },
	        success: function (balanceData) {
	            console.log("Balance Data:", balanceData);
	            let tableBody = $('#usertable tbody');
	            tableBody.empty();
	            let balanceData1 = (typeof balanceData !== 'string') ? String(balanceData) : balanceData;
	            console.log('Updated balanceData1:', balanceData1);

	            if (balanceData1.includes(',')) {
	                let [dateString, balance] = balanceData1.split(',');
	                let date = new Date(dateString);
	                let formattedDate = `${('0' + date.getDate()).slice(-2)}-${('0' + (date.getMonth() + 1)).slice(-2)}-${date.getFullYear()}`;
	                let formattedBalance = parseFloat(balance);

	                console.log(`Formatted Date: ${formattedDate}`);
	                console.log(`Formatted Balance: ${formattedBalance.toFixed(2)}`);

	                let headerHTML = ` 
	                    <tr>
	                        <td colspan="1"><strong>B/F:</strong> ${formattedDate}</td>
	                        <td colspan="2"></td>
	                        <td colspan="3"></td>
	                        <td colspan="1" style="text-align:right">${formattedBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
	                    </tr>`;
	                tableBody.append(headerHTML);

	                $.ajax({
	                    url: './getledgerdata',
	                    type: 'GET',
	                    data: { acctnum: one_val },
	                    success: function (data) {
	                        console.log("Ledger Data:", data);
	                        let firstTranDate = data[0].tran_date ? formatDate(data[0].tran_date) : '';
	                        $('#fromdate').val(firstTranDate);

	                        let currentBalance = formattedBalance;

	                        data.forEach(function (entry) {
	                            let formattedDate = entry.tran_date ? formatDate(entry.tran_date) : '';

	                            let debitAmount = (entry.part_tran_type === 'debit') ? parseFloat(entry.tran_amt) : 0.00;
	                            let creditAmount = (entry.part_tran_type === 'credit') ? parseFloat(entry.tran_amt) : 0.00;

	                            currentBalance += (entry.part_tran_type === 'debit') ? -debitAmount : creditAmount;

	                            let formattedDebit = debitAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
	                            let formattedCredit = creditAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
	                            let formattedUpdatedBalance = currentBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

	                            let indicator = currentBalance < 0 ? 'DR' : 'CR';

	                            tableBody.append(`
	                                <tr>
	                                    <td>${formattedDate}</td>
	                                    <td style="color: #0000EE; text-decoration: underline; cursor: pointer;" 
	                                        onclick="showdetails('${entry.tran_id}', '${entry.part_tran_id}', '${entry.acct_num}')">
	                                        ${entry.tran_id} / ${entry.part_tran_id}
	                                    </td>
	                                    <td>${entry.tran_particular}</td>
	                                    <td>${entry.acct_crncy}</td>
	                                    <td style="color: #0000EE; text-decoration: underline; cursor: pointer;text-align:right"
	                                    	onclick="showdetails4('${entry.tran_date}')">${formattedDebit}</td>
	                                    <td style="color: #0000EE; text-decoration: underline; cursor: pointer;text-align:right"
	                                    onclick="showdetails2('${entry.tran_date}')">${formattedCredit}</td>
	                                    <td style="text-align:right">${formattedUpdatedBalance}</td>
	                                    <td style="text-align:right">${indicator}</td>
	                                </tr>
	                            `);
	                        });
	                    },
	                    error: function (error) {
	                        console.error("Error fetching ledger data:", error);
	                    }
	                });
	            }
	        },
	        error: function (error) {
	            console.error("Error fetching transaction balance:", error);
	        }
	    });
	    ajaxPromises.push(transactionBalancePromise);
	    
	    $.ajax({
	        url: './setlist3',
	        type: 'GET',
	        data: { acctnum: one_val },
	        success: function (additionalData) {
	            console.log("Additional data:", additionalData);
	            const tableBody = $('#list3 tbody');
	            tableBody.empty(); // Clear previous rows

	            if (additionalData && additionalData.length > 0) {
	                // Set the first transaction date
	                const firstTranDate = additionalData[0].tran_date ? formatDate(additionalData[0].tran_date) : '';
	                $('#fromdate3').val(firstTranDate);

	                // Append rows to the table body
	                additionalData.forEach(function (item) {
	                    const row = `
	                        <tr>
	                            <td>${item.tran_date ? new Date(item.tran_date).toLocaleDateString('en-GB') : ''}</td>
	                            <td style="color: #0000EE; text-decoration: underline; cursor: pointer;" 
	                                onclick="showdetails('${item.tran_id}', '${item.part_tran_id}', '${item.acct_num}')">
	                                ${item.tran_id} / ${item.part_tran_id}
	                            </td>
	                            <td>${item.part_tran_type || ''}</td>
	                            <td>${item.acct_crncy || ''}</td>
	                            <td style="text-align: right;">${item.tran_amt ? formatDecimal(item.tran_amt, 2) : '0.00'}</td>
	                            <td style="text-align: right;">${item.acct_num || ''}</td>
	                            <td style="text-align: left;">${item.acct_name || ''}</td>
	                            <td style="text-align: left;">${item.tran_particular || ''}</td>
	                            <td style="text-align: left;">${item.tran_status || ''}</td>
	                        </tr>
	                    `;
	                    tableBody.append(row);
	                });

	                console.log("Rows appended successfully to #list3 table.");
	            } else {
	                console.log("No account details found for setlist3.");
	            }

	            // Ensure the table is displayed
	            $('#list3').show();
	        },
	        error: function (error) {
	            console.error('Error fetching additional data:', error);
	        }
	    });

	    const list2DataPromise = $.ajax({
	        url: './getThreeValues',
	        type: 'GET',
	        success: function (list2Data) {
	            console.log("List2 data:", list2Data);
	            $('#list2 tbody').empty();

	            if (list2Data && list2Data.length > 0) {
	                let firstTranDate = list2Data[0].tran_date ? formatDate(list2Data[0].tran_date) : '';
	                $('#fromdate2').val(firstTranDate);

	                list2Data.forEach(function (item) {
	                    let row = `
	                        <tr>
	                            <td>${item.tran_date ? new Date(item.tran_date).toLocaleDateString('en-GB') : ''}</td>
	                            <td style="color: #0000EE;text-decoration: underline;cursor:pointer" onclick="showdetails('${item.tran_id}', '${item.part_tran_id}','${item.acct_num}')"> ${item.tran_id} / ${item.part_tran_id}</td>
	                            <td>${item.part_tran_type || ''}</td>
	                            <td>${item.acct_crncy || ''}</td>
	                            <td style="text-align: right;">${item.tran_amt ? formatDecimal(item.tran_amt, 2) : '0.00'}</td>
	                            <td style="text-align: right;">${item.acct_num || ''}</td>
	                            <td style="text-align: left;">${item.acct_name || ''}</td>
	                            <td style="text-align: left;">${item.tran_particular || ''}</td>
	                            <td style="text-align: left;">${item.tran_status || ''}</td>
	                        </tr>
	                    `;
	                    $('#list2 tbody').append(row);
	                });
	            } else {
	                console.log("No account details found.");
	            }
	        },
	        error: function (error) {
	            console.error('Error fetching list2 data:', error);
	        }
	    });
	    ajaxPromises.push(list2DataPromise);

	  Promise.all(ajaxPromises).then(() => {
	        console.log("All AJAX calls completed.");
	        $('#loader-overlay').hide(); 
	    }).catch((error) => {
	        console.error("Error in one of the AJAX calls:", error);
	        $('#loader-overlay').hide(); 
	    });

	    document.getElementById('CommonTable').style.display = 'none';
	    document.getElementById('TabButtons').style.display = 'block';
	    showTab('tab1');

	    if (initialTabId !== 'tab1') {
	        setTimeout(() => showTab(initialTabId), 0);
	    }   
	    
}
function getAllNumbers3() {
    const numbers = [];
    const listItems = document.querySelectorAll('#acctList4 li'); // Get all <li> elements in #acctList3
    listItems.forEach((item) => {
        numbers.push(item.textContent.trim()); // Collect the numbers
    });
    return numbers; // Return the array of numbers
}
function moreaccutnum3(initialTabId, clickedNumber, allNumbers) {
	  one_val = clickedNumber; 
	    all_val = allNumbers.join(','); 
		
	    $('#loader-overlay').show();

	    
	    const ajaxPromises = [];
	 	   // First AJAX call to fetch account details
	    const acctDetailsPromise = $.ajax({
	        url: './gettranvalue',
	        type: 'GET',
	        data: { acctnum: one_val },
	        success: function (data) {
	            console.log(data);
	            if (data.acct_num && data.acct_name) {
	                $('#acct_num1, #acct_num2, #acct_num3').val(data.acct_num);
	                $('#acct_name1, #acct_name2, #acct_name3').val(data.acct_name);
	            } else {
	                $('#acct_num, #acct_name').val('');
	            }
	        },
	        error: function (error) {
	            console.error('Error fetching account details:', error);
	        }
	    });
	    ajaxPromises.push(acctDetailsPromise);

	    const transactionBalancePromise = $.ajax({
	        url: './getTranbal2',
	        type: 'GET',
	        data: { acctnum: one_val },
	        success: function (balanceData) {
	            console.log("Balance Data:", balanceData);
	            let tableBody = $('#usertable tbody');
	            tableBody.empty();
	            let balanceData1 = (typeof balanceData !== 'string') ? String(balanceData) : balanceData;
	            console.log('Updated balanceData1:', balanceData1);

	            if (balanceData1.includes(',')) {
	                let [dateString, balance] = balanceData1.split(',');
	                let date = new Date(dateString);
	                let formattedDate = `${('0' + date.getDate()).slice(-2)}-${('0' + (date.getMonth() + 1)).slice(-2)}-${date.getFullYear()}`;
	                let formattedBalance = parseFloat(balance);

	                console.log(`Formatted Date: ${formattedDate}`);
	                console.log(`Formatted Balance: ${formattedBalance.toFixed(2)}`);

	                let headerHTML = ` 
	                    <tr>
	                        <td colspan="1"><strong>B/F:</strong> ${formattedDate}</td>
	                        <td colspan="2"></td>
	                        <td colspan="3"></td>
	                        <td colspan="1" style="text-align:right">${formattedBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
	                    </tr>`;
	                tableBody.append(headerHTML);

	                $.ajax({
	                    url: './getledgerdata',
	                    type: 'GET',
	                    data: { acctnum: one_val },
	                    success: function (data) {
	                        console.log("Ledger Data:", data);
	                        let firstTranDate = data[0].tran_date ? formatDate(data[0].tran_date) : '';
	                        $('#fromdate').val(firstTranDate);

	                        let currentBalance = formattedBalance;

	                        data.forEach(function (entry) {
	                            let formattedDate = entry.tran_date ? formatDate(entry.tran_date) : '';

	                            let debitAmount = (entry.part_tran_type === 'debit') ? parseFloat(entry.tran_amt) : 0.00;
	                            let creditAmount = (entry.part_tran_type === 'credit') ? parseFloat(entry.tran_amt) : 0.00;

	                            currentBalance += (entry.part_tran_type === 'debit') ? -debitAmount : creditAmount;

	                            let formattedDebit = debitAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
	                            let formattedCredit = creditAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
	                            let formattedUpdatedBalance = currentBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

	                            let indicator = currentBalance < 0 ? 'DR' : 'CR';

	                            tableBody.append(`
	                                <tr>
	                                    <td>${formattedDate}</td>
	                                    <td style="color: #0000EE; text-decoration: underline; cursor: pointer;" 
	                                        onclick="showdetails('${entry.tran_id}', '${entry.part_tran_id}', '${entry.acct_num}')">
	                                        ${entry.tran_id} / ${entry.part_tran_id}
	                                    </td>
	                                    <td>${entry.tran_particular}</td>
	                                    <td>${entry.acct_crncy}</td>
	                                    <td style="color: #0000EE; text-decoration: underline; cursor: pointer;text-align:right"
	                                    	onclick="showdetails5('${entry.tran_date}')">${formattedDebit}</td>
	                                    <td style="color: #0000EE; text-decoration: underline; cursor: pointer;text-align:right"
	                                    	onclick="showdetails3('${entry.tran_date}')">${formattedCredit}</td>
	                                    <td style="text-align:right">${formattedUpdatedBalance}</td>
	                                    <td style="text-align:right">${indicator}</td>
	                                </tr>
	                            `);
	                        });
	                    },
	                    error: function (error) {
	                        console.error("Error fetching ledger data:", error);
	                    }
	                });
	            }
	        },
	        error: function (error) {
	            console.error("Error fetching transaction balance:", error);
	        }
	    });
	    ajaxPromises.push(transactionBalancePromise);
	    
	    $.ajax({
	        url: './setlist3',
	        type: 'GET',
	        data: { acctnum: one_val },
	        success: function (additionalData) {
	            console.log("Additional data:", additionalData);
	            const tableBody = $('#list3 tbody');
	            tableBody.empty(); // Clear previous rows

	            if (additionalData && additionalData.length > 0) {
	                // Set the first transaction date
	                const firstTranDate = additionalData[0].tran_date ? formatDate(additionalData[0].tran_date) : '';
	                $('#fromdate3').val(firstTranDate);

	                // Append rows to the table body
	                additionalData.forEach(function (item) {
	                    const row = `
	                        <tr>
	                            <td>${item.tran_date ? new Date(item.tran_date).toLocaleDateString('en-GB') : ''}</td>
	                            <td style="color: #0000EE; text-decoration: underline; cursor: pointer;" 
	                                onclick="showdetails('${item.tran_id}', '${item.part_tran_id}', '${item.acct_num}')">
	                                ${item.tran_id} / ${item.part_tran_id}
	                            </td>
	                            <td>${item.part_tran_type || ''}</td>
	                            <td>${item.acct_crncy || ''}</td>
	                            <td style="text-align: right;">${item.tran_amt ? formatDecimal(item.tran_amt, 2) : '0.00'}</td>
	                            <td style="text-align: right;">${item.acct_num || ''}</td>
	                            <td style="text-align: left;">${item.acct_name || ''}</td>
	                            <td style="text-align: left;">${item.tran_particular || ''}</td>
	                            <td style="text-align: left;">${item.tran_status || ''}</td>
	                        </tr>
	                    `;
	                    tableBody.append(row);
	                });

	                console.log("Rows appended successfully to #list3 table.");
	            } else {
	                console.log("No account details found for setlist3.");
	            }

	            // Ensure the table is displayed
	            $('#list3').show();
	        },
	        error: function (error) {
	            console.error('Error fetching additional data:', error);
	        }
	    });

	    const list2DataPromise = $.ajax({
	        url: './getTwoValues',
	        type: 'GET',
	        success: function (list2Data) {
	            console.log("List2 data:", list2Data);
	            $('#list2 tbody').empty();

	            if (list2Data && list2Data.length > 0) {
	                let firstTranDate = list2Data[0].tran_date ? formatDate(list2Data[0].tran_date) : '';
	                $('#fromdate2').val(firstTranDate);

	                list2Data.forEach(function (item) {
	                    let row = `
	                        <tr>
	                            <td>${item.tran_date ? new Date(item.tran_date).toLocaleDateString('en-GB') : ''}</td>
	                            <td style="color: #0000EE;text-decoration: underline;cursor:pointer" onclick="showdetails('${item.tran_id}', '${item.part_tran_id}','${item.acct_num}')"> ${item.tran_id} / ${item.part_tran_id}</td>
	                            <td>${item.part_tran_type || ''}</td>
	                            <td>${item.acct_crncy || ''}</td>
	                            <td style="text-align: right;">${item.tran_amt ? formatDecimal(item.tran_amt, 2) : '0.00'}</td>
	                            <td style="text-align: right;">${item.acct_num || ''}</td>
	                            <td style="text-align: left;">${item.acct_name || ''}</td>
	                            <td style="text-align: left;">${item.tran_particular || ''}</td>
	                            <td style="text-align: left;">${item.tran_status || ''}</td>
	                        </tr>
	                    `;
	                    $('#list2 tbody').append(row);
	                });
	            } else {
	                console.log("No account details found.");
	            }
	        },
	        error: function (error) {
	            console.error('Error fetching list2 data:', error);
	        }
	    });
	    ajaxPromises.push(list2DataPromise);

	  Promise.all(ajaxPromises).then(() => {
	        console.log("All AJAX calls completed.");
	        $('#loader-overlay').hide(); 
	    }).catch((error) => {
	        console.error("Error in one of the AJAX calls:", error);
	        $('#loader-overlay').hide(); 
	    });

	    document.getElementById('CommonTable').style.display = 'none';
	    document.getElementById('TabButtons').style.display = 'block';
	    showTab('tab1');

	    if (initialTabId !== 'tab1') {
	        setTimeout(() => showTab(initialTabId), 0);
	    }   

	    
}


function getAllNumbers4() {
    const numbers = [];
    const listItems = document.querySelectorAll('#acctList5 li'); // Get all <li> elements in #acctList3
    listItems.forEach((item) => {
        numbers.push(item.textContent.trim()); // Collect the numbers
    });
    return numbers; // Return the array of numbers
}

function moreaccutnum4(initialTabId, clickedNumber, allNumbers) {
	  one_val = clickedNumber; 
	    all_val = allNumbers.join(','); 
	   
	   
	   $('#loader-overlay').show();

	    // Create an array to hold all AJAX promises
	    const ajaxPromises = [];

	    // First AJAX call to fetch account details
	    const acctDetailsPromise = $.ajax({
	        url: './gettranvalue',
	        type: 'GET',
	        data: { acctnum: one_val },
	        success: function (data) {
	            console.log(data);
	            if (data.acct_num && data.acct_name) {
	                $('#acct_num1, #acct_num2, #acct_num3').val(data.acct_num);
	                $('#acct_name1, #acct_name2, #acct_name3').val(data.acct_name);
	            } else {
	                $('#acct_num, #acct_name').val('');
	            }
	        },
	        error: function (error) {
	            console.error('Error fetching account details:', error);
	        }
	    });
	    ajaxPromises.push(acctDetailsPromise);

	    // Second AJAX call to fetch transaction balance and nested ledger data
	    const transactionBalancePromise = $.ajax({
	        url: './getTranbal2',
	        type: 'GET',
	        data: { acctnum: one_val },
	        success: function (balanceData) {
	            console.log("Balance Data:", balanceData);
	            let tableBody = $('#usertable tbody');
	            tableBody.empty();
	            let balanceData1 = (typeof balanceData !== 'string') ? String(balanceData) : balanceData;
	            console.log('Updated balanceData1:', balanceData1);

	            if (balanceData1.includes(',')) {
	                let [dateString, balance] = balanceData1.split(',');
	                let date = new Date(dateString);
	                let formattedDate = `${('0' + date.getDate()).slice(-2)}-${('0' + (date.getMonth() + 1)).slice(-2)}-${date.getFullYear()}`;
	                let formattedBalance = parseFloat(balance);

	                console.log(`Formatted Date: ${formattedDate}`);
	                console.log(`Formatted Balance: ${formattedBalance.toFixed(2)}`);

	                let headerHTML = ` 
	                    <tr>
	                        <td colspan="1"><strong>B/F:</strong> ${formattedDate}</td>
	                        <td colspan="2"></td>
	                        <td colspan="3"></td>
	                        <td colspan="1" style="text-align:right">${formattedBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
	                    </tr>`;
	                tableBody.append(headerHTML);

	                $.ajax({
	                    url: './getledgerdata',
	                    type: 'GET',
	                    data: { acctnum: one_val },
	                    success: function (data) {
	                        console.log("Ledger Data:", data);
	                        let firstTranDate = data[0].tran_date ? formatDate(data[0].tran_date) : '';
	                        $('#fromdate').val(firstTranDate);

	                        let currentBalance = formattedBalance;

	                        data.forEach(function (entry) {
	                            let formattedDate = entry.tran_date ? formatDate(entry.tran_date) : '';

	                            let debitAmount = (entry.part_tran_type === 'debit') ? parseFloat(entry.tran_amt) : 0.00;
	                            let creditAmount = (entry.part_tran_type === 'credit') ? parseFloat(entry.tran_amt) : 0.00;

	                            currentBalance += (entry.part_tran_type === 'debit') ? -debitAmount : creditAmount;

	                            let formattedDebit = debitAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
	                            let formattedCredit = creditAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
	                            let formattedUpdatedBalance = currentBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

	                            let indicator = currentBalance < 0 ? 'DR' : 'CR';

	                            tableBody.append(`
	                                <tr>
	                                    <td>${formattedDate}</td>
	                                    <td style="color: #0000EE; text-decoration: underline; cursor: pointer;" 
	                                        onclick="showdetails('${entry.tran_id}', '${entry.part_tran_id}', '${entry.acct_num}')">
	                                        ${entry.tran_id} / ${entry.part_tran_id}
	                                    </td>
	                                    <td>${entry.tran_particular}</td>
	                                    <td>${entry.acct_crncy}</td>
	                                    <td style="text-align:right">${formattedDebit}</td>
	                                    <td style="text-align:right">${formattedCredit}</td>
	                                    <td style="text-align:right">${formattedUpdatedBalance}</td>
	                                    <td style="text-align:right">${indicator}</td>
	                                </tr>
	                            `);
	                        });
	                    },
	                    error: function (error) {
	                        console.error("Error fetching ledger data:", error);
	                    }
	                });
	            }
	        },
	        error: function (error) {
	            console.error("Error fetching transaction balance:", error);
	        }
	    });
	    ajaxPromises.push(transactionBalancePromise);
	    
	    $.ajax({
	        url: './setlist3',
	        type: 'GET',
	        data: { acctnum: one_val },
	        success: function (additionalData) {
	            console.log("Additional data:", additionalData);
	            const tableBody = $('#list3 tbody');
	            tableBody.empty(); // Clear previous rows

	            if (additionalData && additionalData.length > 0) {
	                // Set the first transaction date
	                const firstTranDate = additionalData[0].tran_date ? formatDate(additionalData[0].tran_date) : '';
	                $('#fromdate3').val(firstTranDate);

	                // Append rows to the table body
	                additionalData.forEach(function (item) {
	                    const row = `
	                        <tr>
	                            <td>${item.tran_date ? new Date(item.tran_date).toLocaleDateString('en-GB') : ''}</td>
	                            <td style="color: #0000EE; text-decoration: underline; cursor: pointer;" 
	                                onclick="showdetails('${item.tran_id}', '${item.part_tran_id}', '${item.acct_num}')">
	                                ${item.tran_id} / ${item.part_tran_id}
	                            </td>
	                            <td>${item.part_tran_type || ''}</td>
	                            <td>${item.acct_crncy || ''}</td>
	                            <td style="text-align: right;">${item.tran_amt ? formatDecimal(item.tran_amt, 2) : '0.00'}</td>
	                            <td style="text-align: right;">${item.acct_num || ''}</td>
	                            <td style="text-align: left;">${item.acct_name || ''}</td>
	                            <td style="text-align: left;">${item.tran_particular || ''}</td>
	                            <td style="text-align: left;">${item.tran_status || ''}</td>
	                        </tr>
	                    `;
	                    tableBody.append(row);
	                });

	                console.log("Rows appended successfully to #list3 table.");
	            } else {
	                console.log("No account details found for setlist3.");
	            }

	            // Ensure the table is displayed
	            $('#list3').show();
	        },
	        error: function (error) {
	            console.error('Error fetching additional data:', error);
	        }
	    });

	    const list2DataPromise = $.ajax({
	        url: './getFourValues',
	        type: 'GET',
	        success: function (list2Data) {
	            console.log("List2 data:", list2Data);
	            $('#list2 tbody').empty();

	            if (list2Data && list2Data.length > 0) {
	                let firstTranDate = list2Data[0].tran_date ? formatDate(list2Data[0].tran_date) : '';
	                $('#fromdate2').val(firstTranDate);

	                list2Data.forEach(function (item) {
	                    let row = `
	                        <tr>
	                            <td>${item.tran_date ? new Date(item.tran_date).toLocaleDateString('en-GB') : ''}</td>
	                            <td style="color: #0000EE;text-decoration: underline;cursor:pointer" onclick="showdetails('${item.tran_id}', '${item.part_tran_id}','${item.acct_num}')"> ${item.tran_id} / ${item.part_tran_id}</td>
	                            <td>${item.part_tran_type || ''}</td>
	                            <td>${item.acct_crncy || ''}</td>
	                            <td style="text-align: right;">${item.tran_amt ? formatDecimal(item.tran_amt, 2) : '0.00'}</td>
	                            <td style="text-align: right;">${item.acct_num || ''}</td>
	                            <td style="text-align: left;">${item.acct_name || ''}</td>
	                            <td style="text-align: left;">${item.tran_particular || ''}</td>
	                            <td style="text-align: left;">${item.tran_status || ''}</td>
	                        </tr>
	                    `;
	                    $('#list2 tbody').append(row);
	                });
	            } else {
	                console.log("No account details found.");
	            }
	        },
	        error: function (error) {
	            console.error('Error fetching list2 data:', error);
	        }
	    });
	    ajaxPromises.push(list2DataPromise);

	  Promise.all(ajaxPromises).then(() => {
	        console.log("All AJAX calls completed.");
	        $('#loader-overlay').hide(); 
	    }).catch((error) => {
	        console.error("Error in one of the AJAX calls:", error);
	        $('#loader-overlay').hide(); 
	    });

	    document.getElementById('CommonTable').style.display = 'none';
	    document.getElementById('TabButtons').style.display = 'block';
	    showTab('tab1');

	    if (initialTabId !== 'tab1') {
	        setTimeout(() => showTab(initialTabId), 0);
	    }   


	   
	   
}


/* function showdetails2(trandate) {
    let date = new Date(trandate);
    let year = date.getFullYear();
    let month = ("0" + (date.getMonth() + 1)).slice(-2); 
    let formattedDate = year + month;

    let url1 = './firstgetSpfbalance';
    let url2 = './sendYearMonth'; 
    // First AJAX call
    $.ajax({
        url: url1,
        data: { formattedDate: formattedDate },
        type: 'GET',
        success: function (response1) {
            console.log("First AJAX call successful: ", response1);
            
            $.ajax({
                url: url2,
                data: { formattedDate: formattedDate },
                type: 'GET',
                success: function (data) {
                    console.log("Second AJAX call successful: ", data);
                    let tableBody = $('#modal-table-body'); // The tbody element inside the modal
                    tableBody.empty(); // Clear any previous rows

                    // Function to get month name from month number
                    function getMonthName(monthNumber) {
                        const monthNames = [
                            "January", "February", "March", "April", "May", "June",
                            "July", "August", "September", "October", "November", "December"
                        ];
                        return monthNames[monthNumber - 1];
                    }

                    // Extract the first item's salaryMonth to display in the H2
                    if (data.length > 0) {
                        let salaryMonth = data[0][2]; 
                        let year = salaryMonth.substring(0, 4); 
                        let month = salaryMonth.substring(4, 6); 
                        let monthName = getMonthName(parseInt(month));
                        let formattedSalaryMonth = `${monthName} ${year}`;

                        // Set the H2 content
                        $('.h2 span').text(formattedSalaryMonth);
                    }

                    // Function to format values with commas and two decimal places
                    function formattedspf(value) {
                        return Number(value).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });
                    }

                    // Loop through the data and create rows in the table
                    data.forEach(function (item) {
                        let empNo = item[0];
                        let empName = item[1];
                        let salaryMonth = item[2];
                        let grossSalary = item[3];
                        let spf = item[4] !== null ? formattedspf(item[4]) : '0.00';

                        let formattedGrossSalary = Number(grossSalary).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });

                        // Create a new row for each employee
                        let row = `<tr>
                            <td>${empNo}</td>
                            <td>${empName}</td>
                            <td>${salaryMonth}</td>
                            <td style="text-align:right">${formattedGrossSalary}</td>
                            <td style="text-align:right">${spf}</td>
                        </tr>`;

                        // Append the row to the table body
                        tableBody.append(row);
                    });

                    // Show the modal
                    $('#myModal2').show();
                },
                error: function (error) {
                    console.error("Error in second AJAX call", error);
                }
            });
        },
        error: function (error) {
            console.error("Error in first AJAX call", error);
        }
    });
} */




/* function showdetails2(trandate) {
    let date = new Date(trandate);
    let year = date.getFullYear();
    let month = ("0" + (date.getMonth() + 1)).slice(-2); 
    let formattedDate = year + month;

    let url1 = './firstgetSpfbalance';
    let url2 = './sendYearMonth'; 

    // First AJAX call
    $.ajax({
        url: url1,
        data: { formattedDate: formattedDate },
        type: 'GET',
        success: function (response1) {
            console.log("First AJAX call successful: ", response1);

            // Assuming response1 contains the `total` value you need
            let total = response1[0]; // Replace 'total' with the correct key from response1

            $.ajax({
                url: url2,
                data: { formattedDate: formattedDate },
                type: 'GET',
                success: function (data) {
                    console.log("Second AJAX call successful: ", data);
                    let tableBody = $('#modal-table-body'); // The tbody element inside the modal
                    tableBody.empty(); // Clear any previous rows

                    // Function to get month name from month number
                    function getMonthName(monthNumber) {
                        const monthNames = [
                            "January", "February", "March", "April", "May", "June",
                            "July", "August", "September", "October", "November", "December"
                        ];
                        return monthNames[monthNumber - 1];
                    }

                    // Extract the first item's salaryMonth to display in the H2
                    if (data.length > 0) {
                        let salaryMonth = data[0][2]; 
                        let year = salaryMonth.substring(0, 4); 
                        let month = salaryMonth.substring(4, 6); 
                        let monthName = getMonthName(parseInt(month));
                        let formattedSalaryMonth = `${monthName} ${year}`;

                        // Set the H2 content
                        $('.h2 span').text(formattedSalaryMonth);
                    }

                    // Function to format values with commas and two decimal places
                    function formattedspf(value) {
                        return Number(value).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });
                    }

                    // Loop through the data and create rows in the table
                    data.forEach(function (item) {
                        let empNo = item[0];
                        let empName = item[1];
                        let salaryMonth = item[2];
                        let basicPay = item[3];
                        let grossSalary = item[4];
                        let spf = item[5] !== null ? formattedspf(item[5]) : '0.00';
						
                        let formattedbasicpay = Number(basicPay).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });
                        
                        let formattedGrossSalary = Number(grossSalary).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });

                        // Create a new row for each employee
                        let row = `<tr>
                            <td>${empNo}</td>
                            <td>${empName}</td>
                            <td>${salaryMonth}</td>
                            <td style="text-align:right">${formattedbasicpay}</td>
                            <td style="text-align:right">${formattedGrossSalary}</td>
                            <td style="text-align:right">${spf}</td>
                        </tr>`;

                        // Append the row to the table body
                        tableBody.append(row);
                    });

                    // Append a total row to the table
                    let totalRow = `<tr style="font-weight:bold; background-color: #f1f1f1;">
                        <td colspan="4" style="text-align:right;">Total:</td>
                        <td colspan="2" style="text-align:right;">${formattedspf(total)}</td>
                    </tr>`;
                    tableBody.append(totalRow);

                    // Show the modal
                    $('#myModal2').show();
                },
                error: function (error) {
                    console.error("Error in second AJAX call", error);
                }
            });
        },
        error: function (error) {
            console.error("Error in first AJAX call", error);
        }
    });
}
 */

 function showdetails2(trandate) {
	    let date = new Date(trandate);
	    let year = date.getFullYear();
	    let month = ("0" + (date.getMonth() + 1)).slice(-2);
	    let formattedDate = year + month;

	    let url1 = './firstgetSpfbalance';
	    let url2 = './sendYearMonth';

	    
	    $.ajax({
	        url: url1,
	        data: { formattedDate: formattedDate },
	        type: 'GET',
	        success: function (response1) {
	            console.log("First AJAX call successful: ", response1);

	            // Assuming response1 contains the `total` value you need
	            let total = response1[0]; // Replace 'total' with the correct key from response1

	            $.ajax({
	                url: url2,
	                data: { formattedDate: formattedDate },
	                type: 'GET',
	                success: function (data) {
	                    console.log("Second AJAX call successful: ", data);
	                    let tableBody = $('#modal-table-body'); // The tbody element inside the modal
	                    tableBody.empty(); // Clear any previous rows

	                    // Function to get month name from month number
	                    function getMonthName(monthNumber) {
	                        const monthNames = [
	                            "January", "February", "March", "April", "May", "June",
	                            "July", "August", "September", "October", "November", "December"
	                        ];
	                        return monthNames[monthNumber - 1];
	                    }

	                    // Extract the first item's salaryMonth to display in the H2
	                    if (data.length > 0) {
	                        let salaryMonth = data[0][2];
	                        let year = salaryMonth.substring(0, 4);
	                        let month = salaryMonth.substring(4, 6);
	                        let monthName = getMonthName(parseInt(month));
	                        let formattedSalaryMonth = `${monthName} ${year}`;

	                        // Set the H2 content
	                        $('.h2 span').text(formattedSalaryMonth);

	                        // Add the "View" button with the salaryMonth as a data attribute
	                        $('#view-action').data('salary-month', salaryMonth);
	                    }

	                    // Function to format values with commas and two decimal places
	                    function formattedspf(value) {
	                        return Number(value).toLocaleString('en-US', {
	                            minimumFractionDigits: 2,
	                            maximumFractionDigits: 2
	                        });
	                    }

	                    // Loop through the data and create rows in the table
	                    data.forEach(function (item) {
	                        let empNo = item[0];
	                        let empName = item[1];
	                        let salaryMonth = item[2];
	                        let basicPay = item[3];
	                        let grossSalary = item[4];
	                        let spf = item[5] !== null ? formattedspf(item[5]) : '0.00';

	                        let formattedbasicpay = Number(basicPay).toLocaleString('en-US', {
	                            minimumFractionDigits: 2,
	                            maximumFractionDigits: 2
	                        });

	                        let formattedGrossSalary = Number(grossSalary).toLocaleString('en-US', {
	                            minimumFractionDigits: 2,
	                            maximumFractionDigits: 2
	                        });

	                        // Create a new row without the "View" button column
	                        let row = `<tr>
	                            <td>${empNo}</td>
	                            <td>${empName}</td>
	                            <td>${salaryMonth}</td>
	                            <td style="text-align:right">${formattedbasicpay}</td>
	                            <td style="text-align:right">${formattedGrossSalary}</td>
	                            <td style="text-align:right">${spf}</td>
	                        </tr>`;

	                        // Append the row to the table body
	                        tableBody.append(row);
	                    });

	                    // Append a total row to the table
	                    let totalRow = `<tr style="font-weight:bold; background-color: #f1f1f1;">
	                        <td colspan="4" style="text-align:right;">Total:</td>
	                        <td colspan="2" style="text-align:right;">${formattedspf(total)}</td>
	                    </tr>`;
	                    tableBody.append(totalRow);

	                    // Show the modal
	                    $('#myModal2').show();
	                },
	                error: function (error) {
	                    console.error("Error in second AJAX call", error);
	                }
	            });
	        },
	        error: function (error) {
	            console.error("Error in first AJAX call", error);
	        }
	    });
	}

$('#view-action').on('click', function () {
	    let salaryMonth = $(this).data('salary-month');
	    console.log("View button clicked for Sal Month:", salaryMonth);

	    let url = `spf?formmode=list&Month=${salaryMonth}`;
	    location.href = url;
	});

$('#closebtn2').click(function() {
    $('#myModal2').hide();
});


function showdetails3(trandate) {
    let date = new Date(trandate);
    let year = date.getFullYear();
    let month = ("0" + (date.getMonth() + 1)).slice(-2); 
    let formattedDate = year + month;
	
    let url1 = './firstEsi';
    let url2 = './secondEsi'; 

     $.ajax({
        url: url1,
        data: { formattedDate: formattedDate },
        type: 'GET',
        success: function (response1) {
            console.log("First AJAX call successful: ", response1);

            let total = response1[0]; 
            $.ajax({
                url: url2,
                data: { formattedDate: formattedDate },
                type: 'GET',
                success: function (data) {
                    console.log("Second AJAX call successful: ", data);
                    let tableBody = $('#modal-table-body1'); 
                    tableBody.empty(); 
                    function getMonthName(monthNumber) {
                        const monthNames = [
                            "January", "February", "March", "April", "May", "June",
                            "July", "August", "September", "October", "November", "December"
                        ];
                        return monthNames[monthNumber - 1];
                    }

                    if (data.length > 0) {
                        let salaryMonth = data[0][2]; 
                        let year = salaryMonth.substring(0, 4); 
                        let month = salaryMonth.substring(4, 6); 
                        let monthName = getMonthName(parseInt(month));
                        let formattedSalaryMonth = `${monthName} ${year}`;
						$('.h2 span').text(formattedSalaryMonth);
						$('#view-action2').data('salary-month', salaryMonth);
                    }

                    // Function to format values with commas and two decimal places
                    function formattedesi(value) {
                        return Number(value).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });
                    }

                    // Loop through the data and create rows in the table
                    data.forEach(function (item) {
                        let empNo = item[0];
                        let empName = item[1];
                        let salaryMonth = item[2];
                        let basicPay = item[3];
                        let grossSalary = item[4];
                        let esi = item[5] !== null ? formattedesi(item[5]) : '0.00';
						
                        let formattedbasicpay = Number(basicPay).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });
                        
                        let formattedGrossSalary = Number(grossSalary).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });

                        // Create a new row for each employee
                        let row = `<tr>
                            <td>${empNo}</td>
                            <td>${empName}</td>
                            <td>${salaryMonth}</td>
                            <td style="text-align:right">${formattedbasicpay}</td>
                            <td style="text-align:right">${formattedGrossSalary}</td>
                            <td style="text-align:right">${esi}</td>
                        </tr>`;

                        // Append the row to the table body
                        tableBody.append(row);
                    });

                    // Append a total row to the table
                    let totalRow = `<tr style="font-weight:bold; background-color: #f1f1f1;">
                        <td colspan="4" style="text-align:right;">Total:</td>
                        <td colspan="2" style="text-align:right;">${formattedesi(total)}</td>
                    </tr>`;
                    tableBody.append(totalRow);

                    // Show the modal
                    $('#myModal3').show();
                },
                error: function (error) {
                    console.error("Error in second AJAX call", error);
                }
            });
        },
        error: function (error) {
            console.error("Error in first AJAX call", error);
        }
    }); 
    
}

$('#view-action2').on('click', function () {
    let salaryMonth = $(this).data('salary-month');
    console.log("View button clicked for Sal Month:", salaryMonth);
	
    let url = `esi?formmode=list&Month=${salaryMonth}`;
    location.href = url;
});

$('#closebtn3').click(function() {
    $('#myModal3').hide();
});

function showdetails4(trandate) {
    let date = new Date(trandate);
    date.setMonth(date.getMonth() - 1); // Subtract a month

    // Extract the year and month
    let year = date.getFullYear();
    let month = date.getMonth() + 1; // Months are 0-based, so add 1

    // Format month to always have two digits (e.g., 01, 02, ...)
    month = month < 10 ? '0' + month : month;

    // Combine year and month
    let formattedDate = `${year}${month}`;

    

    let url1 = './firstgetSpfbalance';
    let url2 = './sendYearMonth'; 

 
    $.ajax({
        url: url1,
        data: { formattedDate: formattedDate },
        type: 'GET',
        success: function (response1) {
            console.log("First AJAX call successful: ", response1);

            // Assuming response1 contains the `total` value you need
            let total = response1[0]; // Replace 'total' with the correct key from response1

            $.ajax({
                url: url2,
                data: { formattedDate: formattedDate },
                type: 'GET',
                success: function (data) {
                    console.log("Second AJAX call successful: ", data);
                    let tableBody = $('#modal-table-body'); // The tbody element inside the modal
                    tableBody.empty(); // Clear any previous rows

                    // Function to get month name from month number
                    function getMonthName(monthNumber) {
                        const monthNames = [
                            "January", "February", "March", "April", "May", "June",
                            "July", "August", "September", "October", "November", "December"
                        ];
                        return monthNames[monthNumber - 1];
                    }

                    // Extract the first item's salaryMonth to display in the H2
                    if (data.length > 0) {
                        let salaryMonth = data[0][2];
                        let year = salaryMonth.substring(0, 4);
                        let month = salaryMonth.substring(4, 6);
                        let monthName = getMonthName(parseInt(month));
                        let formattedSalaryMonth = `${monthName} ${year}`;

                        // Set the H2 content
                        $('.h2 span').text(formattedSalaryMonth);

                        // Add the "View" button with the salaryMonth as a data attribute
                        $('#view-action').data('salary-month', salaryMonth);
                    }

                    // Function to format values with commas and two decimal places
                    function formattedspf(value) {
                        return Number(value).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });
                    }

                    // Loop through the data and create rows in the table
                    data.forEach(function (item) {
                        let empNo = item[0];
                        let empName = item[1];
                        let salaryMonth = item[2];
                        let basicPay = item[3];
                        let grossSalary = item[4];
                        let spf = item[5] !== null ? formattedspf(item[5]) : '0.00';

                        let formattedbasicpay = Number(basicPay).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });

                        let formattedGrossSalary = Number(grossSalary).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });

                        // Create a new row without the "View" button column
                        let row = `<tr>
                            <td>${empNo}</td>
                            <td>${empName}</td>
                            <td>${salaryMonth}</td>
                            <td style="text-align:right">${formattedbasicpay}</td>
                            <td style="text-align:right">${formattedGrossSalary}</td>
                            <td style="text-align:right">${spf}</td>
                        </tr>`;

                        tableBody.append(row);
                    });

                    // Append a total row to the table
                    let totalRow = `<tr style="font-weight:bold; background-color: #f1f1f1;">
                        <td colspan="4" style="text-align:right;">Total:</td>
                        <td colspan="2" style="text-align:right;">${formattedspf(total)}</td>
                    </tr>`;
                    tableBody.append(totalRow);

                    // Show the modal
                    $('#myModal2').show();
                },
                error: function (error) {
                    console.error("Error in second AJAX call", error);
                }
            });
        },
        error: function (error) {
            console.error("Error in first AJAX call", error);
        }
    });
    
}


function showdetails5(trandate) {
    let date = new Date(trandate);
    date.setMonth(date.getMonth() - 1); // Subtract a month

    // Extract the year and month
    let year = date.getFullYear();
    let month = date.getMonth() + 1; // Months are 0-based, so add 1

    // Format month to always have two digits (e.g., 01, 02, ...)
    month = month < 10 ? '0' + month : month;

    // Combine year and month
    let formattedDate = `${year}${month}`;

    let url1 = './firstEsi';
    let url2 = './secondEsi'; 

    $.ajax({
        url: url1,
        data: { formattedDate: formattedDate },
        type: 'GET',
        success: function (response1) {
            console.log("First AJAX call successful: ", response1);

            let total = response1[0]; 
            $.ajax({
                url: url2,
                data: { formattedDate: formattedDate },
                type: 'GET',
                success: function (data) {
                    console.log("Second AJAX call successful: ", data);
                    let tableBody = $('#modal-table-body1'); 
                    tableBody.empty(); 
                    function getMonthName(monthNumber) {
                        const monthNames = [
                            "January", "February", "March", "April", "May", "June",
                            "July", "August", "September", "October", "November", "December"
                        ];
                        return monthNames[monthNumber - 1];
                    }

                    if (data.length > 0) {
                        let salaryMonth = data[0][2]; 
                        let year = salaryMonth.substring(0, 4); 
                        let month = salaryMonth.substring(4, 6); 
                        let monthName = getMonthName(parseInt(month));
                        let formattedSalaryMonth = `${monthName} ${year}`;
						$('.h2 span').text(formattedSalaryMonth);
						$('#view-action2').data('salary-month', salaryMonth);
                    }

                    // Function to format values with commas and two decimal places
                    function formattedesi(value) {
                        return Number(value).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });
                    }

                    // Loop through the data and create rows in the table
                    data.forEach(function (item) {
                        let empNo = item[0];
                        let empName = item[1];
                        let salaryMonth = item[2];
                        let basicPay = item[3];
                        let grossSalary = item[4];
                        let esi = item[5] !== null ? formattedesi(item[5]) : '0.00';
						
                        let formattedbasicpay = Number(basicPay).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });
                        
                        let formattedGrossSalary = Number(grossSalary).toLocaleString('en-US', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });

                        // Create a new row for each employee
                        let row = `<tr>
                            <td>${empNo}</td>
                            <td>${empName}</td>
                            <td>${salaryMonth}</td>
                            <td style="text-align:right">${formattedbasicpay}</td>
                            <td style="text-align:right">${formattedGrossSalary}</td>
                            <td style="text-align:right">${esi}</td>
                        </tr>`;

                        // Append the row to the table body
                        tableBody.append(row);
                    });

                    // Append a total row to the table
                    let totalRow = `<tr style="font-weight:bold; background-color: #f1f1f1;">
                        <td colspan="4" style="text-align:right;">Total:</td>
                        <td colspan="2" style="text-align:right;">${formattedesi(total)}</td>
                    </tr>`;
                    tableBody.append(totalRow);

                    // Show the modal
                    $('#myModal3').show();
                },
                error: function (error) {
                    console.error("Error in second AJAX call", error);
                }
            });
        },
        error: function (error) {
            console.error("Error in first AJAX call", error);
        }
    }); 

}



</script>


</html>